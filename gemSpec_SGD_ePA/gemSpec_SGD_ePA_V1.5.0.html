<html>
 <head>
  <link rel="stylesheet" href="attachments/styleSheetForToc.css">
 </head>
 <body>
  <p id="polarion_1"> <br> </p>
  <p id="polarion_3"> <br> </p>
  <p id="polarion_4"> <br> </p>
  <p id="polarion_5"> <br> </p>
  <p id="polarion_6"> <span style="font-weight: bold;text-decoration: underline;font-size: 12pt;line-height: 1.5;">Elektronische Gesundheitskarte und Telematikinfrastruktur</span> </p>
  <p id="polarion_7"> <br> </p>
  <p id="polarion_8"> <br> </p>
  <p id="polarion_9"> <br> </p>
  <p id="polarion_10"> <br> </p>
  <p id="polarion_11" style="text-align: center;"> <span style="font-weight: bold;font-size: 28pt;line-height: 1.2;">Spezifikation</span> </p>
  <p id="polarion_12" style="text-align: center;"> <span style="font-weight: bold;font-size: 28pt;line-height: 1.2;">Schlüsselgenerierungsdienst</span> </p>
  <p id="polarion_129" style="text-align: center;"> <span style="font-weight: bold;font-size: 28pt;line-height: 1.2;">ePA</span> </p>
  <p id="polarion_13"> <br> </p>
  <p id="polarion_14"> <br> </p>
  <p id="polarion_15"> <br> </p>
  <div id="polarion_editor_html_block1" class="polarion-dle-wiki-block"> 
   <div id="polarion_editor_html_block_content" contenteditable="false"></div>
   <pre id="polarion_editor_html_block_source" class="polarion-dle-wiki-block-source" contenteditable="false">
    <table>
     <tr>
      <td>Version</td>
      <td>1.5.0</td>
     </tr>
     <tr>
      <td>Revision</td>
      <td>571418</td>
     </tr>
     <tr>
      <td>Stand</td>
      <td>31.01.2022</td>
     </tr>
     <tr>
      <td>Status</td>
      <td>freigegeben</td>
     </tr>
     <tr>
      <td>Klassifizierung</td>
      <td>öffentlich</td>
     </tr>
     <tr>
      <td>Referenzierung</td>
      <td>gemSpec_SGD_ePA</td>
     </tr>
    </table></pre> 
  </div>
  <p id="polarion_16"> <br> </p>
  <h1 id="polarion_wiki macro name=module-workitem;params=id=ML-94480">Dokumentinformationen</h1>
  <p id="polarion_21"> <span style="font-weight: bold;">Änderungen zur Vorversion</span> </p>
  <p id="polarion_22">Anpassungen des vorliegenden Dokumentes im Vergleich zur Vorversion können Sie der nachfolgenden Tabelle entnehmen.</p>
  <p id="polarion_23"> <span style="font-style: italic;color: #0000FF;">&nbsp;</span> </p>
  <p id="polarion_24" data-keep-next="true"> <span style="font-weight: bold;">Dokumentenhistorie</span> </p>
  <table id="polarion_wiki macro name=table;params=width=99.87%|uid=1" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 53pt;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Version </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 44pt;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Stand </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 77pt;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Kap./Seite </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 280pt;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Grund der Änderung, besondere Hinweise </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 70pt;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Bearbeitung </th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">0.5.0 </td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">15.03.19 </td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">initiale Erstellung </td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">1.0.0 </td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">15.05.19 </td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">freigegeben </td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">1.1.0</td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">28.06.19</td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Einarbeitung P19.1</td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik</td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">1.2.0</td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">02.10.19</td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Einarbeitung P20.1</td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik</td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">1.3.0</td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">02.03.20</td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Einarbeitung P21.1</td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik</td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">1.4.0</td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">22.06.20</td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Einarbeitung P21.3</td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik</td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">1.4.1</td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">05.11.20</td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Einarbeitung P21.7</td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik</td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">1.4.2</td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">19.02.21</td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Kap. 8</td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">redaktionelle Anpassung</td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik</td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 53pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">1.5.0</td> 
     <td style="vertical-align: top;width: 44pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">31.01.22</td> 
     <td style="vertical-align: top;width: 77pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 280pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">Einarbeitung ePA_Maintenance_21.5</td> 
     <td style="vertical-align: top;width: 70pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;">gematik</td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_26"></p>
  <h1 id="polarion_wiki macro name=module-workitem;params=id=ML-94481">Inhaltsverzeichnis</h1>
  <div id="polarion_wiki macro name=toc"></div>
  <div id="toc_container">
   <p class="toc_title"><h1></h1></p>
   <li><a href="#polarion_wiki macro name=module-workitem;params=id=ML-94480">Dokumentinformationen</a></li>
   <li><a href="#polarion_wiki macro name=module-workitem;params=id=ML-94481">Inhaltsverzeichnis</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94482">1 Einordnung des Dokuments</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94483">1.1 Zielsetzung</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94484">1.2 Zielgruppe</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94485">1.3 Geltungsbereich</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94486">1.4 Abgrenzungen</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94487">1.5 Methodik</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94488">2 Überblick</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94489">2.1 Grundlage und Kernidee</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94490">2.2 Akteure und Komponenten</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94491">2.3 Basisablauf Kommunikation SGD-Client und SGD</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94493">2.4 Initiale Schlüsselableitung für den Kontoinhaber</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94492">2.5 Schlüsselableitung durch den Kontoinhaber</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94494">2.6 Schlüsselableitung für einen Berechtigungsempfänger</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94739">2.7 Schlüsselableitung durch einen Berechtigten</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94738">2.8 Schlüsselableitung für einen Berechtigungsempfänger durch einen Vertreter</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94741">2.9 Schlüsselableitung für einen durch einen Vertreter berechtigten Berechtigten</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94496">2.10 Nichtspeicherung von Versichertendaten</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94707">2.11 Besondere Rolle SGD-HSM</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94497">3 Übergreifende Festlegungen</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94498">3.1 Beziehung zwischen ePA-Aktensystem und SGD</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94506">3.2 Verfügbarkeit und Performanz</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94513">3.3 Sichere Betreiberumgebung</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94514">3.4 Verschiedenes</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94516">4 Bestandteile eines SGD</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94519">4.1 Request-Verarbeitung in einem SGD</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-126988">4.1.1 Routing auf die SGD-HSM</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94709">4.2 SGD-HSM</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94522">4.3 Schlüssel im SGD-HSM</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94787">4.4 Pflege der Prüfschlüssel (S2) im SGD-HSM</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-113379">4.4.1 Zuordnung von OCSP-Responder-Zertifikaten zu CA-Zertifikaten (informativ)</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94533">4.5 Funktionsablauf Firmware-Modul SGD-HSM</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94534">4.5.1 Zertifikats- und Schlüsselprüfung im SGD-HSM</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-96283">4.5.2 Authentisierungstoken im SGD-HSM</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94536">4.5.3 Schlüsselableitung im SGD-HSM</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94539">4.5.4 Kommando-Abarbeitung KeyDerivation im SGD-HSM</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-113376">4.5.5 Betriebsunterstützende Leistungen im SGD-HSM</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-127053">4.6 Betriebsunterstützende Leistungen allgemein</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94544">5 Kodierung von Schlüsseln und Nachrichten</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94545">5.1 Kodierung von Schlüsseln</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94699">5.1.1 ECIES-Schlüssel eines SGD-HSM</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94698">5.1.2 ECIES-Schlüssel eines Clients</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94550">5.2 Kodierung von Chiffraten</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94553">6 Schnittstellen und Operationen</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94554">6.1 Innenschnittstellen</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94555">6.2 HTTPS-Schnittstellen und HTTP-Kommunikation</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94560">6.3 Anforderungen an die JSON-Requests und -Responses</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94563">6.4 Operation GetPublicKey</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-96277">6.5 Operation GetAuthenticationToken</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94567">6.6 Operation KeyDerivation</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94577">6.7 Fehlermeldungen</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-102145">6.7.1 Fehlermeldungen und HTTP-Status-Code (informativ)</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94578">7 Clientspezifische Festlegungen</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-127062">7.1 Mehrfachableitung</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94583">8 Interoperables Austauschformat</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94770">9 Datenkanal zwischen Client und SGD (informativ)</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-96290">9.1 Ablauf Kommunikation zwischen Client und SGD-HSM</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-96289">9.2 ECIES-Verfahren</a></li>
   <li> : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94585">10 Anhang – Verzeichnisse</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94586">10.1 Abkürzungen</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94587">10.2 Glossar</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94588">10.3 Abbildungsverzeichnis</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94589">10.4 Tabellenverzeichnis</a></li>
   <li> : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94590">10.5 Referenzierte Dokumente</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94591">10.5.1 – Dokumente der gematik</a></li>
   <li> : : : <a href="#polarion_wiki macro name=module-workitem;params=id=ML-94592">10.5.2 – Weitere Dokumente</a></li>
  </div>
  <p id="polarion_36"></p>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94482">1 Einordnung des Dokuments</h2>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94483">1.1 Zielsetzung</h3>
  <p id="polarion_38">Die vorliegende Spezifikation definiert Anforderungen an den Produkttyp "Schlüsselgenerierungsdienst ePA" (SGD) und beschreibt die Funktionsweise der Schlüsselgenerierung, die die Basis für die Ver- und Entschlüsselung von Akten- und Kontextschlüssel innerhalb eines Clients (ePA-FdV etc.) ist.&nbsp;</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94484">1.2 Zielgruppe</h3>
  <p id="polarion_18">Das Dokument richtet sich an Hersteller und Anbieter des Produkts "Schlüsselgenerierungsdienst ePA" und des Produktes "ePA-Aktensystem". Weiterhin unterstützt das Dokument Hersteller von "ePA-Frontends des Versicherten" und Hersteller eines "Fachmodul ePA" bei der Entwicklung, da diese Produkte mit mehreren SGD kommunizieren müssen.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94485">1.3 Geltungsbereich</h3>
  <p id="polarion_53">Dieses Dokument enthält normative Festlegungen zur Telematikinfrastruktur des deutschen Gesundheitswesens. Der Gültigkeitszeitraum der vorliegenden Version und deren Anwendung in Zulassungsverfahren wird durch die gematik GmbH in gesonderten Dokumenten (z. B. Dokumentenlandkarte, Produkttypsteckbrief, Leistungsbeschreibung) festgelegt und bekannt gegeben.</p>
  <p id="polarion_54"></p>
  <p id="polarion_55" data-keep-next="true"> <span style="font-weight: bold;">Wichtiger Schutzrechts-/Patentrechtshinweis</span> </p>
  <p id="polarion_56" data-keep-next="true"> <span style="font-style: italic;font-size: 10pt;line-height: 1.5;">Die nachfolgende Spezifikation ist von der gematik allein unter technischen Gesichtspunkten erstellt worden. Im Einzelfall kann nicht ausgeschlossen werden, dass die Implementierung der Spezifikation in technische Schutzrechte Dritter eingreift. Es ist allein Sache des Anbieters oder Herstellers, durch geeignete Maßnahmen dafür Sorge zu tragen, dass von ihm aufgrund der Spezifikation angebotene Produkte und/oder Leistungen nicht gegen Schutzrechte Dritter verstoßen und sich ggf. die erforderlichen Erlaubnisse/Lizenzen von den betroffenen Schutzrechtsinhabern einzuholen. Die gematik GmbH übernimmt insofern keinerlei Gewährleistungen.</span> </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94486">1.4 Abgrenzungen</h3>
  <p id="polarion_57">Es ist keine Abgrenzung gegenüber anderen Spezifikationen/Konzepten oder im Kontext derzeit nicht relevanten Themen erforderlich.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94487">1.5 Methodik</h3>
  <p id="polarion_17"> Anforderungen als Ausdruck normativer Festlegungen werden durch eine eindeutige ID sowie die dem RFC 2119 [RFC2119] entsprechenden, in Großbuchstaben geschriebenen deutschen Schlüsselworte MUSS, DARF NICHT, SOLL, SOLL NICHT, KANN gekennzeichnet.<br> <br> Sie werden im Dokument wie folgt dargestellt:<br> &lt;AFO-ID&gt; - &lt;Titel der Afo&gt;<br> Text / Beschreibung<br> [&lt;=]<br> <br> Dabei umfasst die Anforderung sämtliche zwischen Afo-ID und der Textmarke [&lt;=] angeführten Inhalte.<br> </p>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94488">2 Überblick</h2>
  <p id="polarion_46">Ein Schlüsselgenerierungsdienst (SGD) generiert AES-256-Bit-Schlüssel für eine Entität, die sich mittels</p>
  <ul id="polarion_109"> 
   <li>einer eGK,</li> 
   <li>einer alternativen Versichertenidentität,</li> 
   <li>einer SMC-B, oder</li> 
   <li>einer SMC-KTR&nbsp; </li> 
  </ul>
  <p id="polarion_164">gegenüber dem SGD authentisiert hat. Diese Generierung erfolgt über eine Schlüsselableitung auf Grundlage von geheimen SGD-spezifischen Ableitungsschlüsseln (Masterkeys) und Ableitungsvektoren. Diese Ableitungsvektoren enthalten konstante Merkmale, entweder die KVNR oder die Telematik-ID. Jeweils fließt notwendigerweise solch ein konstantes Merkmal aus der erfolgreichen Authentisierung und dem dabei verwendeten EE-Client-Zertifikat mit in die Ableitung ein. Damit werden nur für Berechtigte (erfolgreich Authentifizierte) diese Schlüssel abgeleitet und die jeweils generierten Schlüssel sind&nbsp;spezifisch – unterschiedliche Ableitungsvektoren erzeugen jeweils unterschiedliche abgeleitete Schlüssel.</p>
  <p id="polarion_117">Die Sicherung der medizinischen Daten bei der elektronischen Patientenakte [gemSysL_ePA] ist ein Zusammenspiel aus Zugriffskontrolle und Schlüsselmanagement (Verschlüsselung). Aus diesem Hybridmodell folgt: Auch wenn ein Client über mehrere SGD Schlüssel ableiten lassen kann, heißt dies noch nicht, dass für diese Schlüssel überhaupt ein passendes Chiffrat existiert oder dass ein Client auf solch ein Chiffrat Zugriff besitzt.</p>
  <p id="polarion_167"> Die Schlüsselableitung wird in einem SGD innerhalb eines HSM mit einem SGD-spezifischen Firmware-Modul durchgeführt (SGD-HSM genannt). Durch technische Maßnahmen wird ausgeschlossen, dass ein Betreiber eines SGD die Schlüsselableitung selbst durchführen kann oder Zugriff auf die unverschlüsselten versichertenindividuellen Schlüssel erhalten kann. Nur das&nbsp;SGD-HSM kann die geheimen Ableitungsschlüssel verwenden. Es prüft dabei zuvor die erfolgreiche Authentisierung des Anfragenden und verwendet u. a. die darin authentisierten Angaben als Ableitungsvektoren. Es gibt aus der Perspektive eines Client (des ePA-Frontend des Versicherten (ePA-FdV), eines Konnektor-Fachmodul ePA (FM ePA) etc.) immer genau zwei SGD, die ein Client aufgrund der verwendeten SGD-HSM-Zertifikate sicher unterscheiden kann. Der Client fordert eine Schlüsselgenerierung jeweils bei den beiden SGD an und erhält damit zwei unabhängige AES-256-Schlüssel. Nach erfolgreicher Authentifizierung und Autorisierung durch das Aktensystem verwendet der Client diese zwei Schlüssel, um das vom ePA-Aktensystem erhaltene Chiffrat im "Zwiebelschalenprinzip" zu entschlüsseln. So erhält der Client den Akten- und den Kontextschlüssel im Klartext. Diese beiden Schlüssel sind dabei bezüglich der Ver- und Entschlüsselung durch eine gemeinsame Datenstruktur (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94583" data-option-id="shortoutline"></span>) fest miteinander verbunden. Die zwei SGD sind technisch, organisatorisch und wirtschaftlich unabhängig voneinander (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94498" data-option-id="shortoutline"></span>&nbsp; ). Ein SGD kommt niemals mit dem Akten- und Kontextschlüssel eines Versicherten in Berührung. </p>
  <p id="polarion_61">Verliert der Versicherte seine eGK oder sein mobiles Endgerät mit seiner alternativen Versichertenidentität, kann er sich mit seiner neuen Identität (Folge-eGK oder einer anderen alternativen Versichertenidentität)&nbsp;am ePA-Aktensystem authentisieren. Da die Merkmale für die Schlüsselableitung in der Folgeidentität gleich sind (gleichbleibende KVNR) &nbsp;und kodiert ist, welcher Ableitungsschlüssel verwendet worden ist, kann ein Client mittels beider SGD die gleichen Schlüssel erhalten und die Entschlüsselung der Akten- und Kontextschlüssel wieder vornehmen. Der Verlust einer eGK eines Versicherten führt also nicht zum Verlust der Akte des Versicherten.</p>
  <p id="polarion_173">Analog ist in einer Folge-SMC-B die Telematik-ID konstant. Somit kann eine Leistungserbringerinstitution (LEI) bereits vergebene Berechtigungen und vorher von einem Versicherten für die LEI erzeugte Chiffrate weiterhin nutzen.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94489">2.1 Grundlage und Kernidee</h3>
  <p id="polarion_50">Notwendige Grundlage der Idee der Schlüsselableitung mittels der SGD ist, dass bei einem Kartenwechsel der eGK oder einem Wechsel der alternativen Versichertenidentität die KVNR eines Versicherten in den Zertifikaten der Folgekarte bzw. bei der Folgeidentität korrekt und konstant bleibt. Die Korrektheit der Kartenherausgabeprozesse ist – wie bei nahezu allen digitalen Prozessen in der TI – notwendige Voraussetzung. Analog bleibt bei einem Kartenwechsel einer SMC-B oder einer SMC-KTR die Telematik-ID konstant.</p>
  <p id="polarion_48">Es muss sichergestellt sein, dass nur erfolgreich authentifizierte Clients eine Schlüsselableitung durchführen können und dabei notwendigerweise die die Clients identifizierenden (konstanten) Merkmale in die Schlüsselableitung als Ableitungsvektor mit einfließen. Die Authentifizierung durch die SGD-HSMs der beiden SGD erfolgt unabhängig vom Aktensystem.</p>
  <p id="polarion_59">Ziele für die Schlüsselableitung:</p>
  <ol id="polarion_60"> 
   <li>Die Akten- und Kontextschlüssel dürfen sich unverschlüsselt nur in Clients (ePA-FdV, FM ePA etc.) befinden (bzw. der Kontextschlüssel ebenfalls in der VAU). Dort liegen die Schlüssel nur temporär während der Verwendung der Akte vor und werden dort anschließend sicher gelöscht.</li> 
   <li>Die Akten- und Kontextschlüssel dürfen nur durch das Zusammenwirken mehrerer unabhängiger Teilnehmer entschlüsselbar sein.</li> 
   <li>Alle Ver- und Entschlüsselungen dürfen nur authentisierte Daten verwenden. </li> 
   <li>Die Akten- und Kontextschlüssel müssen mit versichertenindividuellen Schlüsseln geschützt sein (Schlüsseldiversifizierung).</li> 
   <li>Da ausreichend geprüfte symmetrische Verschlüsselungsverfahren (bspw. Finalisten des öffentlichen Auswahlverfahrens für AES) in ihrer Sicherheitseignung deutlich stabiler über längere Zeiträume sind als asymmetrische Verschlüsselungsverfahren (Eignung der Schlüssellängen, vgl. notwendige Anpassung der Schlüssellängen bspw. bei RSA), soll die Lösung möglichst viel auf symmetrischen Verfahren beruhen.</li> 
   <li>Die Verwendung von symmetrischen Verschlüsselungsverfahren ermöglicht eine eventuell zukünftig notwendige Reaktion auf das Thema Quantencomputer-Resistenz. </li> 
  </ol>
  <p id="polarion_84"> Wenn die KVNR bzw. die Telematik-ID in einer Folgekarte oder Folgeidentität immer konstant ist, so kann diese (1) als eindeutiges Identifikationsmerkmal bspw. innerhalb einer Authentifizierung und Autorisierung verwendet werden und (2) als Basis für eine eindeutige Schlüsselableitung. Die Schlüsselableitung berechnet aus einem geheimen Ableitungsschlüssel (Mastersecret) und einer KVNR plus anderen Angaben (vgl. Abschnitte <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span>&nbsp;ff) deterministisch einen spezifischen AES-256-Schlüssel. Diese Schlüsselableitung wird in einem HSM mit einem speziellen Firmware-Modul durchgeführt, das verhindert, dass der Betreiber des HSMs (vgl. Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94516" data-option-id="longoutline"></span>&nbsp;) in den Ableitungsprozess Einblick erhält – er kennt den geheimen Ableitungsschlüssel nicht, und er kann die Authentifizierungs- und Autorisierungsfunktion im HSM nicht beeinflussen. Ein solcher abgeleiteter versicherten- und zugriffsregelindividueller AES-256-Schlüssel wird dem Client über einen beidseitig authentisierten Ende-zu-Ende-verschlüsselten Kanal zwischen SGD-HSM und dem Client zur Verfügung gestellt. Ein Versicherter verwendet solche abgeleiteten versichertenindividuellen AES-256-Schlüssel aus mehreren voneinander unabhängigen SGD. Ein Client (ein ePA-FdV, ein FM ePA etc.) kann die verschiedenen SGD voneinander unterscheiden. Die Erzeugung der abgeleiteten versichertenindividuellen AES-256-Schlüssel kann auf beliebig viele unabhängige SGD&nbsp;verteilt werden. Das Verfahren skaliert linear – es ist technisch leicht möglich, mehrere SGD zu verwenden. </p>
  <p id="polarion_144"> Die Schlüsselableitungsfunktionalität ePA&nbsp;basiert aktuell auf genau zwei SGD pro Aktensystem (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94490" data-option-id="longoutline"></span>&nbsp;und Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94498" data-option-id="longoutline"></span>) gemäß <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="[gemKPT_Arch_TIP#4.7 Langfristige Verschlüsselung]" data-item-id="ML-94626" data-option-id="custom"></span>&nbsp;. Im Folgenden wird derjenige SGD, den ein Anbieter eines Fachanwendungsspezifischen Dienstes&nbsp;(FAD) bereitstellen muss, als "SGD 1" bzw. "SGD FAD" bezeichnet. Derjenige SGD, der von einem von SGD 1 unabhängigen Dritten in der TI-Plattform (TIP) betrieben wird, wird im Folgenden als "SGD 2" bzw. "SGD TIP" bezeichnet. Mittels der beiden erhaltenen AES-256-Schlüssel verschlüsselt ein Client den Akten- und Kontextschlüssel (vgl. Abschnitt "<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-92802" data-option-id="longoutline"></span>&nbsp;") im "Zwiebelschalenprinzip". Das entstandene Chiffrat wird dem ePA-Aktensystem zur Einlagerung übergeben.&nbsp; </p>
  <p id="polarion_99">Nach einer erfolgreichen Anmeldung am Aktensystem kann ein Versicherter Folgendes tun:</p>
  <ol id="polarion_134"> 
   <li>Der Versicherte authentisiert sich jeweils bei den verschiedenen, unabhängigen Schlüsselableitungsdiensten (beidseitig authentisierter verschlüsselter Datenkanal zwischen SGD-HSM und Client, vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94770" data-option-id="shortoutline"></span>&nbsp;).</li> 
   <li>Der Versicherte erhält aufgrund der Konstanz der KVNR &nbsp;und des im Ableitungsvektor benannten geheimen Ableitungsschlüssel jeweils den gleichen&nbsp;abgeleiteten versichertenindividuellen AES-256-Schlüssel wie zuvor.</li> 
   <li>Der Versicherte kann anschließend im Zwiebelschalenprinzip den Akten- und den Kontextschlüssel entschlüsseln.</li> 
  </ol>
  <p id="polarion_20" style="text-align: center;" class="polarion-rte-caption-paragraph"> <img src="attachments/44-screenshot-20190403-104913.png" style="width: 582px;height: 380px;"> </p>
  <p id="polarion_27" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">1</span>: Überblick Zwiebelschalenprinzip bei der Ver- und Entschlüsselung </p>
  <p id="polarion_131">Ein wichtiger Aspekt: Das&nbsp;&nbsp; kryptographische Verfahren für die Generierung der spezifischen Schlüssel in den Schlüsselgenerierungsdiensten ist unabhängig von dem aktuell verwendeten Authentisierungsverfahren.&nbsp;Wenn bei der Authentisierung also zukünftig eine elliptische Kurve &nbsp;mit 512-Bit anstatt aktuell einer elliptischen Kurve mit 256-Bit verwendet werden soll (oder ein Quanten-Computing-resistentes Signatur-Verfahren), so ist dies ist für das grundsätzliche Verfahren nicht entscheidend. Die Schlüsselableitungsfunktionalität ist diesbezüglich unabhängig.</p>
  <p id="polarion_152"> Der geheime Ableitungsschlüssel eines Schlüsselgenerierungsdienstes (SGD) wird regelmäßig neu erzeugt, so dass auch dort eine Schlüsseldiversifizierung vorhanden ist. Alte Ableitungsschlüssel müssen in den SGD weiter vorgehalten werden, solange sie potentiell benötigt werden. In einem späteren Release wird die (regelmäßige) Umschlüsselung einer ePA-Akte spezifikatorisch bearbeitet. Bei den SGD gibt es dafür jetzt schon vorbereitende Maßnahmen (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span>, RND-Zufallswert). Bei einem Schlüsselwechsel bei der jeweiligen Akte (Umschlüsselung) muss auch eine neue Einlagerung (Schlüsselableitungsfunktionalität) vorgenommen werden (im Normalfall mittels eines neuen Ableitungsschlüssels). Das sichere Löschen von nicht mehr benötigten Ableitungsschlüsseln (Masterkeys) wird dann in diesem späteren Release ebenfalls&nbsp;spezifikatorisch bearbeitet. Die Ableitungsschlüssel besitzen eindeutige Bezeichner (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17920-02" data-item-id="ML-109460" data-option-id="custom"></span>&nbsp;)&nbsp;und sind unterscheidbar. </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94490">2.2 Akteure und Komponenten</h3>
  <p id="polarion_74">Die beteiligten Akteure sind:</p>
  <p id="polarion_51" data-keep-next="true" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">1</span>: beteiligte Akteure im Kontext Schlüsselableitungsfunktionalität </p>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=5" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 215px;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">Rolle </span> </span></th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 512px;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">Beschreibung</span> </span></th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 215px;height: 69pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">der Versicherte (Kontoinhaber) </span></td> 
     <td style="vertical-align: top;width: 512px;height: 69pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Versicherte nutzt das von seiner Krankenkasse für ihn bereitgestellte ePA-Aktensystem. Er ist Kontoinhaber. Er verwendet entweder ein ePA-FdV (s. u.) für den Aktenzugriff oder berechtigt eine LEI (bzw. in einem späteren Release einen LE) via ad-hoc-Autorisierung über ein FM ePA (s. u.). Dabei verwendet er entweder eine eGK- basierte AUT-Identität oder eine alternative Versichertenidentität zur Authentisierung jeweils am Aktensystem, am SGD 1 (s. u.) und am SGD 2 (s. u.). </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 215px;height: 73px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ein Vertreter </span></td> 
     <td style="vertical-align: top;width: 512px;height: 73px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Ein Vertreter ist ein Versicherter (besitzt also eine eGK oder einen alternative Versichertenidentität) und wurde vom Versicherten (Kontoinhaber) berechtigt, für diesen Handlungen in Bezug auf die ePA vorzunehmen (bspw. LEI im Namen des Kontoinhabers zu berechtigen). </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 215px;height: 83pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">eine Leistungserbringerinstitution (LEI) </span></td> 
     <td style="vertical-align: top;width: 512px;height: 83pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Eine LEI ist von einem Versicherten berechtigt worden, auf dessen Akte zuzugreifen. Nach Anmeldung am Aktensystem und nach der Prüfung der Autorisierung durch das Aktensystem wird an die LEI ein "doppeltes" Chiffrat übergeben, das den Akten- und Kontextschlüssel der Akte des Versicherten enthält. Durch Zugriff auf die beiden SGD (s. u.) inkl. Authentifizierung der LEI erhält diese jeweils einen AES-256-Schlüssel und kann dann im "Zwiebelschalenprinzip" den Akten- und den Kontextschlüssel entschlüsseln. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 215px;height: 29pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ein Kostenträger (KTR) </span></td> 
     <td style="vertical-align: top;width: 512px;height: 29pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Ein Kostenträger wird durch einen Versicherten (Kontoinhaber oder Vertreter) berechtigt, auf ein Aktenkonto zuzugreifen.<br> Nach Anmeldung am Aktensystem und nach der Prüfung der Autorisierung durch das Aktensystem wird an den Client ein "doppeltes" Chiffrat übergeben, das den Akten- und Kontextschlüssel der Akte des Versicherten enthält. Durch Zugriff auf die beiden SGD (s. u.) inkl. Authentifizierung des KTR erhält diese jeweils einen AES-256-Schlüssel und kann dann im "Zwiebelschalenprinzip" den Akten- und den Kontextschlüssel entschlüsseln. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 215px;height: 62px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Anbieter ePA-Aktensystem </span></td> 
     <td style="vertical-align: top;width: 512px;height: 62px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Ein&nbsp;Anbieter ePA-Aktensystem bietet ein&nbsp;ePA-Aktensystem im Auftrag einer Krankenversicherung deren Versicherten (Kontoinhaber) an. Der Anbieter verantwortet den sicheren Betrieb und die Verfügbarkeit des von ihm angebotenen&nbsp;ePA-Aktensystems. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 215px;height: 102pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Anbieter Schlüsselgenerierungsdienst ePA (SGD) </span></td> 
     <td style="vertical-align: top;width: 512px;height: 102pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Ein&nbsp;Anbieter Schlüsselgenerierungsdienst ePA bietet die Nutzung der Schlüsselableitungsfunktionalität an. Für einen Versicherten müssen zwei SGD zur Verfügung stehen: ein SGD, der dem Aktensystem beigestellt ist, und ein SGD außerhalb des Aktensystems. Beide SGD sind technisch, organisatorisch und wirtschaftlich getrennt (Rollenausschluss). Beide SGD sind bis auf die unterschiedlichen jeweils zufällig erzeugten Ableitungsschlüssel technisch identisch, für beide SGD gilt dieselbe Spezifikation. </span></td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_127">Die beteiligten Komponenten und Dienste sind:</p>
  <p id="polarion_258" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">2</span>: beteiligte Komponenten und Dienste&nbsp;im Kontext Schlüsselableitungsfunktionalität </p>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=6" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 210px;height: 14pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">Komponente oder Dienst</span> </span></th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 517px;height: 14pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">Beschreibung</span> </span></th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 210px;height: 125px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ePA-Frontend des Versicherten (ePA-FdV) </span></td> 
     <td style="vertical-align: top;width: 517px;height: 125px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Das ePA-FdV tritt als Client gegenüber den beiden SGD (s. u.) auf. Von diesen beiden erhält es jeweils einen versichertenindividuellen geheimen&nbsp;Schlüssel (AES-256). Mit diesen beiden Schlüsseln werden nach der initialen zufälligen Erzeugung von Akten- und Kontextschlüssel im Client diese in ein interoperables Austauschformat kodiert und anschließend zwei Mal hintereinander verschlüsselt. Das "doppelte" Chiffrat übergibt das ePA-FdV an das ePA-Aktensystem (Komponente Autorisierung) zur Einlagerung. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 210px;height: 29px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Fachmodul ePA (FM ePA) im Konnektor einer LEI oder eines LE </span></td> 
     <td style="vertical-align: top;width: 517px;height: 29px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Das FM ePA tritt als Client gegenüber den beiden SGD (s. u.) auf. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 210px;height: 26px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Fachmodul ePA im KTR-Consumer (FM ePA KTR) </span></td> 
     <td style="vertical-align: top;width: 517px;height: 26px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Das FM ePA tritt als Client gegenüber den beiden SGD (s. u.) auf. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 210px;height: 10px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ePA-Aktensystem </span></td> 
     <td style="vertical-align: top;width: 517px;height: 10px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Das ePA-Aktensystem stellt dem Versicherten eine ePA zur Verfügung. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 210px;height: 92px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ePA-Aktensystem, Zugangsgateway des Versicherten (ZGdV) </span></td> 
     <td style="vertical-align: top;width: 517px;height: 92px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Das ZGdV nimmt Anfragen von ePA-FdV über seine HTTPS-Schnittstelle an und leitet diese Anfragen für bestimmte Pfadnamen, nämlich /SGD1 und /SGD2, im HTTP-Request jeweils an den SGD 1 oder den SGD 2 weiter. Welchen SGD welcher Anbieter verwendet, wird initial bei der Inbetriebnahme des Aktensystems festgelegt (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94498" data-option-id="longoutline"></span>).</span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 210px;height: 50px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ePA-Aktensystem, Komponente Autorisierung </span></td> 
     <td style="vertical-align: top;width: 517px;height: 50px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die "Komponente&nbsp;Autorisierung" bewahrt den "doppelt" verschlüsselten Akten- und Kontextschlüssel (AuthorizationKey-Datenstruktur) auf. Sie übergibt diese Datenstruktur nach erfolgreicher Anmeldung eines Client an diesen. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 210px;height: 83pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">SGD 1<br> als FAD </span></td> 
     <td style="vertical-align: top;width: 517px;height: 83pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Dem ePA-Aktensystem beigestellt gibt es einen SGD. Dieser ist unter dem Pfadnamen /SGD1 über das ZGdV für alle Clients ansprechbar. Der SGD generiert auf Nutzeranfrage verschiedene versichertenindividuelle AES-256-Schlüssel.<br> <br> Durch technische Maßnahmen wird dabei mit hoher Sicherheit ausgeschlossen, dass ein Betreiber eines SGD diese Schlüssel ermitteln kann. </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 210px;height: 26px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">SGD 2<br> der TIP </span></td> 
     <td style="vertical-align: top;width: 517px;height: 26px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Als Teil der zentralen TI ist dieser SGD&nbsp;unter dem Pfadnamen /SGD2 über das ZGdV für alle Clients ansprechbar. Für beide SGD (1 und 2) gilt dieselbe Spezifikation. </span></td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_107"></p>
  <p id="polarion_35">Die folgende Grafik gibt einen Überblick über die beteiligten Komponenten und Dienste.</p>
  <p id="polarion_63" style="text-align: center;" class="polarion-rte-caption-paragraph"> <img src="attachments/51-screenshot-20190419-122758.png" style="width: 582px;height: 503px;"> </p>
  <p id="polarion_64" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">2</span>: beteiligte Komponenten und Dienste im Kontext der Schlüsselableitungsfunktionalität ePA </p>
  <p id="polarion_69"> Ein SGD 1 und ein SGD 2 sind fachlich gesehen baugleich – bis auf die eingesetzten geheimen und privaten Schlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;&nbsp;(S1), (S3), (S4) und (S5)) und ihre Identität (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17848" data-item-id="ML-94622" data-option-id="custom"></span>&nbsp;)&nbsp;unterscheiden sie sich nicht. Insbesondere benötigt ein SGD keine Informationen aus dem ePA-Aktensystem. </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94491">2.3 Basisablauf Kommunikation SGD-Client und SGD</h3>
  <p id="polarion_105"> Ein Client aus dem Internet (also ein ePA-FdV) erreicht einen SGD über das ZGdV des ePA-Aktensystems (vgl.&nbsp;<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_Zugangsgateway_Vers#Proxy Schlüsselgenerierungsdienst]" data-url="/wiki/Spezifikation/gemSpec_Zugangsgateway_Vers?selection=ML-93876"></span>). Solch ein Client verwendet die auch für die Kommunikation mit dem Aktensystem verwendete HTTPS-Schnittstelle des ZGdV. Das ZGdV leitet HTTP-Requests mit dem Pfadname /SGD1 an die HTTPS-Schnittstelle des SGD 1 weiter (eigenständige TLS-Verbindung zwischen ZGdV und SGD). Analog tut das ZGdV dies für Requests mit dem Pfadnamen /SGD2 in Bezug auf den SGD 2. Auf Applikationsebene gibt es eine Ende-zu-Ende-Verschlüsselung zwischen den Clients und den SGD-HSMs der SGDs (vgl. Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94770" data-option-id="shortoutline"></span>&nbsp;). </p>
  <p id="polarion_285"> Ein Client aus der TI (FM ePA etc.) spricht die beiden SGD über deren HTTPS-Schnittstellen (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17889" data-item-id="ML-94687" data-option-id="custom"></span>) direkt an. Die IP-Adressen erfahren solche Clients über DNS-Service-Discovery.&nbsp; </p>
  <p id="polarion_39"> Der grundsätzliche Ablauf einer Anfrage (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span>&nbsp;ff) ist in Bezug auf das Kommunikationsmuster bezüglich der beiden SGD immer gleich und wird im Folgenden beschrieben. Zur Vereinfachung der Darstellung ist der Ablauf sequenziell dargestellt. Für eine Performanzsteigerung muss ein Client die Anfragen an die beiden SGD parallelisieren (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17925" data-item-id="ML-94728" data-option-id="custom"></span>&nbsp;), was bis auf Schritt 6 leicht möglich ist. Eine noch detaillierte Erläuterung zu den kryptographischen Grundlagen der Kommunikation befindet sich in Abschnitt&nbsp;"<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94770" data-option-id="longoutline"></span>". </p>
  <p id="polarion_70"> <span style="font-weight: bold;">Schritt 1:</span> </p>
  <p id="polarion_119"> Der Client verwendet die HTTPS-Schnittstelle des ZGdV, oder falls er aus Netzwerksicht Teil der TI ist (FM ePA etc.) die HTTPS-Schnittstelle eines SGD direkt, um den aktuellen öffentlichen ECIES-Schlüssel des SGD 1 zu erhalten (Pfadname der URL ist "/SGD1") (vgl. Schnittstelle "<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-93990" data-option-id="longoutline"></span>&nbsp;"). Das ZGdV leitet den HTTP-Request (HTTPS) an den SGD 1 weiter. </p>
  <p id="polarion_120"> <span style="font-weight: bold;">Schritt 2:</span> </p>
  <p id="polarion_121"> Der SGD 1 antwortet mit dem aktuellen authentisierten öffentlichen ECIES-Schlüssel des für den Nutzer (AUT-Zertifikat) avisierten SGD-HSM innerhalb des SGD 1 (vgl. A_17894-01&nbsp;). Dieser Schlüssel ändert sich alle 15 Minuten und ist dann jeweils für 30 Minuten für alle anfragenden Clients verwendbar. Der ECIES-Schlüssel des SGD-HSM ist durch das SGD-HSM signiert (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;&nbsp;(S1)). </p>
  <p id="polarion_122"> <span style="font-weight: bold;">Schritt 3:</span> </p>
  <p id="polarion_201"> Der Client prüft das Zertifikat, die Signatur und den ECIES-Schlüssel des SGD-HSM von SGD 1 (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18024" data-item-id="ML-96280" data-option-id="custom"></span>). Er prüft dabei u. a., dass die Antwort von einem SGD-1-SGD-HSM kam. </p>
  <p id="polarion_305"> <span style="font-weight: bold;">Schritt 4:</span> </p>
  <p id="polarion_29">Der Client erfragt analog zu Schritt 1 den aktuellen authentisierten öffentlichen ECIES-Schlüssel von SGD 2 (Pfadname der URL ist "/SGD2").</p>
  <p id="polarion_30"> <span style="font-weight: bold;">Schritt 5:</span> </p>
  <p id="polarion_31">Der SGD 2 antwortet analog zu Schritt 2 mit dem signierten ECIES-Schlüssel des für den Nutzer vorgesehenen SGD-HSM innerhalb von SGD 2 (vgl. A_17894-01&nbsp;).</p>
  <p id="polarion_32"> <span style="font-weight: bold;">Schritt 6:</span> </p>
  <p id="polarion_306"> Der Client prüft analog zu Schritt 3 das Zertifikat, die Signatur und den ECIES-Schlüssel des SGD-HSM von SGD 2 (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18024" data-item-id="ML-96280" data-option-id="custom"></span>).&nbsp;Er prüft dabei u. a.,&nbsp;dass die Antwort von einem SGD-2-SGD-HSM kam. </p>
  <p id="polarion_308"> <span style="font-weight: bold;">Schritt 7:</span> </p>
  <p id="polarion_309">Der&nbsp;Client berechnet die Hashwerte der erhaltenen ECIES-Schlüsselwerte der beiden SGD-HSM aus Schritt 3 und Schritt 6.</p>
  <p id="polarion_310"> <span style="font-weight: bold;">Schritt 8:</span> </p>
  <p id="polarion_33"> Der Client erzeugt ein kurzlebiges&nbsp;ECIES-Schlüsselpaar ( [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17874" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94671"></span>]), was der Client später für die Request an SGD 1 und SGD 2 verwenden wird. Der Client führt den öffentlichen Client-ECIES-Schlüssel zusammen mit den Hashwerten aus Schritt 7 in ein Kodierung gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span> auf und signiert diese Kodierung mittels des AUT-Materials der eGK, der SMC-B, der SMC-KTR oder der alternativen Authentisierung. </p>
  <p id="polarion_166"> <span style="font-weight: bold;">Schritt 9:</span> </p>
  <p id="polarion_311">Der Client verwendet die Operation GetAuthenticationToken bei SGD 1 um ein Authentisierungstoken zu erhalten. Dafür erzeugt der Client einen Zufallswert (Challenge) und sendet diesen verschlüsselt an das für ihn vorgesehene SGD-HSM bei SGD 1.</p>
  <p id="polarion_312"> <span style="font-weight: bold;">Schritt 10:</span> </p>
  <p id="polarion_313">Die RVE innerhalb von SGD 1 prüft das AUT-Zertifikat, die Client-Signatur des Client-ECIES-Schlüssels und den Client-ECIES-Schlüssel. Falls alle Prüfungen ein OK liefern, bereitet die RVE den Request auf (OCSP-Responses, Umkodierung für die Innenschnittstelle zum den SGD-HSM etc.) und übergibt die verschlüsselte Nachricht an das SGD-HSM. Das SGD-HSM prüft ebenfalls das AUT-Zertifikat, die Client-Signatur des Client-ECIES-Schlüssels und den Client-ECIES-Schlüssel und erstellt ein Authentisierungstoken. Das SGD-HSM erstellt eine Nachricht, die die Challenge des Client, einen Hashwert (des Client-Schlüssels und des AUT-Zertifikats) und das erzeugte Authentisierungstoken enthält. Diese Nachricht verschlüsselt das SGD-HSM für den Client-ECIES-Schlüssel und übergibt das Chiffrat an die RVE. Diese kodiert die Nachricht um und antwortet dem Client.</p>
  <p id="polarion_315"> <span style="font-weight: bold;">Schritt 11:</span> </p>
  <p id="polarion_316">Der Client entschlüsselt die Nachricht des SGD-HSM von SGD 1. In der entschlüsselten Nachricht prüft, es ob seine Challenge enthalten ist. Falls ja, kann es davon ausgehen, dass die Antwort wirklich vom SGD-HSM stammt. Es prüft den Hashwert (des Client-Schlüssels und des AUT-Zertifikats) und speichert das Authentisierungstoken für die folgende Verwendung innerhalb der Operation KeyDerivation.</p>
  <p id="polarion_317"> <span style="font-weight: bold;">Schritt 12:</span> </p>
  <p id="polarion_318"> Der Client erzeugt zufällig eine Request-ID, anschließend eine Nachricht. Diese enthält das Authentisierungstoken, die Request-ID und die je nach Anwendungsfall (vgl. Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span>&nbsp;ff) unterschiedliche Ableitungsregel. Diese Nachricht verschlüsselt der Client für das SGD-HSM und verwendet die Operation KeyDerivation von SGD 1. </p>
  <p id="polarion_319"> <span style="font-weight: bold;">Schritt 13:</span> </p>
  <p id="polarion_320"> Die RVE innerhalb von SGD 1 prüft das AUT-Zertifikat, die Client-Signatur des Client-ECIES-Schlüssels und den Client-ECIES-Schlüssel. (Hinweis: die RVE cacht die Prüfergebnisse (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17896" data-item-id="ML-94695" data-option-id="custom"></span>).) Falls alle Prüfungen ein OK liefern, bereitet die RVE den Request auf (OCSP-Responses, Umkodierung für die Innenschnittstelle zum den SGD-HSM etc.) und übergibt die verschlüsselte Nachricht an das SGD-HSM. Das SGD-HSM entschlüsselt die Nachricht des Client und überprüft, ob das Authentisierungstoken konsistent mit dem Client-ECIES-Schlüssel und dem AUT-Zertifikat des Client ist. Falls ja überprüft es die Ableitungsregel und führt, falls der Client berechtigt ist, die Schlüsselableitung durch. Das Ergebnis verschlüsselt inkl. Authentisierungstoken, Request-ID und Ableitungsvektor das SGD-HSM für den Client. Das Chiffrat übergibt das SGD-HSM an die RVE, die es nach Umkodierung an den Client als Response weiterleitet. </p>
  <p id="polarion_124">Die Schritte 14 bis 20 (siehe folgende Tabelle) sind analog zu den Schritten 9 bis 13, nur findet die Kommunikation zwischen Client und SGD 2 statt.</p>
  <p id="polarion_128"></p>
  <p id="polarion_71" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">3</span>: Tab_Übersicht_der_Kommunikationsschritte_eines_SGD-Clients </p>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=305" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">Nr.</span> </span></th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">SDG-Client</span> </span></th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">SGD 1</span> </span></th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">SGD 2</span> </span></th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">1 </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation GetPublicKey bei SGD 1 aufrufen<br> Eingabe:<br> AUT-Zertifikat des Nutzers</span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">2 </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation GetPublicKey<br> Aktion:<br> Prüfung des AUT-Zertifikats des Nutzers<br> Ausgabe:<br> aktueller signierter öffentlicher ECIES-Schlüssel des für den Nutzer avisierten SGD-HSM innerhalb des SGD 1</span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">3<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Prüfung des Zertifikats, der Signatur und des öffentlichen Schlüssels des SGD-HSM von SGD 1</span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">4<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation GetPublicKey bei SGD 2 aufrufen<br> Eingabe:<br> AUT-Zertifikat des Nutzers</span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">5 </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation GetPublicKey<br> Ausgabe:<br> aktueller signierter öffentlicher ECIES-Schlüssel des für den Nutzer avisierten SGD-HSM innerhalb des SGD 2</span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">6<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Prüfung des Zertifikats, der Signatur und des öffentlichen Schlüssels des SGD-HSM von SGD 2</span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">7<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Berechnung der Hashwerte der öffentlichen ECIES-Schlüssel der beiden SGD-HSMs </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">8<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Erzeugung des Client-ECIES-Schlüsselpaars und Signatur des öffentlichen Schlüssel inkl. der Hashwerte aus Schritt 7 mittels eGK, SMC-B, SMC-KTR&nbsp;oder alternativer Authentisierung. </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">9<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation GetAuthenticationToken bei SGD 1<br> Eingabe:<br> für SGD-HSM verschlüsselte Challenge (Zufallswert),<br> AUT-Zertifikat, signierte Schlüssel aus Schritt&nbsp;8 </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">10<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation GetAuthenticationToken<br> Aktion:<br> Prüfung des AUT-Zertifikats,<br> Prüfung des Client-Signatur,<br> Prüfung des Client-ECIES-Schlüssels,<br> Entschlüsselung der Nachricht<br> Ausgabe:<br> Für den öffentlichen Client-ECIES-Schlüssel verschlüsselte Response.<br> Innerhalb der Response befinden sich die Challenge des Clients (Zufallswert), das erzeugte Authentisierungstoken und der Hashwert des öffentlichen Client und des AUT-Zertifikats des Client.</span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">11<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Entschlüsselung der Antwort.<br> Vergleich Challenge (Zufallswert) mit dem Wert aus der Response,<br> Vergleich des Hashwerts mit dem selbst erzeugten Hashwert,<br> Authentisierungstoken für SGD 1 lokal für die folgende Operation KeyDerivation zwischenspeichern</span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">12<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation KeyDerivation bei SGD 1 aufrufen<br> Eingabe:<br> für SGD-HSM verschlüsselte Nachricht:<br> Authentisierungstoken, zufällige Request-ID des Client, Ableitungsregel</span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">13<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation KeyDerivation<br> Aktion:<br> Prüfung Authentisierungstoken<br> Ergebnis der Schlüsselableitung (vgl. Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span>&nbsp;ff) inkl. Prüfung der Berechtigung für die angeforderte Schlüsselableitung berechnen<br> Ausgabe:<br> für den öffentlichen Client-ECIES-Schlüssel verschlüsseltes Ergebnis der Schlüsselableitung </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">14<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Entschlüsselung der Antwort.<br> Vergleich des Authentisierungstokens und der Request-ID in der Antwort mit den Werten aus dem Request,<br> Auslesen des abgeleiteten AES-256-Schlüsselwerts der vom SGD-HSM für den Client abgeleitet wurde, ggf. Auslesen des Ableitungsvektors </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">15<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation GetAuthenticationToken bei SGD 2 aufrufen, analog zu Schritt 9 </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">16<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation GetAuthenticationToken<br> analog zu Schritt 10 bei SGD 1 </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">17<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Entschlüsselung der Antwort.<br> Prüfungen analog zu Schritt 11 </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">18<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation KeyDerivation bei SGD 2 aufrufen </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">19<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Operation KeyDerivation<br> analog zu Schritt 13 bei SGD 1 </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">20<br> </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Entschlüsselung der Antwort.<br> Prüfungen analog zu Schritt 14 </span></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;height: 9pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_322"> Der Client verwendet die erhaltenen beiden AES-256-Schlüssel je nach Anwendungsfall entweder für die Ver- oder die Entschlüsselung des&nbsp;Akten- und des Kontextschlüssels unter Verwendung des interoperablen Austauschformats nach Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94583" data-option-id="longoutline"></span>&nbsp;. Dabei befinden sich die verwendeten Ableitungsvektoren innerhalb der "associated data" (AD), so dass später die ausgeführte Aktion durch einen autorisierten Client reproduzierbar ist. </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94493">2.4 Initiale Schlüsselableitung für den Kontoinhaber</h3>
  <p id="polarion_158"> Ein Versicherter (Kontoinhaber) eröffnet ein Konto und der verwendete Client (entweder das ePA-FdV oder das FM ePA) erzeugt den Akten- und Kontextschlüssel. Anschließend durchläuft der Client die Schritte 1 bis 20 aus Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94491" data-option-id="longoutline"></span>&nbsp;. Als Nachricht (verschlüsselte "EncryptedMessage" in&nbsp;&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898, Tab_KeyDerivation-Request" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;) an die beiden SGD sendet der Client dabei jeweils eine Nachricht der Form </p>
  <p id="polarion_139" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt; &lt;Request-ID&gt;&nbsp;KeyDerivation r1:&lt;KVNR&gt; </span> </p>
  <p id="polarion_187">und erhält jeweils eine Antwort der Form</p>
  <p id="polarion_140" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt; &lt;Request-ID&gt;&nbsp;OK-KeyDerivation &lt;AES-256-Bit-Schlüssel-in-Hexform&gt; r1:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR&gt;:&lt;aktueller Ableitungsschlüsselbezeichner&gt; </span> </p>
  <p id="polarion_154"> Die beiden nun erhaltenen AES-256-Schlüssel verwendet der Client zur zweifachen Verschlüsselung des von ihm erzeugten Akten- und Kontextschlüssel im "Zwiebelschalenprinzip" unter Verwendung des interoperablen Austauschformats nach Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94583" data-option-id="longoutline"></span>&nbsp;. Dabei verwendet der Client jeweils die beiden von den SGD erhaltenen Teilzeichenketten der Form&nbsp;<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r1:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR&gt;:&lt;Ableitungsschlüsselbezeichner&gt;"</span>&nbsp;als "associated data" (AD) bei der Kodierung. Dieses entsprechend erzeugte und kodierte Chiffrat schickt der Client an die "Komponente Autorisierung" zur Einlagerung im Aktensystem. </p>
  <p id="polarion_179"> Bei einer Umschlüsselung des Akten- und Kontextschlüssels bei einem späteren ePA-Release (vgl. Ende von Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94489" data-option-id="longoutline"></span>&nbsp;) wird aufgrund des Einflusses der &nbsp;jeweils vom SGD gewählten RND-Daten ein anderer Schlüssel generiert. Damit ist ein SGD nach aktueller Spezifikation schon jetzt auf diese Umschlüsselungsfunktionalität in Bezug auf die Client-Schnittstelle vorbereitet. </p>
  <p id="polarion_243">Hinweis: in den folgenden Sequenzdiagrammen wird auf die Aufführung des Authentisierungstokens und der Request-ID in der Nachricht (Message) an die SGD verzichtet.</p>
  <p id="polarion_244" style="text-align: center;" data-keep-next="true"> <img data-keep-next="true" src="attachments/1a_-_Schlüsselableitung_durch_einen_Versicherten__initial_.png" style="width: 582px;height: 628px;"> </p>
  <p id="polarion_80" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">3</span>:&nbsp;Initiale Schlüsselableitung für den Kontoinhaber </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94492">2.5 Schlüsselableitung durch den Kontoinhaber</h3>
  <p id="polarion_210"> Der Versicherte (Kontoinhaber) meldet sich beim Aktensystem an und erhält nach erfolgreicher Authentifizierung und Autorisierung die "AuthorizationKey"-Datenstruktur vom Aktensystem. Darin befindet sich das zweifach verschlüsselte Chiffrat aus Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span>. Dort kann der Client aus den AD, durch Leerzeichen getrennt, jeweils den Ableitungsvektor für den SGD 1 und für den SGD 2 auslesen. Diese haben jeweils folgende Form: </p>
  <p id="polarion_199" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">r1:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR&gt;:&lt;Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_268">Der Client sendet eine Nachricht der Form</p>
  <p id="polarion_155" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;KeyDerivation r1:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR&gt;:&lt;Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_156"> einmal an den SGD 1 und einmal an den SGD 2, jeweils mit den SGD-spezifischen Ableitungsvektoren. Nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17925" data-item-id="ML-94728" data-option-id="custom"></span>&nbsp;müssen die Abfragen zur Generierung der beiden Schlüssel durch den Client parallelisiert werden.&nbsp;Das SGD-HSM prüft die Authentizität der Nachricht und verwendet u. a.&nbsp; die KVNR des Versicherten bei der Schlüsselableitung (versichertenindividuelle Schlüsselableitung).&nbsp;Der Client erhält die beiden gleichen AES-256-Schlüssel, die er wie zuvor in Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span> erhalten hat. Die Antwort der SGD ist dabei analog zu&nbsp;Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span> der folgenden </p>
  <p id="polarion_40" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;OK-KeyDerivation &lt;AES-256-Bit-Schlüssel-in-Hexform&gt; r1:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR&gt;:&lt;aktueller Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_136"> Nachdem beide Schlüssel (je einer aus SGD 1 und aus SGD 2) vorliegen, entschlüsselt der Client <span style="font-size: 10pt;line-height: 1.5;">(vgl.&nbsp;</span><span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_Krypt#A_17872]" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94669"></span><span style="font-size: 10pt;line-height: 1.5;">&nbsp;)</span> das zweifach verschlüsselte Chiffrat im "Zwiebelschalenprinzip" mittels AES-GCM. Dabei prüft es die Authentizität der Chiffrats und der AD (Authenticated Encryption with Associated Data (AEAD)) bzw. damit auch die Authentizität des erhaltenen Klartextes.&nbsp; </p>
  <p id="polarion_180"> Im Nicht-Fehlerfall liegen danach der Akten- und Kontext-Schlüssel in der Kodierung nach <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17930" data-item-id="ML-94737" data-option-id="custom"></span>&nbsp;vor. </p>
  <p id="polarion_220">Dieses Vorgehen funktioniert unabhängig davon, ob der Versicherte seine eGK (oder alternative Versichertenidentität) wie bei der Aktenkontoeröffnung oder eine Folgekarte (oder "Folge"-Identität) verwendet.</p>
  <p id="polarion_234"></p>
  <p id="polarion_235" style="text-align: center;" data-keep-next="true"> <img data-keep-next="true" src="attachments/1b_-_Schlüsselableitung_durch_Versicherten.png" style="width: 582px;height: 453px;"> </p>
  <p id="polarion_87" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">4</span>:&nbsp;Schlüsselableitung durch den Kontoinhaber </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94494">2.6 Schlüsselableitung für einen Berechtigungsempfänger</h3>
  <p id="polarion_37">Für das Berechtigen eines Vertreters, einer LEI oder eines KTR durch den Kontoinhaber muss der Client des Kontoinhabers den Akten- und Kontextschlüssel für einen Berechtigungsempfänger verschlüsselten im Aktensystem hinterlegen. Hierfür liegen der Akten- und Kontextschlüssel&nbsp;temporär im Client des Kontoinhabers im Klartext vor. Der Client fragt jeweils SGD 1 und SDG 2 für eine für diesen Anwendungsfall spezifische Schlüsselableitung (r2) an.</p>
  <p id="polarion_115">Der Client sendet jeweils eine Nachricht der Form</p>
  <p id="polarion_213" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;KeyDerivation r2:&lt;KVNR-Vertreter oder Telematik-ID&gt;</span> </p>
  <p id="polarion_214">an beide SGD und erhält jeweils eine Antwort der Form</p>
  <p id="polarion_219" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;OK-KeyDerivation &lt;AES-256-Bit-Schlüssel-in-Hexform&gt; r2:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter oder Telematik-ID&gt;:&lt;aktueller Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_222"> Mit beiden erhaltenen Schlüsseln verschlüsselt der Client den Akten- und Kontextschlüssel und kodiert nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17930" data-item-id="ML-94737" data-option-id="custom"></span>&nbsp;das zweifach verschlüsselte Chiffrat. Dabei werden die Ableitungsinformationen ebenfalls authentitäts- und integritätsgeschützt (AEAD). Die vom Client erzeugte Datenstruktur wird im Aktensystem für den Berechtigungsempfänger hinterlegt. </p>
  <p id="polarion_246"></p>
  <p id="polarion_247" style="text-align: center;" data-keep-next="true"> <img data-keep-next="true" src="attachments/2a_-_Schlüsselableitung_für_einen_Berechtigungsempfänger.png" style="width: 582px;height: 642px;"> </p>
  <p id="polarion_90" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">5</span>:&nbsp;Schlüsselableitung für einen Berechtigungsempfänger </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94739">2.7 Schlüsselableitung durch einen Berechtigten</h3>
  <p id="polarion_228">Ein Vertreter, eine LEI bzw. ein KTR meldet sich am Aktensystem an und erhält die AuthorizationKeys-Datenstruktur. Dort befindet sich das zuvor vom Versicherten hinterlegte zweifach verschlüsselte Chiffrat mit dem verschlüsselten&nbsp;Akten- und Kontextschlüssel. In den AD sind die Ableitungsinformationen enthaltenen, die ein Client für die Anfragen an die beiden SGD benötigt. Der Client sendet jeweils an die SGD eine Nachricht der folgenden Form</p>
  <p id="polarion_229" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;KeyDerivation r2:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter oder Telematik-ID&gt;:&lt;Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_230">und erhält jeweils eine Antwort der Form</p>
  <p id="polarion_231" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;OK-KeyDerivation &lt;AES-256-Bit-Schlüssel-in-Hexform&gt; r2:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter oder Telematik-ID&gt;:&lt;Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_232"> Das SGD-HSM prüft, ob im vierten Feld der Ableitungsinformationen "<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&lt;KVNR-Vertreter oder Telematik-ID&gt;</span>" zu den authentischen Angaben passt, die im Zertifikat der Anfrage stehen (plus Signaturprüfung, Sperrstatus u. v. m.). Bei erfolgreicher Prüfung führt das SGD-HSM die Ableitung durch und übergibt dem Client die generierten Schlüssel über den verschlüsselten und beidseitig authentisierten Datenkanal zwischen Client und SGD-HSM. </p>
  <p id="polarion_233">Der Client kann nun das zweifach verschlüsselte Chiffrat entschlüsseln und ihm stehen der Akten- und der Kontextschlüssel zur Verfügung.</p>
  <p id="polarion_249"></p>
  <p id="polarion_250" style="text-align: center;" data-keep-next="true"> <img data-keep-next="true" src="attachments/2b_-_Schlüsselableitung_durch_einen_Berechtigten.png" style="width: 582px;height: 574px;"> </p>
  <p id="polarion_91" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">6</span>: Schlüsselableitung durch einen Berechtigten </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94738">2.8 Schlüsselableitung für einen Berechtigungsempfänger durch einen Vertreter</h3>
  <p id="polarion_223">Der Vertreter ist am Aktensystem angemeldet und möchte im Rahmen seiner Vertretungstätigkeit im Aktensystem eine LEI oder einen KTR berechtigen. Dafür muss der Client des Vertreters den Akten- und den Kontextschlüssel der Akte des Kontoinhabers&nbsp;für den Berechtigungsempfänger verschlüsselt hinterlegen.</p>
  <p id="polarion_236">Der Client sendet jeweils die Nachricht</p>
  <p id="polarion_224" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;KeyDerivation r3:&lt;Telematik-ID&gt;:&lt;KVNR-Kontoinhaber&gt;</span> </p>
  <p id="polarion_225">und erhält jeweils eine Antwort der Form</p>
  <p id="polarion_226" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;OK-KeyDerivation &lt;AES-256-Bit-Schlüssel-in-Hexform&gt; r3:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter&gt;:&lt;Telematik-ID&gt;:&lt;aktueller Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_227"> Mit den beiden von den SGD erhaltenen Schlüsseln verschlüsselt der Client den Akten- und Kontextschlüssel und bildet eine Datenstruktur gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17930" data-item-id="ML-94737" data-option-id="custom"></span>. Diese wird für den Berechtigungsempfänger im Aktensystem hinterlegt. </p>
  <p id="polarion_252"></p>
  <p id="polarion_253" style="text-align: center;" data-keep-next="true"> <img data-keep-next="true" src="attachments/3a_-_Schlüsselableitung_für_einen_Berechtigungsempfänger_durch_einen_Dritten.png" style="width: 582px;height: 668px;"> </p>
  <p id="polarion_92" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">7</span>: Schlüsselableitung für einen Berechtigungsempfänger durch einen Vertreter </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94741">2.9 Schlüsselableitung für einen durch einen Vertreter berechtigten Berechtigten</h3>
  <p id="polarion_157"> Analog zu Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94739" data-option-id="shortoutline"></span>&nbsp;verwendet der Client der LEI die AuthorizationKeys-Datenstruktur und die darin befindlichen AD. Der Client verwendet die Ableitungsvektoren aus den AD (diese werden mit "r3:" beginnen). Mit diesen beiden Ableitungsvektoren fragt der Client parallel jeweils SGD &nbsp;1 und SGD 2 an, jeweils mit einer Nachricht der Form </p>
  <p id="polarion_2" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;KeyDerivation r3:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter&gt;:&lt;Telematik-ID&gt;:&lt;aktueller Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_76">und erhält jeweils eine Antwort der Form</p>
  <p id="polarion_111" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">AT&lt;256-Bit-Authentisierungstokenwert-in-Hexform&gt;&nbsp;&lt;Request-ID&gt;&nbsp;OK-KeyDerivation &lt;AES-256-Bit-Schlüssel-in-Hexform&gt; r3:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter&gt;:&lt;Telematik-ID&gt;:&lt;aktueller Ableitungsschlüsselbezeichner&gt;</span> </p>
  <p id="polarion_237"> Dabei prüft das SGD-HSM innerhalb eines SGD zuvor, ob das Datenfeld <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"&lt;Telematik-ID&gt;"</span> in den Ableitungsinformationen&nbsp;zu den authentischen Angaben passt, die im Zertifikat der Anfrage stehen (plus Signaturprüfung, Sperrstatus u. v. m.). Bei erfolgreicher Prüfung führt das SGD-HSM die Ableitung durch und übergibt dem Client die generierten Schlüssel über den verschlüsselten und beidseitig authentisierten Datenkanal. </p>
  <p id="polarion_241">Der Client kann nun das zweifach verschlüsselte Chiffrat entschlüsseln und ihm stehen der Akten- und der Kontextschlüssel zur Verfügung.</p>
  <p id="polarion_255"></p>
  <p id="polarion_256" style="text-align: center;" data-keep-next="true"> <img data-keep-next="true" src="attachments/3b_-_Schlüsselableitung_durch_einen_vom_Dritten_berechtigten_Berechtigten.png" style="width: 582px;height: 552px;"> </p>
  <p id="polarion_96" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">8</span>: Schlüsselableitung für einen durch einen Vertreter berechtigten Berechtigten </p>
  <p id="polarion_110" class="polarion-rte-caption-paragraph"></p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94496">2.10 Nichtspeicherung von Versichertendaten</h3>
  <p id="polarion_159"> Ein SGD speichert keine versichertenspezifischen Daten. Die Berechnung der versichertenindividuellen Schlüssel ist eine kryptographische Berechnung (Schlüsselableitung) auf Grundlage des jeweiligen SGD-spezifischen Ableitungsschlüssels und vom Client authentisiert übergebener Ableitungsvektoren. Ein solcher versichertenindividueller Schlüssel wird nur nach erfolgreicher Authentifizierung eines anfragenden Versicherten berechnet und nach der verschlüsselten Übertragung an den Versicherten sofort wieder im SGD-HSM gelöscht. Für den Aufbau des beidseitig authentisierten verschlüsselten Datenkanals zwischen SGD-HSM und Client wird das AUT-Zertifikat des Nutzes (bspw. des Versicherten) kurzzeitig benötigt. Dieses Zertifikat wird vom SGD nicht persistent gespeichert (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17965" data-item-id="ML-94843" data-option-id="custom"></span>&nbsp;). </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94707">2.11 Besondere Rolle SGD-HSM</h3>
  <p id="polarion_185">Das SGD-HSM mit seinem speziellen HSM-Firmware-Modul und den begleitenden technischen und organisatorischen Prozessen ermöglicht es mit hoher Sicherheit, eine durch den Betreiber bestimmte Schlüsselableitung innerhalb des SGD auszuschließen. Das SGD-HSM entscheidet, ob eine ausreichende Authentifizierung stattgefunden hat und führt erst danach die Schlüsselableitung durch. Anschließend überträgt es die abgeleiteten spezifischen Schlüssel über einen beidseitig authentisierten und verschlüsselten Datenkanal (Ende-zu-Ende-Sicherheit) zum Client.</p>
  <p id="polarion_186">Damit dies möglich wird, muss man auf die Einschränkungen der Embedded-Umgebung, in dem das SGD-HSM-Firmware arbeitet, eingehen:</p>
  <ol id="polarion_189"> 
   <li>Die Performanzvorgaben verbieten ähnlich wie in einer Chipkarte die Verwendung eines Ende-zu-Ende geführten TLS-Kanals. Bei Chipkarten verwendet man anstatt eines TLS-Kanals ein Secure-Messaging (Anwendung VSDM). &nbsp;Die Ende-zu-Ende-verschlüsselte Datenverbindung zwischen Client und SGD-HSM verwendet das ECIES-Verfahren (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94770" data-option-id="longoutline"></span>) für das es einen kryptographischen Sicherheitsbeweis gibt.<br> Zusammen mit den alle 15 Minuten wechselnden ECIES-Verbindungsschlüsseln eines SGD-HSM ermöglicht dieses Vorgehen die in Bezug auf die Clients zustandslose Abarbeitung von Requests innerhalb des SGD-HSMs.</li> 
   <li>Ähnlich wie die Zertifikatsprüfung in einer Chipkarte kann die Zertifikatsprüfung im SGD-HSM nicht auf der relativ komplexen TSL-Auswertung basieren. Anstatt der TSL-Auswertung wird u. a. die Rückführbarkeit zur X.509-Root der TI und weiteren im SGD-HSM sicher gespeicherten CA-Zertifikaten der TI bei der Zertifikatsprüfung verwendet (vgl. Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94534" data-option-id="longoutline"></span>&nbsp;).</li> 
  </ol>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94497">3 Übergreifende Festlegungen</h2>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94498">3.1 Beziehung zwischen ePA-Aktensystem und SGD</h3>
  <p id="polarion_67"> Für einen Versicherten müssen zwei unabhängige SGD-Instanzen zur parallelen Nutzung für die zweifache Schlüsselgenerierung zur Verfügung stehen. Beide SGD müssen dabei technisch, organisatorisch und wirtschaftlich unabhängig sein. Um dies sicherzustellen, gibt es einen SGD, den alle Aktensysteme als SGD 2 verwenden (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17881" data-item-id="ML-94679" data-option-id="custom"></span>).&nbsp; </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94679|layout=1">
   <p><b>A_17881</b></p>
   <p>Der Anbieter des Schlüsselgenerierungsdienstes der zentralen TI-Plattform MUSS unabhängig von Anbietern von ePA-Aktensystemen sein, d. h. es sind mindestens jeweils eigenständige Rechtspersönlichkeiten mit eigenständigen operativen Geschäfts- und Betriebsführungen und es ist eine strikte Vermeidung von Personenidentitäten bzw. Doppelrollen in den Funktionen Geschäftsführung, leitende Mitarbeiter und Zugangsberechtigte zum Betriebsort des Schlüsselgenerierungsdienstes bzw. ePA-Aktensystems gewährleistet. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94681|layout=1">
   <p><b>A_17883</b></p>
   <p>Ein Anbieter eines ePA-Aktensystems und ein Anbieter eines SGD ePA MÜSSEN beim Wechsel ihrer jeweiligen SGD-Instanz&nbsp;die Weiterführung der Schlüsselableitungsfunktionalität ePA sicherstellen. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94682|layout=1">
   <p><b>A_17884</b></p>
   <p>Ein Anbieter eines ePA-Aktensystems und Anbieter eines SGD ePA MÜSSEN&nbsp;ein Migrationskonzept erstellen und pflegen, worin festgelegt wird, wie beim Wechsel ihrer SGD-Instanz die für deren Kunden verwendeten Ableitungsschlüssel sicher an die SGD-Folgeinstanz übergeben werden. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94683|layout=1">
   <p><b>A_17885</b></p>
   <p>Ein Anbieter eines ePA-Aktensystems MUSS sicherstellen, dass die von ihm verwendete SGD-Instanz (d. h. technisch formuliert "SGD 1") ePA-Aktensystemanbieter-spezifische Ableitungsschlüssel (Schlüsselableitungsfunktionalität ePA) verwendet. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94684|layout=1">
   <p><b>A_17886</b></p>
   <p>Ein Anbieter eines ePA-Aktensystems&nbsp;MUSS beim Wechsel der SGD-Instanz&nbsp;(vgl. <span data-option-id="custom" data-item-id="ML-94682" data-custom-label="A_17884" id="fake" data-type="crossReference" class="polarion-rte-link"></span> alle Ableitungsschlüssel sicher an die SGD-Folgeinstanz übergeben und anschließend sicher in der alten SGD-Instanz löschen. <b>&lt;=</b></p>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94506">3.2 Verfügbarkeit und Performanz</h3>
  <p id="polarion_42"> Verfügbarkeits- und Performanzanforderungen für einen SGD befinden sich in <span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_Perf#Produkttyp Schlüsselgenerierungsdienst]" data-url="/wiki/Spezifikation/gemSpec_Perf?selection=ML-94477"></span>&nbsp;und sind dem Produkttypsteckbrief SGD zugewiesen. </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94513">3.3 Sichere Betreiberumgebung</h3>
  <p id="polarion_94">Ähnlich wie einem TSP werden an den Betreiber eines SGD ePA&nbsp;Anforderungen u. a. an die sichere Betreiberumgebung aus [gemSpec_DS_Anbieter] gestellt (vgl. Zuordnung im Produkttypsteckbrief). Die zugeordneten Module sind "Basis-IS", "Basis-ISMS", "Erweitertes ISMS", "TI-Sicherheitsbericht" und "„Erweiterter TI-Sicherheitsbericht“.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-102058|layout=1">
   <p><b>A_18956</b></p>
   <p>Der Anbieter eines Schlüsselgenerierungsdiensts MUSS die im Handbuch des eingesetzten Schlüsselgenerierungsdienstes beschriebenen Voraussetzungen für den sicheren Betrieb des Produktes gewährleisten. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-102057|layout=1">
   <p><b>A_18955</b></p>
   <p>Der Hersteller des Schlüsselgenerierungsdienstes MUSS für sein Produkt im dazugehörigen Handbuch leicht ersichtlich darstellen, welche Voraussetzungen vom Betreiber und der Betriebsumgebung erfüllt werden müssen, damit ein sicherer Betrieb des Produktes gewährleistet werden kann. <b>&lt;=</b></p>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94514">3.4 Verschiedenes</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94678|layout=1">
   <p><b>A_17880</b></p>
   <p>Ein SGD ePA MUSS mit den Stratum-1-NTP-Servern der TI synchronisieren. <b>&lt;=</b></p>
  </div>
  <p id="polarion_245">Eine korrekte Zeit ist im SGD an drei Stellen wichtig:&nbsp;</p>
  <ol id="polarion_248"> 
   <li>für die EE-Zertifikatsprüfung in der RVE (ist der aktueller Prüfzeitpunkt innerhalb der Gültigkeitsdauer des zu prüfenden EE-Zertifikats),</li> 
   <li>für die EE-Zertifikatsprüfung in den SGD-HSM, und</li> 
   <li>für Zeitstempel bei Logdaten, die für die Fehleranalyse im SGD erhoben werden können.</li> 
  </ol>
  <p id="polarion_251"> Keiner dieser Anwendungszwecke verlangt, dass die Zeit in den o. g. Teilkomponenten im einstelligen Millisekundenbereich korrekt ist.&nbsp;<span id="polarion-comment:390"></span> </p>
  <p id="polarion_259">Eine Zeitdrift von weniger als 5 Minuten innerhalb des SGD (RVE, SGD-HSM) ist aus Sicherheitssicht akzeptabel.</p>
  <p id="polarion_283"> Die<span id="polarion-comment:391"></span> praktische Erfahrung nach mehr als einen Jahr mit verschiedenen SGDs in der PU&nbsp;zeigt, dass es notwendig ist die Zeit in den SGD-HSM kontinuierlich über NTP zu korrigieren. Die HSMs besitzen je nach Hersteller unterschiedliche Mechanismen, die eine schädliche Auswirkung einer temporärer Fehlfunktion des verwendeten NTP-Servers verhindern&nbsp;(ruckartige Änderungen über in den SGD-HSM konfigurierte Schrankenwerte). </p>
  <p id="polarion_291">Ein weiterer Erfahrungswert ist, dass ein Nachgehen der lokalen Zeit in den SGD-HSM um mehr als 5 Minuten insbesondere die Verfügbarkeit des SGD gefährdet, da dann i. d. R. OCSP-Antworten aus der Zukunft zu kommen scheinen, der akzeptable Schwellwert dafür dann überschritten ist und vom einen SGD-HSM die OCSP-Antworten abgelehnt werden.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126611|layout=1">
   <p><b>A_22485</b></p>
   <p>Der Anbieter eines SGD ePA MUSS sicherstellen, dass die SGD-HSM in dessen SGD per NTP synchronisiert werden. Die dabei zu verwendenden Schwellwerte (HSM-Hersteller-spezifische Mechanismen in den HSM, um die schädliche Auswirkung von temporären Fehlfunktionen des verwendeten NTP-Servers zu verhindern) werden während der Erst-Initialisierung zusammen mit der gematik in den SGD-HSM festgelegt.<span style="background-color: #FFFF99;"></span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_254">Ebenfalls ist ein betriebliches Monitoring der Zeit in den SGD-HSM notwendig.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126612|layout=1">
   <p><b>A_22486</b></p>
   <p>Der Anbieter eines SGD ePA MUSS sicherstellen, dass die Uhrzeit in den SGD-HSM in dessen SGD mindestens täglich automatisiert überwacht wird und bei substanziellen Abweichungen (bspw. mehr als +- 15 Sekunden) eine automatische Alarmierung an die SGD-HSM-Administration erfolgt. Die SGD-HSM-Administration MUSS bei Alarmierung dann Schritte zur Korrektur der Uhrzeit in den SGD-HSM ergreifen.<span style="background-color: #FFFF99;"></span> <b>&lt;=</b></p>
  </div>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94516">4 Bestandteile eines SGD</h2>
  <p id="polarion_44">Ein SGD besteht aus</p>
  <ol id="polarion_72"> 
   <li>einer HTTPS-Schnittstelle (vgl.&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17889" data-item-id="ML-94687" data-option-id="custom"></span>) innerhalb der TI,</li> 
   <li>einer Request verarbeitenden Einheit ( <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="RVE" data-item-id="ML-94519" data-option-id="custom"></span>)&nbsp;für die eingehenden HTTP-Requests, und</li> 
   <li>einem (oder mehreren) HSM (SGD-HSM genannt), das den wesentlichen Teil der Sicherheitsleistung des SGD erbringt. </li> 
  </ol>
  <p id="polarion_118" style="text-align: center;" class="polarion-rte-caption-paragraph"> <img src="attachments/34-screenshot-20190330-203539.png" style="width: 400px;height: 317px;"> </p>
  <p id="polarion_123" style="text-align: center;" class="polarion-rte-caption-paragraph"> Abbildung <span data-sequence="Abbildung" class="polarion-rte-caption">9</span>: Strukturelemente eines SGD </p>
  <p id="polarion_97"></p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94519">4.1 Request-Verarbeitung in einem SGD</h3>
  <p id="polarion_112"> Eingehende Requests eines Clients werden von der Request verarbeitenden Einheit (RVE) an der HTTPS-Außenschnittstelle (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17889" data-item-id="ML-94687" data-option-id="custom"></span>&nbsp;) entgegengenommen. Dort werden sie entweder direkt beantwortet (Operation GetPublicKey, A_17895-*)&nbsp;oder aufbereitet und danach an das SGD-HSM gesendet. Abhängig von der Antwort des SGD-HSM erzeugt die RVE eine Antwort für den Client (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17908-01" data-item-id="ML-109359" data-option-id="custom"></span>&nbsp;) und sendet diese an ihn. Die RVE hat keinen Einblick in den beidseitig authentisierten und verschlüsselten Datenkanal zwischen Client und SGD-HSM (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94770" data-option-id="shortoutline"></span>). Die RVE stellt nur in Bezug auf die Verfügbarkeit (DoS-Gegenmaßnahmen, Einholen von signierten OCSP-Responses, Umkodieren von Requests etc.) des SGD eine kritische Komponente dar. In Bezug auf die Vertraulichkeit der Schlüssel erbringt sie keine Sicherheitsleistung. </p>
  <p id="polarion_113"> Die Schnittstelle zwischen RVE und SGD-HSM ist eine Innenschnittstelle (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94070" data-option-id="longoutline"></span>) und wird deshalb nicht ausspezifiziert beschrieben. Es werden nur notwendige Festlegungen getroffen. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109359|layout=1">
   <p><b>A_17908-01</b></p>
   <p>Die Request verarbeitende Einheit (RVE) eines SGD ePA MUSS alle Informationen, die ein SGD-HSM für die Zertifikatsprüfung nach&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp; benötigt, bereitstellen und dem SGD-HSM bei der Weiterleitung des Requests übergeben.<br> Wenn die RVE erkennt, dass die Informationen dem SGD-HSM nicht ausreichen werden, so MUSS die RVE die Weiterleitung an die SGD-HSM abbrechen (i. S. v. gar nicht erst durchführen) und den Request mit einer Fehlermeldung, so wie in den Außenschnittstellen beschrieben, beantworten.<br> <b>&lt;=</b></p>
  </div>
  <p id="polarion_197">Ein SGD-HSM wird auf einen von der RVE weitergeleiteten Request in fünf Weisen antworten:</p>
  <ol id="polarion_178"> 
   <li>Die Authentizität des Requests ist nicht gegeben (bspw. AES-GCM meldet FAIL oder das Authentisierungstoken ist ungültig), das SGD-HSM meldet FAIL. Die RVE muss,&nbsp;so wie in den Außenschnittstellen beschrieben, eine Fehlermeldung an den Client senden.</li> 
   <li>Die Authentifizierung war erfolgreich und die Schlüsselableitung wurde durchgeführt. Übergeben wird der RVE das Chiffrat für den Client. Die RVE muss die Antwort-Datenstruktur, so wie bei der Operation KeyDerivation (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;) beschrieben, kodieren und dem Client diese als Response senden.</li> 
   <li>Die Authentifizierung war erfolgreich und die Schlüsselableitung wurde nicht durchgeführt, weil der Klartext-Request des Client falsch formatiert ist. Das SGD-HSM erzeugt eine entsprechende Fehlermeldung für die RVE und übergibt diese an die RVE.<span id="polarion-comment:393"></span> Die RVE muss diese Fehlermeldung in einer Antwort-Datenstruktur, so wie in den Außenschnittstellen beschrieben, kodieren und dem Client diese als Response senden.<br> Wenn die Fehlformatierung häufig vorkommt, liegt hier evtl. ein systematischer Fehler vor. Der SGD-Betreiber sollte davon wissen und bspw. mit Unterstützung der gematik eine Fehleranalyse unter Verwendung der TI-ITSM-Prozesse starten.</li> 
   <li>Die Authentifizierung war erfolgreich und die Schlüsselableitung wurde nicht durchgeführt, weil kein Ableitungsschlüssel vorhanden war mit dem vom Client übergebenen Ableitungsschlüsselbezeichner. Das SGD-HSM erzeugt ein Chiffrat mit entsprechender Fehlermeldung für den Client. Übergeben wird der RVE (1) das Chiffrat für den Client und (2) die Information über den Fehler. Die RVE muss die Antwort-Datenstruktur, so wie in den Außenschnittstellen beschrieben, kodieren und dem Client diese als Response senden.<br> Wenn dieser Fehlerfall häufig vorkommt, liegt hier evtl. ein systematischer Fehler vor. Der SGD-Betreiber sollte davon wissen und eine Fehleranalyse starten.</li> 
   <li>Die Zertifikatsprüfung im SGD-HSM ergab FAIL. D. h., die RVE hat die eigene Zertifikatsprüfung (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17908-01" data-item-id="ML-109359" data-option-id="custom"></span>&nbsp;) nicht korrekt ausgeführt.&nbsp;Die RVE muss,&nbsp;so wie in den Außenschnittstellen bzw. in Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94577" data-option-id="longoutline"></span>&nbsp;beschrieben, eine Fehlermeldung an den Client senden.</li> 
  </ol>
  <p id="polarion_298"> <span style="font-weight: bold;font-size: 12pt;line-height: 1.5;"> </span> </p>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-126988">4.1.1 Routing auf die SGD-HSM</h4>
  <p id="polarion_304"> <span id="polarion-comment:392"></span>Ziel ist es, dass die SGD-HSM in einem SGD von einander unabhängig arbeiten können. D. h., u. a. sollen sie nicht ihre kurzlebigen Schlüssel (S4) und die damit verbundenen Schlüssel (S5) (vgl. jeweils Abschnitt "4.3 Schlüssel im SGD-HSM") untereinander synchronisieren müssen. Daher muss die RVE am Anfang des SGD-Protokoll für einen Client bei Erhalt der Nachricht 1 (vgl. Abschnitt "9.1 Ablauf Kommunikation zwischen Client und SGD-HSM") ein SGD-HSM aus der Menge der im SGD verfügbaren SGD-HSM auswählen. Diese Auswahl nimmt die RVE vor und teilt sie dem Client mit, in dem sie dem Client den aktuellen (S4)-Schlüssel des ausgewählten SGD-HSM bei GetPublicKey (vgl. Abschnitt "6.4 Operation GetPublicKey") als Protokoll-Nachricht 2 sendet. Alle weiteren Nachrichten dieses Client innerhalb dieses Protokollablaufes müssen dann genau das ausgewählte SGD-HSM erreichen. Dies bedeutet: die RVE muss für die folgenden vom Client gesendeten Nachrichten des SGD-Protokolls geeignete Routing-Entscheidungen vornehmen. Eine solche Routing-Entscheidung kann die RVE leicht treffen, denn im "PublicKeyECIES" (vgl. A_17900) ist der Hashwert des Ziel-(S4)-Schlüssels enthalten und der "PublicKeyECIES" ist Bestandteil jeder weiteren Protokoll-Nachricht des Clients. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126672|layout=1">
   <p><b>A_22493</b></p>
   <p>Die Request verarbeitende Einheit (RVE) eines SGD ePA MUSS folgende Vorgaben umsetzen:<br> 
    <ol> 
     <li>Sie MUSS bei der alle 15 Minuten stattfindenden Neuerzeugung des neuen (S4)-Schlüsselpaars eines SGD-HSM den SHA-256-Hashwerts des öffentlichen Schlüssels (welcher sich in der Kodierung nach A_17894-*-PublicKeyECIES befindet) berechnen.<br> Beispiel aus Abschnitt 5.1.2:<br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"brainpoolP256r1" + " " +&nbsp;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x743cf1b8b5cd4f2eb55f8aa369593ac436ef044166699e37d51a14c2ce13ea0e" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x36ed163337deba9c946fe0bb776529da38df059f69249406892ada097eeb7cd4</span><br> dessen SHA-256-Hashwert ist:<br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">a3a56e51377c1de0bea0522eba3ec6277e3355edb67d48b9852ab7d7e536feb7</span></li> 
     <li>Sie MUSS eine Routingtabelle (Associative Array) pflegen auf der sie erkennen kann, welcher Schlüsselhashwert zu welchem SGD-HSM gehört.<br> (Hinweis: "pflegen" bedeutet insbesondere auch, dass Hashwerte zu alter (ungültiger)&nbsp;(S4)-Schlüssel in der Routingtabelle von der RVE gelöscht werden.)</li> 
     <li>Bei Eintreffen einer Client-Nachricht GetAuthenticationToken (vgl. Abschnitt 6.5) oder KeyDerivation (vgl. Abschnitt 6.6) MUSS sie im "PublicKeyECIES" (vgl. A_17900) den Hashwert aus dem 4-te oder 5-te Datenfeld für das Routing mittels der Routingtabelle (vgl. Punkt 2.) verwenden. Wenn der SGD ein SGD1 ist, so MUSS die RVE das 4-te Datenfeld verwenden. Ist der SGD ein SGD2, so MUSS die RVE das 5-te Datenfeld verwenden. Findet sich in der Routingtabelle kein entsprechender Eintrag (Client verwendet zu alten (S4)-Schlüssel), so MUSS die RVE dem Client mit einer "restart protocol"-Fehlermeldung (vgl. A_18987) antworten.</li> 
    </ol> Die RVE MUSS es erlauben, dass Client-Nachrichten in beliebiger Kombination GetAuthenticationToken- und KeyDerivation senden können und dass diese Nachrichten an die vorgesehen SGD-HSM gelangen. Es ist also explizit nicht Aufgabe der RVE den SGD-Protokoll-Ablauf der 6 Nachrichten sicherzustellen. Ein Client darf beispielsweise folgende Nachrichtenfolgen senden (GetPublicKey, GetAuthenticationToken, KeyDerivation, KeyDerivation, KeyDerivation) oder (GetPublicKey, GetAuthentication, GetAuthentication, KeyDerivation).<span style="background-color: #FFFF99;"></span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_307">Mit A_22493 ist es nun möglich, dass ein SGD-Client bspw. ein KTR-Consumer oder ein ePA-FdV nach einem GetPublicKey und einem GetAuthenticationToken beliebig viele Schlüsselableitungen mittels KeyDerivation durchführen kann, solange der verwendete (S4)-Schlüssel noch gültig ist (also 15 bis fast 30 Minuten). Damit sind für solch einen SGD-Client nicht mehr 6 * (Anzahl der abzuleitenden Schlüssel) SGD-Nachrichten notwendig, sondern nur noch 4 + 2*(Anzahl der abzuleitenden Schlüssel) SGD-Nachrichten. Für einen SGD-Client gibt es in Abschnitt "7.1 Mehrfachableitung" weiterführende Informationen.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94709">4.2 SGD-HSM</h3>
  <p id="polarion_192">Den wesentlichen Teil der Sicherheitsleistung eines SGD erbringt das SGD-HSM. Das SGD-HSM entscheidet, ob eine ausreichende Authentifizierung stattgefunden hat und führt erst danach eine Schlüsselableitung durch. Anschließend überträgt es die abgeleiteten spezifischen Schlüssel über einen beidseitig authentisierten und Ende-zu-Ende-verschlüsselten Datenkanal an den Client.</p>
  <p id="polarion_198">Ein SGD-HSM</p>
  <ol id="polarion_193"> 
   <li>erzeugt mindestens alle 15 Minuten ein neues ECIES-Schlüsselpaar,<br> (Ein ECIES-Schlüsselpaar ist 30 Minuten für jeden Client nutzbar und wird danach im SGD-HSM sicher gelöscht)</li> 
   <li>enthält den privaten Signaturschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;&nbsp;(S1)), der für die Signatur (Authentisierung) des jeweils neu erzeugten öffentlichen ECIES-Schlüssels (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;&nbsp;(S4)) notwendig ist,</li> 
   <li>erzeugt halbjährlich einen neuen Ableitungsschlüssel und hält zuvor erzeugte Ableitungsschlüssel im HSM vor,</li> 
   <li>prüft bei eingehenden Anfragen für eine Schlüsselableitung das Zertifikat des Anfragenden,</li> 
   <li>führt bei positivem Prüfergebnis eine Schlüsselableitung entsprechend den Ableitungsregeln durch,</li> 
   <li>verschlüsselt die abgeleiteten Schlüssel für den Anfragenden.</li> 
  </ol>
  <p id="polarion_206">Das SGD-HSM muss ein besonderes Firmware-Modul enthalten, das diese Funktionalität abbildet. Dieses hat einen sehr begrenzten Funktionsumfang (ECC- und AES-Schlüssel erzeugen, Signaturen prüfen, aus einem AUT-Zertifikat die KVNR bzw. Telematik-ID auslesen, eine Hashfunktion (HKDF) berechnen, ECIES Ver- und Entschlüsselung durchführen und AES-GCM ausführen). Die Mehrzahl der Funktionen sind schon standardmäßig im HSM vorhanden.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94708|layout=1">
   <p><b>A_17907</b></p>
   <p>Ein SGD ePA MUSS Folgendes sicherstellen:<br> 
    <ol> 
     <li>Er MUSS mindestens ein HSM, SGD-HSM genannt, einsetzen.</li> 
     <li>Solch ein SGD-HSM MUSS auf einer Plattform (Hardware und Software) basieren, das zuvor bereits erfolgreich eine Zertifizierung nach FIPS 140-2 [FIPS-140-2]&nbsp;mindestens Level 3 durchlaufen hat.</li> 
     <li>Ein solches SGD-HSM MUSS mit spezieller Firmware ausgestattet sein.</li> 
     <li>Diese Firmware MUSS die Ablauflogik aus [gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94533" data-option-id="longoutline"></span>] ausführen.</li> 
     <li>Im SGD-HSM MÜSSEN, neben dem speziellen Firmware-Modul, ausschließlich Standard-Firmware-Module verwendet werden (also keine anderen speziellen selbstprogrammierten Firmware-Module).</li> 
     <li>Das Firmware-Modul MUSS eine Sicherheitsbegutachtung durch eine durch die gematik anerkannte unabhängige Instanz (Penetration-Tester etc.) haben. Die gematik nimmt das Gutachten ab und prüft, ob die Anforderung aus dem Produkttypsteckbrief bezogen auf die Schlüsselableitungsfunktionalität ausreichend betrachtet worden sind.</li> 
     <li>Bei der Sicherheitsbegutachtung MUSS sichergestellt sein, dass die unabhängige Instanz aus Punkt 6 mit der gematik Informationen (Frage/Antwort) bezüglich der&nbsp;Sicherheitsbegutachtung austauschen darf.</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_215">Hinweis zu Punkt 7:</p>
  <p id="polarion_218">Analog zu den CC-Evaluierungen der TI-Komponenten muss es möglich sein, ohne dass Verschwiegenheitsregelungen die Klärung von fachlichen Punkten während der&nbsp;Sicherheitsbegutachtung behindern, die notwendige Dauer der&nbsp;Sicherheitsbegutachtung zu minimieren.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94522">4.3 Schlüssel im SGD-HSM</h3>
  <p id="polarion_43">In einem SGD müssen verschiedene Schlüssel verfügbar sein, die durch ein SGD-HSM geschützt werden müssen.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109449|layout=1">
   <p><b>A_17910-01</b></p>
   <p>Ein SGD ePA MUSS sicherstellen, dass in seinem (oder seinen) SGD-HSM folgende Schlüssel existieren und durch das (die) SGD-HSM geschützt werden:<br> 
    <ol> 
     <li>Schlüsselbestätigungsschlüsselpaar ECC brainpoolP256r1 (S1),</li> 
     <li>Eine geordnete Liste von Zertifikatssignaturprüfschlüsseln (darunter der aktuelle öffentliche RSA-Root-Schlüssel der X.509-Root der TI und der aktuelle ECC-Root-Schlüssel der X.509-Root der TI) (S2),</li> 
     <li>alle aktuell benötigten Ableitungsschlüssel (S3),</li> 
     <li>zwei mittels des privaten Schlüsselbestätigungsschlüssels (S1) authentisierte (vgl. Signatur in <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;)&nbsp;kurzlebige (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17914-01" data-item-id="ML-109450" data-option-id="custom"></span>&nbsp;) ECIES-Schlüsselpaare (S4), und</li> 
     <li>zwei Ableitungsschlüssel (S5) für die Erstellung der Authentisierungstoken (je ein Ableitungsschlüssel zugeordnet zu genau einem ECIES-Schlüsselpaar (S4)).</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-102834|layout=1">
   <p><b>A_17911-01</b></p>
   <p>Ein SGD ePA MUSS sicherstellen, dass die Schlüssel (S1) bis (S5) aus <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp; ausschließlich im Mehr-Augen-Prinzip erstellbar und änderbar sind (bzw. (S4) und (S5) autonom durch das SGD-HSM-Firmware-Modul).&nbsp;<span style="font-size: 10pt;line-height: 1.5;">Ausgenommen davon sind schon über die PKI der TI Intergritäts- und Authentitätsgeschützte Schlüssel (Import von Cross-signierten neuen Root-Schlüsseln, Import von CA-Schlüsseln die über schon im SGD-HSM vorhandene Root-Schlüssel geprüft werden können).</span> <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109454|layout=1">
   <p><b>A_17912-01</b></p>
   <p>Ein SGD ePA MUSS sicherstellen, dass die Schlüssel (S2) aus <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp; Teil des SGD-HSM-Firmware-Moduls sind. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109455|layout=1">
   <p><b>A_17913-01</b></p>
   <p>Ein SGD ePA MUSS technisch sicherstellen, dass<br> der private Schlüsselbestätigungsschlüssel bei (S1) (vgl.&nbsp;jeweils&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;),<br> 
    <ol> 
     <li>die Ableitungsschlüssel (S3),</li> 
     <li>die privaten ECIES-Schlüssel (S4), und</li> 
     <li>die zu den (S4) 1:1-zugeordneten Ableitungsschlüssel (S5) für die Erstellung der Authentisierungstoken</li> 
    </ol> ausschließlich durch das SGD-HSM-Firmware-Modul nutzbar sind.<br> <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109450|layout=1">
   <p><b>A_17914-01</b></p>
   <p>Ein SGD ePA MUSS Folgendes sicherstellen: <br> 
    <ol> 
     <li>Die beiden ECIES-Schlüsselpaare (S4) (vgl.&nbsp;&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;), MÜSSEN jeweils 30 Minuten verwendbar sein und MÜSSEN anschließend sicher gelöscht werden.</li> 
     <li>Initial MUSS ein ECIES-Schlüsselpaar erzeugt werden und 15 Minuten später das zweite.</li> 
     <li>Jeweils im 15-Minuten-Intervall MUSS ein neues Paar erzeugt werden.</li> 
     <li>Der öffentliche Schlüssel dieses neu erzeugten Paares MUSS&nbsp;mittels (S1) signiert und Schlüssel mit Signatur nach <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;&nbsp;kodiert werden und die erzeugte Kodierung der RVE übergeben werden.</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_58"> Hinweis zu <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17914-01" data-item-id="ML-109450" data-option-id="custom"></span>&nbsp;&nbsp;: Alle 15 Minuten wird&nbsp;ein neues ECIES&nbsp;-Schlüsselpaar (vgl. auch [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17873" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94670"></span>&nbsp;]) erzeugt werden. Wenn kurz zuvor ein Client (ePA-FdV oder FM ePA) jedoch den öffentliche Schlüssel des alten Schlüsselpaares über die Schnittstelle GetPublicKey (A_17895-*&nbsp;) erhalten hat, kann er das alte Schlüsselpaar maximal 15 Minuten weiter nutzen. Die Lebensdauer eines solchen ECIES-Schlüsselpaars in einem SGD-HSM ist also 30 Minuten. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109452|layout=1">
   <p><b>A_18022-02</b></p>
   <p>Ein SGD ePA MUSS Folgendes sicherstellen:<br> 
    <ol> 
     <li>Jedem ECIES-Schlüsselpaar (S4) (vgl.&nbsp;&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;), MUSS genau ein Ableitungsschlüssel (S5) für die&nbsp;Erstellung der Authentisierungstoken zugeordnet sein.</li> 
     <li>Wenn ein ECIES-Schlüsselpaar (S4) erzeugt wird (vgl. <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17914-01" data-item-id="ML-109450" data-option-id="custom"></span>&nbsp;) MUSS ein Ableitungsschlüssel (S5) gemäß Spiegelstrich 1 erzeugt werden.</li> 
     <li>Wenn ein ECIES-Schlüsselpaar (S4) sicher gelöscht wird (vgl. <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17914-01" data-item-id="ML-109450" data-option-id="custom"></span>&nbsp;), so MUSS auch der zugeordnete Ableitungsschlüssel (S5) sicher gelöscht werden.</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109453|layout=1">
   <p><b>A_17915-01</b></p>
   <p>Ein SGD ePA DARF die kurzlebigen privaten ECIES&nbsp;-Schlüssel (&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp; (S4)) und die mit diesen 1:1-zugeordneten Ableitungsschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17915-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp; (S5)) (Erstellung der Authentisierungstoken) NICHT über mehrere SGD-HSM synchronisieren.<br> <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94719|layout=1">
   <p><b>A_17916</b></p>
   <p>Ein SGD ePA MUSS technisch sicherstellen, dass der private&nbsp;Schlüsselbestätigungsschlüssel ( <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;(S1)) und die geheimen Ableitungsschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp; (S3)) in dessen SGD-HSM ausschließlich verschlüsselt und im Mehr-Augen-Prinzip importierbar und exportierbar sind (Ziel: Sicherstellung der&nbsp;Verfügbarkeit dieser Schlüssel). Der SGD ePA MUSS technisch sicherstellen, dass beim Import und Export dieser Schlüssel notwendiger Weise ein Mitarbeiter der gematik beteiligt ist.<br> <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94716|layout=1">
   <p><b>A_17917</b></p>
   <p>Ein SGD ePA MUSS durch technische Maßnahmen sicherstellen, dass<br> 
    <ol>
     <li>das Einbringen und das Update des speziellen Firmware-Moduls in ihrem (oder ihren) SGD-HSM nur im Mehr-Augen-Prinzip möglich ist,</li>
     <li>ein Mitarbeiter der gematik an diesem Vorgang beteiligt ist (durch das SGD-HSM durchgesetzt).</li>
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_95"> Verständnishinweis zu <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17916" data-item-id="ML-94719" data-option-id="custom"></span>&nbsp;und&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17917" data-item-id="ML-94716" data-option-id="custom"></span>: Dies ist analog zu den Vorgaben, wie seit 2014 die CVC-Root der TI betrieben wird. Damit wird der Betreiber eines SGD vom Verdacht befreit es könnte die geheimen Ableitungsschlüssel <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp; (S3) missbrauchen. Er ist technisch aufgrund der zwei Anforderungen nicht in der Lage dies zu tun. </p>
  <p id="polarion_221"> Aufgrund der Bedeutung der Schlüsselbestätigungsschlüssel für die Sicherheitsleistung werden diese innerhalb eines Clients nicht über die üblichen Zertifikatsprüfverfahren überprüft, sondern die Zertifikate, die die&nbsp;Schlüsselbestätigungsschlüssel enthalten, sind direkt (explizit) in der TSL aufgeführt (vgl.&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17847" data-item-id="ML-94621" data-option-id="custom"></span>&nbsp;(Prüfung eines SGD-HSM-Zertifikats) und&nbsp;<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_PKI#A_17700]" data-url="/wiki/Spezifikation/gemSpec_PKI?selection=ML-94225"></span>). Dadurch wirken etwaige Probleme bspw. in der Komponenten-PKI nicht auf die Sicherung der Authentizität der&nbsp;Schlüsselbestätigungsschlüssel (risikominimierende Maßnahme). </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109456|layout=1">
   <p><b>A_17846-01</b></p>
   <p>Ein SGD ePA, der nicht der SGD der zentralen TI-Plattform ist, MUSS folgende Vorgaben durchsetzen. <br> Der öffentlichen Schlüsselbestätigungsschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;(S1)) MUSS in einem EE-Zertifikat nach dem Zertifikatsprofil [gemSpec_PKI#Tab_PKI_296] C.SGD-HSM.AUT aufgeführt werden.<br> 
    <ol> 
     <li>Dabei MUSS das Zertifikat vom ePA-Aktensystem für dessen SGD genau nur die OID oid_sgd1_hsm [gemSpec_OID#3.5.4 OID-Vergabe für technische Rollen] als technische Rolle aufführen.</li> 
     <li>Das Zertifikat MUSS in die TSL(ECC-RSA) der TI gebracht werden und zwar aufgeführt als TSPService mit dem ServiceTypeIdentifier "http://uri.etsi.org/TrstSvc/Svctype/unspecified".</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_177"> Hinweis: vgl. auch [gemSpec_PKI#Abschnitt&nbsp;<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="SGD-HSM – Schlüsselgenerierungsdienst-HSM" data-url="/wiki/Spezifikation/gemSpec_PKI?selection=ML-94617"></span>].&nbsp; </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109457|layout=1">
   <p><b>A_17918-01</b></p>
   <p>Ein SGD ePA der zentralen TI-Plattform MUSS folgende Vorgaben durchsetzen. <br> 
    <ol> 
     <li>Der öffentlichen Schlüsselbestätigungsschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;(S1)) MUSS in einem EE-Zertifikat nach dem Zertifikatsprofil [gemSpec_PKI#Tab_PKI_296] C.SGD-HSM.AUT aufgeführt werden.</li> 
     <li>Dabei MUSS das Zertifikat vom ePA-Aktensystem für dessen SGD genau nur die OID oid_sgd2_hsm [gemSpec_OID#3.5.4 OID-Vergabe für technische Rollen] als technische Rolle aufführen.</li> 
     <li>Das Zertifikat MUSS in die TSL(ECC-RSA) der TI gebracht werden und zwar aufgeführt als TSPService mit dem ServiceTypeIdentifier "http://uri.etsi.org/TrstSvc/Svctype/unspecified".</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_174"> Hinweis: Die gematik stellt sicher, dass sich in der TSL nur SGD-HSM-Zertifikate nach <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17846-01" data-item-id="ML-109456" data-option-id="custom"></span>&nbsp;#(1) und nach <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17918-01" data-item-id="ML-109457" data-option-id="custom"></span>&nbsp;&nbsp;#(1) befinden, die zugehörig sind zu SGD-HSMs von zugelassenen SGD. Vergleiche auch&nbsp;&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17847" data-item-id="ML-94621" data-option-id="custom"></span>&nbsp;(Prüfung eines SGD-HSM-Zertifikats). </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94787">4.4 Pflege der Prüfschlüssel (S2) im SGD-HSM</h3>
  <p id="polarion_142"> In <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;(Schlüssel in einem SGD-HSM) wird mit (S2) eine geordnete Liste von Zertifikatssignaturprüfschlüsseln eingeführt. Diese Schlüssel bildet die Grundlage für die Zertifikatsprüfung in einem SGD-HSM ( <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp;). Einerseits handelt es sich um den RSA-Schlüssel der aktuellen X.509-Root-Version (RCA2) und analog den ECC-Schlüssel (RCA3) und andererseits um nicht von der TI-X.509-Root bestätigte X.509-eGK-CA-Zertifikate, die in der TSL der TI aufgeführt sind. Diese Schlüssel sind fester Bestandteil des SGD-HSM-Firmwaremoduls (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17912-01" data-item-id="ML-109454" data-option-id="custom"></span>&nbsp;). Alle zukünftig erzeugten CA-Zertifikate der TI werden durch die X.509-Root bestätigt werden [gemSpec_X.509_TSP#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="TIP1-A_3894" data-url="/wiki/Spezifikation/gemSpec_X_509_TSP?selection=ML-10037"></span>].&nbsp; </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109458|layout=1">
   <p><b>A_17952-01</b></p>
   <p>Der SGD ePA MUSS Folgendes sicherstellen.<br> 
    <ol> 
     <li>Die RVE MUSS vom SGD-HSM eine nummerierte Liste von im SGD-HSM gespeicherten (und damit verwendbaren/adressierbaren)&nbsp;Zertifikatssignaturprüfschlüsseln erhalten können (vgl. <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;).</li> 
     <li>In dieser Liste MÜSSEN der RSA-Schlüssel der RCA2 (X.509-Root der TI) und der ECC-Schlüssel der RCA3 enthalten sein.</li> 
     <li>In dieser Liste MÜSSEN die Bestätigungsschlüssel aller (bez. der Gültigkeitszeit noch relevanten) nicht-TI-X.509-Root-signierten eGK-CA-Zertifikate inkl. Gültigkeitszeitinformationen enthalten sein, die sich aktuell in der TSL der TI befinden.</li> 
     <li>Es MUSS der RVE möglich sein, in das SGD-HSM durch CA-Zertifikatsprüfung auf Grundlage der Root-Schlüssel (RCA2, RCA3 etc.) neue eGK-CA-Schlüssel inkl. Gültigkeitszeitinformationen in das SGD-HSM zu importieren und als neue Elemente in die nummerierte Liste aufzunehmen.</li> 
     <li>Es MUSS der RVE möglich sein, durch Übergabe von X.509-Cross-Zertifikaten neue Root-Schlüssel (neue X.509-Root-Versionen der TI) in das SGD-HSM zu importieren.</li> 
     <li>Es MUSS der RVE möglich sein, alle&nbsp;Zertifikatssignaturprüfschlüssel außer den Root-Schlüsseln (RCA2 und RCA3) zu löschen indem dem SGD-HSM eine entsprechende OCSP-Response der X.509-Root der TI präsentiert wird.&nbsp;</li> 
     <li>Es MUSS der RVE möglich sein OCSP-Signer-Zertifikate in das SGD-HSM zu importieren, wobei diese durch das SGD-HSM beim Import geprüft werden MÜSSEN.</li> 
     <li>Das SGD-HSM MUSS für die Prüfung von Zertifikatssignaturen ausschließlich CA-Schlüssel verwenden.</li> 
     <li>Das SGD-HSM MUSS für die Prüfung von OCSP-Response-Signaturen ausschließlich OCSP-Signer-Schlüssel verwenden.</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_184"> Aus Performanzgründen müssen für die Zertifikatsprüfung die CA-Zertifikate schon geprüft im SGD-HSM vorliegen. Ansatzpunkt der Prüfung von EE-Zertifikaten ist im SGD-HSM immer einen solcher CA-Schlüssel. Die RVE kennt die aktuelle Liste im SGD-HSM (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17952-01" data-item-id="ML-109458" data-option-id="custom"></span>&nbsp;&nbsp;Punkt 1) und teilt dem SGD-HSM bei einer Requestweitergabe mit welcher Prüfschlüssel im SGD-HSM für die Zertifikatsprüfung der Richtige ist (vgl.&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17908-01" data-item-id="ML-109359" data-option-id="custom"></span>&nbsp;), also vom SGD-HSM zu verwenden ist. Wie ein SGD-HSM erkennen kann, ob ein importiertes Zertifikat ein CA-Zertifikat oder ein OCSP-Signer-Zertifikat ist, ist in [gemSpec_PKI] definiert. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94790|layout=1">
   <p><b>A_17953</b></p>
   <p>Der SGD ePA MUSS Folgendes sicherstellen.<br> 
    <ol> 
     <li>Die RVE MUSS täglich eine aktuelle TSL vom TSL-Download-Punkt (TSL(ECC-RSA)) beziehen.</li> 
     <li>Aus dieser TSL MUSS die RVE eine Liste von CA-Zertifikaten erzeugen, die in TSPService-Einträgen stehen, die eine&nbsp;ServiceInformationExtensions oid_egk_aut, oid_egk_aut_alt oder oid_smc_b_aut beinhalten.</li> 
     <li>Die Schlüssel der CAs aus dieser Liste MUSS die RVE mit der Liste der Zertifikatssignaturprüfschlüssel im SGD-HSM abgleichen.</li> 
     <li>Sofern Schlüssel im SGD-HSM fehlen, so MUSS die RVE diese in das SGD-HSM durch Zertifikatssignaturprüfung auf Basis eines Root-Schlüssels (RCA2, RCA3 etc.) inkl. Gültigkeitszeitinformationen einbringen (vgl.&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17952-01" data-item-id="ML-109458" data-option-id="custom"></span>&nbsp;&nbsp;).</li> 
     <li>Falls in der in der Liste CA-Schlüssel enthalten sind, die in der TSL nun nicht mehr enthalten sind, so MUSS die der SGD ePA die CA-Schlüssel gemäß&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17952-01" data-item-id="ML-109458" data-option-id="custom"></span>&nbsp;&nbsp;Punkt 6 zu entfernen.</li> 
     <li>Analog MUSS die RVE mit OCSP-Zertifikatsschlüsseln in der TSL vorgehen. Diese MUSS die RVE durch&nbsp;Zertifikatssignaturprüfung auf Basis der RCA2 oder RCA3 inkl. Gültigkeitszeitinformationen einbringen. Das SGD-HSM MUSS nach Prüfung des OCSP-Zertifikats ebenfalls die Information speichern, dass es sich um OCSP-Schlüssel handelt und für welche CA Sperrstatusaussagen getroffen werden dürfen über diesen OCSP-Signer-Schlüssel.</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_200"> Wenn bei <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17953" data-item-id="ML-94790" data-option-id="custom"></span>&nbsp;Punkt (1) der Download aufgrund eines Fehlers nicht erfolgen kann, so greift das bei einer "Trust-service Status List" (TSL) übliche Standardvorgehen: die am Vortag heruntergeladene TSL hat eine in der TSL kodierte Gültigkeitsdauer (i. d. R. 30 Tage). Diese TSL ist dann im SGD weiterhin verwendbar und auch zu verwenden. Sollte der Download länger als diese Gültigkeitsdauer nicht funktionieren (was aufgrund der SLA des TSL-Dienstes quasi ausgeschlossen ist), so kann die RVE keine EE-Zertifikatsprüfungen mehr durchführen und muss alle Client-Requests (bis auf GetPublicKey) ablehnen, weil sie bspw.&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span>&nbsp;(Zertifikatsprüfung) erfüllen muss ("Falls eine der Prüfungen ein nicht-positives Ergebnis liefert, so MUSS die RVE des SGD&nbsp;mit einer entsprechenden Fehlermeldung [...] die weitere Requestverarbeitung abbrechen").&nbsp; </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109461|layout=1">
   <p><b>A_17954-01</b></p>
   <p>Der SGD ePA MUSS wöchentlich überprüfen, ob neue X.509-Root-CA-Versionen existieren und entsprechende Cross-Zertifikate verfügbar sind. Falls dies der Fall ist, so MUSS der SGD ePA diese neue Root-Versionen in seinen SGD-HSMs importieren (vgl.&nbsp;&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17952-01" data-item-id="ML-109458" data-option-id="custom"></span>&nbsp;&nbsp;Punkt 5).<br> <b>&lt;=</b></p>
  </div>
  <p id="polarion_286"> Hinweis: Nach der Erzeugung einer neuen&nbsp;Root-Version der X.509-Root-CA der TI werden dessen selbstsigniertes Zertifikat und Crosszertifikate auf den Download-Punkt&nbsp;<a href="https://download.tsl.ti-dienste.de/ECC/ROOT-CA/" target="_top" class="descriptionLink">https://download.tsl.ti-dienste.de/ECC/ROOT-CA/</a>&nbsp;abgelegt. Automatisiert kann der SGD ePA von dort die Verfügbarkeit neuer Versionen überwachen.&nbsp;Im Regelfall wird alle zwei Jahre eine neue Root-Version erzeugt. </p>
  <p id="polarion_261"> Ebenfalls kann man <a href="https://download.tsl.ti-dienste.de/ECC/Root-CA/roots.json" target="_top" class="descriptionLink">https://download.tsl.ti-dienste.de/ECC/Root-CA/roots.json</a>&nbsp;verwenden. Dort werden die aktuellen Root-Zertifikate<span id="polarion-comment:394"></span> inkl. deren Crosszertifikate gepflegt. Implementierungshinweis: die Dateigröße der JSON-Datei kann man als Hashfunktion verwenden. Mit dieser Idee kann man bspw. via curl die HTTP-Methode HEAD verwenden, und damit erfahren ob die lokale Kopie der JSON-Datei noch aktuell ist. </p>
  <p id="polarion_282"> <span id="polarion-comment:395"></span>Die JSON-Datei ist ein Array in dem Associative Arrays als Elemente aufgeführt werden. Diese Elemente enthalten je ein Root-Zertifikat inkl. Crosszertifikate für das chronisch vorhergebende und das nachfolgende Root-Zertifikat. D. h.,&nbsp;&nbsp;kryptographisch gesehen stellt dies eine doppelt verkettet Liste dar. Die Element im Array sind in chronologischer Ordnung sortiert. </p>
  <p id="polarion_314" style="margin-left: 40px;" class="MsoNormal"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">[ <br> { "name" : "RCA1", "CN" : "GEM.RCA1", "cert" : "…base64…", "prev” : "", "next" : "….base64…", "SKI" : "Subject-Key-Identifier als Hexwert" }, <br> { "name" : "RCA2", … },</span> </p>
  <p id="polarion_321" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "name" : "RCA3", … },</span> </p>
  <p id="polarion_323" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">…</span> </p>
  <p id="polarion_324" style="margin-left: 40px;"> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">]</span> </p>
  <p id="polarion_325" class="MsoNormal">&nbsp;</p>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-113379">4.4.1 Zuordnung von OCSP-Responder-Zertifikaten zu CA-Zertifikaten (informativ)</h4>
  <p id="polarion_263" class="MsoNormal">Der Vertrauensraum der TI (also die PKI der TI) wird so wie der eIDAS-Vertrauensraum technisch über eine „Trust-service Status List“ nach der dem europäischen Standard ETSI TS 102 231 [ETSI_TS_102_231_v3.1.2] abgebildet. Eine TSL führt verschiedene TSP (CA) auf und einige ihrer CA-Zertifikate.</p>
  <p id="polarion_265" class="MsoNormal">Im Zusammenspiel dazu gibt es noch die X.509-Root der TI. Über die Prüfung mittels der X.509-Root kann man für bestimmte Anwendungsfälle äquivalente Prüfaussagen wie über die Prüfung mittels der TSL treffen.&nbsp;Die Prüfung über die X.509-Root ist technisch deutlich einfacher als über die TSL, weswegen dieser Weg auch im SGD-HSM verwendet wird.</p>
  <p id="polarion_266" class="MsoNormal">In der TSL sind neben Metainformationen zu den CA-Zertifikaten ebenfalls&nbsp;OCSP-Responder-Zertifikate aufgeführt. Diese müssen nicht notwendiger Weise per kryptographischer Signaturprüfung auf die CA-Zertifikate rückführbar sein zu den CA über die die Responder Sperrauskünfte geben dürfen. Dies ist ein wichtiger Unterschied im Vergleich zur Prüfung über die X.509-Root.</p>
  <p id="polarion_267" class="MsoNormal">Bei der Zuordnung der OCSP-Responder-Zertifikate zu den CA-Zertifikaten bei der Erstellung der Import-Listen für die Schlüssel (S2) (vgl. A_17910-*) für die SGD-HSM-Initialisierung ist zu beachten, dass nach dem TSL-Modell alle OCSP-Responder die für einen TSP definiert sind für alle CA desselben TSP Sperrauskünfte geben dürfen. Sind also bspw. für einen TSP in der TSL drei CA-Zertifikate angegeben und ein OCSP-Responder-Zertifikat, so kann dieser Responder für alle drei CA Sperraussagen treffen. Sind mehr als ein OCSP-Responder-Zertifikat pro TSP definiert, so drüber alle OCSP-Responder für alle CA desselben TSP Sperraussagen treffen. Es gibt also ein n zu m Zuordnung, sie sich in der Import-Liste widerspiegeln muss.</p>
  <p id="polarion_276" class="MsoNormal">Um die Aufgabe der Initialisierung der SGD-HSM zu unterstützen stellt die gematik auf Anfrage ein Programm zur Verfügung, dass diese Zuordnung aus einer aktuellen TSL automatisch erzeugt. Im Rahmen der Schlüsselzeremonie also der Initialisierung der SGD-HSM muss gemäß A_17916 der Anbieter des SGD und ein Vertreter der gematik die Import-Liste gemeinsam in die SGD-HSM importieren, dafür muss diese Liste zwischen beiden Parteien konsentiert sein – Überprüfung der Korrektheit der Liste im Mehr-Augen-Prinzip.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94533">4.5 Funktionsablauf Firmware-Modul SGD-HSM</h3>
  <p id="polarion_79"> In diesem Abschnitt wird die Ablauflogik im speziellen HSM-Firmware-Modul beschrieben. Diese Beschreibung ist Grundlage der für die Zulassung notwendigen Sicherheitsüberprüfung (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17907" data-item-id="ML-94708" data-option-id="custom"></span>&nbsp;). </p>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-94534">4.5.1 Zertifikats- und Schlüsselprüfung im SGD-HSM</h4>
  <p id="polarion_101">Damit im SGD-HSM nur für den jeweils Berechtigten eine Schlüsselableitung durchgeführt wird, muss dessen Request auf Authentizität geprüft werden. Dafür muss dessen AUT-Zertifikat innerhalb des SGD-HSMs überprüft werden.</p>
  <p id="polarion_45">Eine Standard-TI-Prüfung auf Basis der TSL ist technisch relativ komplex und ist insbesondere in beschränkten&nbsp; Laufzeitumgebungen wie Chipkarten oder HSM-Firmware-Modulen nur schwer umsetzbar. Damit diese Prüfung technisch praktikabel ist, wird bei der Prüfung des AUT-Zertifikats die Signaturkette auf die X.509-Root der TI geprüft. Es werden ebenfalls OCSP-Antworten notwendigerweise ausgewertet.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109357|layout=1">
   <p><b>A_17919-01</b></p>
   <p>Ein SGD ePA MUSS folgende Vorgaben durchsetzen:<br> 
    <ol> 
     <li>(K1) Die RVE MUSS dem SGD-HSM mitteilen über welchen Prüfschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17952-01" data-item-id="ML-109458" data-option-id="custom"></span>&nbsp;, also CA-Schlüssel) die Zertifikatssignatur prüfbar ist.&nbsp;</li> 
     <li>(O1) Die RVE MUSS eine OCSP-Response, die nicht älter als 4 Stunden ist, für das zu prüfende AUT-Zertifikat dem SGD-HSM übergeben.</li> 
     <li>(O2) Die RVE MUSS dem SGD-HSM mitteilen über&nbsp;welchen Prüfschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17952-01" data-item-id="ML-109458" data-option-id="custom"></span>&nbsp;, also OCSP-Zertifikatsschlüssel) die OCSP-Response-Signatur prüfbar ist.&nbsp;</li> 
    </ol> Im Rahmen der Prüfung eines kurzlebigen öffentlichen ECIES-Schlüssels eines Client MUSS das SGD-HSM das vom Client verwendete AUT-Zertifikat&nbsp;(oder AUT_ALT-Zertifikat bei einer alternativen Versichertenidentität) wie folgt&nbsp;prüfen:<br> 
    <ol> 
     <li>Ist das Zertifikat zeitlich gültig, falls nein dann FAIL.</li> 
     <li>Ist die Zertifikatssignatur über den Schlüssel (K1) prüfbar (Signaturprüfung), falls nein dann FAIL.</li> 
     <li>Ist die OCSP-Response (O1) &nbsp;maximal 4 Stunden alt , falls nein dann FAIL.</li> 
     <li>Ist der Schlüssel (O2) berechtigt Sperraussagen bezüglich über (K1) bestätigte Zertifikate zu tätigen, falls nein dann FAIL.</li> 
     <li>Ist die OCSP-Response (O1) über den Schlüssel (O2) prüfbar (Signaturprüfung), falls nein dann FAIL.</li> 
     <li>Enthält das Zertifikat eine KVNR oder einen Telematik-ID, falls nein dann FAIL.&nbsp;(vgl. [gemSpec_SGD_ePA#Hinweis zu A_17919-01])&nbsp;</li> 
    </ol> &nbsp;Wenn keine Prüfung aus (1) bis (6) ein FAIL liefert, so MUSS das Prüfergebnis für das AUT-Zertifikat "OK" sein. <b>&lt;=</b></p>
  </div>
  <p id="polarion_106"></p>
  <p id="polarion_34"> Hinweis zu&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp;: </p>
  <p id="polarion_47">Das SGD-HSM kann davon ausgehen, dass die X.509-Root-CA und alle in der PKI-Hierarchie folgenden CAs korrekt formatierte Zertifikate ausgeben. Es muss also vom SGD-HSM nicht die vollständige Konformität der erhaltenen Zertifikate zu den in [gemSpec_PKI] definierten Zertifikatsprofilen geprüft werden, was technisch in einer beschränkten Laufzeitumgebung schwierig ist.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-95046|layout=1">
   <p><b>A_18010</b></p>
   <p>Ein SGD ePA MUSS sicherstellen, dass dessen SGD-HSM mindestens alle 24 Stunden die Schlüssel aus der Prüfschlüsselliste&nbsp;gemäß&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17952-01" data-item-id="ML-109458" data-option-id="custom"></span>&nbsp;&nbsp;auf zeitliche Gültigkeit hin überprüft. Ist eine solcher Prüfschlüssel nur noch weniger als 24 Stunden gültig, so MUSS das SGD-HSM diesen Schlüssel aus seiner Prüfschlüsselliste löschen. Ausgenommen davon sind die Root-Schlüssel aus&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17952-01" data-item-id="ML-109458" data-option-id="custom"></span>&nbsp;&nbsp;Punkt 2. <b>&lt;=</b></p>
  </div>
  <p id="polarion_278">Die Sonderbehandlung von Root-Schlüsseln im SGD-HSM in A_18010 ist analog definiert worden wie das Verhalten im COS bei G2-Karten. Ein SGD-HSM kann nach A_21274 davon abweichen und die Gültigkeitsdauer auch bei Root-Schlüsseln streng durchsetzen.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-116205|layout=1">
   <p><b>A_21274</b></p>
   <p>Ein SGD ePA KANN bei der Umsetzung von A_18010 auf die Sonderbehandlung von Root-Schlüsseln verzichten, d. h. diese KANN das SGD-HSM analog zu CA-Schlüsseln nach Ablauf der Gültigkeitsdauer im SGD-HSM löschen. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-96284|layout=1">
   <p><b>A_18027</b></p>
   <p>Ein SGD ePA MUSS sicherstellen, dass dessen SGD-HSM den Client-ECIES-Schlüssel und dessen Signatur wie folgt prüft.<br> 
    <ol> 
     <li>Ist der öffentliche ECIES-Schlüssel des Client nach <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span> korrekt kodiert?</li> 
     <li>Ist in der Kodierung ein Hashwert eines aktuellen öffentlichen ECIES-Schlüssels des SGD-HSM nach A_17894-01 vorhanden?</li> 
     <li>Liegt der öffentliche ECIES-Schlüssel des Clients auf der korrekten Kurve (vgl.&nbsp;<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_Krypt#A_17874]" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94671"></span>)?</li> 
     <li>Ist das Zertifikat des Clients gültig nach&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp;(Zertifikatsprüfung in einer SGD-HSM)?</li> 
     <li>Ist die Signatur auf des ECIES-Schlüssels des Client korrekt (valide) in Bezug auf das Zertifikat des Clients (bzw. des dort bestätigten EE-Schlüssels)?</li> 
    </ol> Liefert eine der Prüfungen ein nicht-positives Ergebnis, so MUSS das SGD-HSM die Verarbeitung mit einer entsprechenden Fehlermeldung an die RVE abbrechen. <b>&lt;=</b></p>
  </div>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-96283">4.5.2 Authentisierungstoken im SGD-HSM</h4>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-113414|layout=1">
   <p><b>A_18026-01</b></p>
   <p>Ein SGD ePA&nbsp;MUSS folgende Vorgaben durchsetzen:<br> Bei der Umsetzung von GetAuthenticationToken (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span>) MUSS die RVE dem SGD-HSM (das für den Client bestimmt ist)<br> 
    <ol> 
     <li>das Chiffrat und die für die Entschlüsselung&nbsp;notwendigen Informationen,</li> 
     <li>und das Client-Zertifikat inkl. der für die Zertifikatsprüfung im SGD-HSM gemäß&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp;notwendigen Informationen</li> 
    </ol> übergeben. <br> Das SGD-HSM MUSS das Client-Zertifikat gemäß&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp;prüfen und bei negativen Prüfergebnis abbrechen.<br> Das SGD-HSM MUSS die Signatur des Client-ECIES-Schlüssel und den ECIES-Schlüssel an sich gemäß <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18027" data-item-id="ML-96284" data-option-id="custom"></span>&nbsp;prüfen&nbsp;und bei negativen Prüfergebnis abbrechen.<br> Das SGD-HSM MUSS das Chiffrat entschlüsseln und dabei im Fehlerfall abbrechen.<br> Das SGD-HSM MUSS prüfen, ob der entschlüsselte Klartext der Form<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; &nbsp; Challenge &lt;256-Bit-hexadezimal-kodiert&gt;&nbsp;&lt;256-Bit-hexadezimal-kodiert&gt;<br> <br> </span>(Damit muss der Klartext also 9 + 2 + 2*64 = 139 Zeichen lang sein.)<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;"><br> </span> (Beispiel: <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; Challenge&nbsp;<span style="font-size: 10pt;line-height: 1.5;">f97cbc538b020d705a960a7e8fa5912c8e202fcf7d6516da3818eff68ce7e00d&nbsp;c4d0613a597826cfdca992d0a02d0ea26667829345033dee158a578cc8524cab</span></span><br> ) ist. Falls nein, dann MUSS das SGD-HSM mit einer entsprechenden Fehlermeldung abbrechen.<br> Das SGD-HSM MUSS die Zeichenkette A als Aneinanderführung von <br> 
    <ol> 
     <li>signierten Client-ECIES-Schlüssel in der Kodierung gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;, und</li> 
     <li>Client-AUT-Zertifikat</li> 
    </ol> bilden. <br> Das SGD-HSM MUSS H als SHA-256-Hashwert von A berechnen.<br> Das SGD-HSM MUSS prüfen, ob der Wert H hexadezimal kodiert gleich dem zweiten 256-Bit hexadezimal kodierten Wert im entschlüsselten Klartext ist. Falls nein, so MUSS das SGD-HSM die Verarbeitung des Request mit einer Fehlermeldung abbrechen.<br> Anschließend MUSS das SGD-HSM eine Schlüsselableitung mit dem Schlüssel (S5), der mit dem ECIES-SGD-HSM-Schlüssel (S4) verbunden ist, für den die Verschlüsselung durch den Client vorgenommen wurde, und dem erzeugten Ableitungsvektor A (info-Parameter) gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_18023" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-96279"></span>] durchführen.<br> Aus der Ableitung MUSS das SGD-HSM einen 256-Bit-Wert erhalten und diesen Hexadezimal kodieren und davor die Zeichenkette "AT" setzen. Das Ergebnis ist der Authentisierungstoken.<br> Beispiel:<br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; AT1ce627dd5e4c6536ca0dd93f896744d42c6580537953a49fcc5840dd8f8f4efa</span><br> <br> Anschließend MUSS das SGD-HSM eine Zeichenkette der folgenden Form bilden:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; &nbsp; Response &lt;vom-Client-erhaltener-hexadezimal-256-Bit-Wert&gt; &lt;H-in-Hexform&gt; &lt;Authentisierungstoken&gt;</span><br> Diese Zeichenkette muss das SGD-HSM mittels des ECIES-Verfahrens gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>] für den Client-ECIES-Schlüssel verschlüsseln und das Chiffrat an die RVE übergeben.<br> <b>&lt;=</b></p>
  </div>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-94536">4.5.3 Schlüsselableitung im SGD-HSM</h4>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94729|layout=1">
   <p><b>A_17926</b></p>
   <p>Ein SGD ePA MUSS folgende Vorgaben durchsetzen:<br> 
    <ol>
     <li>Wenn von einer Schlüsselableitung bei einer Ableitungsregel von der Variable <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">KVNR</span> ("<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&lt;KVNR&gt;</span>") gesprochen wird, so MUSS der SGD ePA aus dem AUT-Zertifikat einer eGK oder einer alternativen Versichertenidentität nur den Wert&nbsp; aus den "organizationalUnitName"-Datenfeldern verwenden, der den unveränderlichen Teil der KVNR bezeichnet („annnnnnnnn“) (vgl. [gemSpec_PKI#C.CH.AUT und C.CH.AUT_ALT – Authentisierung eGK]). D. h., die Institutionskennzeichen werden nicht verwendet.</li>
     <li>Wenn von einer Schlüsselableitung mit einem Ableitungsvektor "<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&lt;X&gt;</span>" gesprochen wird, so MUSS die Zeichenkette mit dem konkreten Wert der Variable <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">X</span> als "info"-Parameter nach&nbsp;[RFC-5869] (HKDF) verwendet werden (vgl. "Beispiel zu A_17926").</li>
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_292">Beispiel zu A_17926:</p>
  <p id="polarion_293">Sei RND="123" und KVNR="a4b5c6". Wenn im Algorithmus in Tabelle 3 a="r1:&lt;RND&gt;:&lt;KVNR&gt;" gesetzt wird, und a als Ableitungsvektor verwendet werden soll, so müssen die Werte der Variablen RND und KVNR interpoliert werden. Es entsteht damit die Zeichenkette a="r1:123:4a5b6c". Dieser Wert von a muss dann als Wert des Ableitungsvektor bei der Schlüsselableitung verwendet werden.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109460|layout=1">
   <p><b>A_17920-02</b></p>
   <p>Ein SGD ePA&nbsp;MUSS folgende Vorgaben durchsetzen:<br> 
    <ol> 
     <li>Es MUSS initial ein Ableitungsschlüssel (vgl. auch [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17876" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>]&nbsp; und &nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;(3)) für die&nbsp;Schlüsselableitung der versichertenindividuellen Schlüssel vorhanden sein.</li> 
     <li>Mindestens halbjährlich MUSS solch ein Ableitungsschlüssel neu erzeugt werden.</li> 
     <li>Jeder Ableitungsschlüssel MUSS einen innerhalb eines SGD eindeutigen Bezeichner besitzen.<br> Solch ein Ableitungsschlüsselbezeichner MUSS maximal 7 KiB groß sein und auf den PCRE [PCRE]<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">^\w[\w -]{1,7167}$</span><br> matchen.</li> 
     <li>Alle Ableitungsschlüssel MÜSSEN in allen SGD-HSM eines SGD zur Verfügung stehen.</li> 
     <li>Es MUSS, sofern kein&nbsp;Ableitungsschlüsselbezeichner beim Aufruf der Operation KeyDerivation (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>) angegeben wurde, immer der jüngste Ableitungsschlüssel bei der Schlüsselableitung der versichertenindividuellen Schlüssel verwendet werden.</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_102"> Hinweis: nach <span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_Krypt#A_17876]" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>wird für die Schlüssel als Schlüsselableitungsfunktion die HKDF nach [RFC-5869]&nbsp;auf Basis von SHA-256 verwendet. Ebenso befinden sich in [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17876" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>] die Vorgaben&nbsp;zur Mindestentropie. </p>
  <p id="polarion_114">Man beachte, dass absichtlich keine Doppelpunkte im Bezeichner zugelassen sind.</p>
  <p id="polarion_78">Beispiele für gültige Ableitungsschlüsselbezeichner:&nbsp;</p>
  <ul id="polarion_181"> 
   <li><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">ACME 2019-1</span></li> 
   <li><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">AB AbCdEfGhI 12 jklmn</span></li> 
  </ul>
  <p id="polarion_116">Testmöglichkeit:</p>
  <p id="polarion_149"> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">echo 'Bezeichner 2021-Test 1' | \</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">perl -ne 'print /^\w[\w -]{1,7167}$/ ? "OK: " : "UNGÜLTIG: ", $_;'</span> </p>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-94539">4.5.4 Kommando-Abarbeitung KeyDerivation im SGD-HSM</h4>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-96287|layout=1">
   <p><b>A_18030</b></p>
   <p>Ein SGD ePA&nbsp;MUSS folgende Vorgaben durchsetzen:<br> Bei der Umsetzung von KeyDerivation (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>) MUSS die RVE dem SGD-HSM (das für den <span style="text-decoration: line-through;background-color: #FFFF99;"></span>Client bestimmt ist) <br> 
    <ol> 
     <li>das Chiffrat und die für die Entschlüsselung&nbsp;notwendigen Informationen, und</li> 
     <li>das Client-AUT-Zertifikat</li> 
    </ol> übergeben. <br> Das SGD-HSM MUSS das Chiffrat mittels des ECIES-Verfahrens gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>] entschlüsseln und dabei im Fehlerfall abbrechen.<br> Das SGD-HSM MUSS prüfen, ob der erhaltene Klartext wie folgt beginnt<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; &nbsp; "AT&lt;256-Bit-Hexadezimal-kodierter-Wert&gt;" + " " + "&lt;256-Bit-Hexadezimal-kodierte-Zeichenkette (Request-ID)&gt;" + " "</span><br> und falls nein abbricht.<br> <br> Das SGD-HSM MUSS die Zeichenkette A als Aneinanderführung von <br> 
    <ol> 
     <li>signierten Client-ECIES-Schlüssel in der Kodierung gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>, und</li> 
     <li>Client-AUT-Zertifikat</li> 
    </ol> bilden. Anschließend MUSS das SGD-HSM eine Schlüsselableitung mit dem Schlüssel (S5), der mit dem ECIES-SGD-HSM Schlüssel (S4) verbunden ist für den die Verschlüsselung durch den Client vorgenommen wurde, und dem erzeugten Ableitungsvektor A (info-Parameter) gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_18023" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-96279"></span>] durchführen.<br> Aus der Ableitung MUSS das SGD-HSM einen 256-Bit-Wert erhalten und diesen Hexadezimal kodieren und davor die Zeichenkette "AT" setzen. Das Ergebnis ist das Authentisierungstoken.<br> Beispiel:<br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; AT1ce627dd5e4c6536ca0dd93f896744d42c6580537953a49fcc5840dd8f8f4efa</span><br> <br> Das SGD-HSM MUSS prüfen, ob der Authentisierungstoken mit dem Anfangswert des Klartextes übereinstimmt.<br> Falls nein, so MUSS das SGD-HSM mit entsprechender Fehlermeldung abbrechen.<br> <br> Das SGD-HSM MUSS mit der Kommando-Abarbeitung der Operation KeyDerivation gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17922" data-item-id="ML-94727" data-option-id="custom"></span>&nbsp;fortfahren. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94727|layout=1">
   <p><b>A_17922</b></p>
   <p>Ein SGD&nbsp;ePA MUSS folgende Vorgaben durchsetzen: Nachdem das SGD-HSM erfolgreich die Authentizität der Anfrage mittels&nbsp; <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18030" data-item-id="ML-96287" data-option-id="custom"></span>&nbsp;überprüft hat und den Klartext erhalten hat, MUSS es den erhaltenen Klartext analysieren. <br> Es entfernt den Authentisierungstoken und die Request-ID inkl. folgenden Leerzeichen vom Anfang der Nachricht des Clients und speichert das Authentisierungstoken und die Request-ID für die Erzeugung der Antwort.<br> (Beispiel:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp;"AT1ce627dd5e4c6536ca0dd93f896744d42c6580537953a49fcc5840dd8f8f4efa&nbsp;<span style="font-size: 10pt;line-height: 1.5;">7522d04ca28f2c6d3f5a53b2a31aebe1f91f2cfb75145b35c9a01fae7930340c&nbsp;</span>KeyDerivation r2:7f8f77003dbab49c3a4e32f44726f92324d292fa668fde5ebc3424397986be99:107299005A112102647:2-20a1201-001:Bezeichner ACME Q1 2020"<br> </span> <span style="font-family: Arial, Helvetica;">Das Authentisierungstoken ist gleich</span> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"AT1c...efa"</span><span style="font-family: Arial, Helvetica;">, die Request-ID ist gleich</span> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"7522..340c"</span><span style="font-family: Arial, Helvetica;">. Die restliche Zeichenkette des Klartexts ist die Eingabe für den Algorithmus in&nbsp;[gemSpec_SDG_ePA#Tab_Kommandoabarbeitung_im_SGD-HSM].<br> )</span><br> Das SGD-HSM MUSS den in [gemSpec_SDG_ePA#Tab_Kommandoabarbeitung_im_SGD-HSM] aufgeführten Algorithmus implementieren und verwenden. Wenn der Algorithmus mit einem FAIL abbricht, so MUSS das SGD-HSM dies mit einem entsprechender Fehlermeldung an das RVE weitergeben. <br> Anderenfalls MUSS das SGD-HSM die durch den Algorithmus erzeugte Antwort-Zeichenkette erweitern, indem es das gespeicherte Authentisierungstoken und die Request-ID inkl. folgenden Leerzeichen vor die Antwort-Zeichenkette stellt. Diese erhaltene Zeichenkette ist der Klartext, der den Client erreichen solle. Diesen Klartext MUSS das SGD-HSM&nbsp;gemäß den Vorgaben aus [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>] verschlüsseln (ECIES-Verfahren mit Authenticated Encryption) und mit einer positiven Rückmeldung (OK) an die RVE das erzeugte Chiffrat im Format gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>&nbsp;übergeben.<br> <b>&lt;=</b></p>
  </div>
  <p id="polarion_132" data-keep-next="true" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">4</span>: Tab_Kommandoabarbeitung_im_SGD-HSM </p>
  <table id="polarion_wiki macro name=table;params=header=no|width=100%|padding=2px|uid=1" class="polarion-Document-table" style="width: 100%;margin-left: auto;margin-right: auto;border: 1px solid #CCCCCC;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 748px;height: 560px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-size: 10pt;line-height: 1.5;">Sei mit "Nachricht" die authentifizierte Nachricht des Clients, ohne das Authentisierungstoken und die Request-ID (inkl. folgendem Leerzeichen) am Anfang der Nachricht, bezeichnet. Sei IKM das "input key material" und info das "info"-Feld beides gemäß [RFC-5869]. Mit "&lt;&gt;" sei die Variableninterpolation bezeichnet, bspw. mit a="x1y2z3" und s="a&lt;a&gt;" folgt s gleich "ax1y2z3".<br> <br> (1) Prüfe ob die Nachricht mit <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"KeyDerivation "</span> (14 Zeichen) beginnt, ansonsten FAIL.<br> (2) Sei s gleich die Nachricht ohne die ersten 14 Zeichen (also ohne <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"KeyDerivation "</span>).<br> (3) Prüfe ob s entweder mit <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r1"</span>, <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r2"</span> oder mit <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r3"</span> beginnt, ansonsten FAIL.<br> (4) Sei KVNR die authentifizierte KVNR gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17926" data-item-id="ML-94729" data-option-id="custom"></span>&nbsp;aus dem geprüften (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp;) AUT-Zertifikat. Falls das AUT-Zertifikat ein nicht-eGK-Zertifikat ist, dann sei KVNR="" (leere Zeichenkette).<br> (5) Sei TELEMATIK_ID die authentifizierte Telematik-ID aus dem geprüften (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp;) AUT-Zertifikat. Falls das AUT-Zertifikat ein eGK-Zertifikat ist, dann sei TELEMATIK_ID=<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">""</span> (leere Zeichenkette).<br> Hinweis:<br> die Prüfung, ob eine Umkodierung der TELEMATIK_ID notwendig ist (vgl. A_18003) erfolgt erst kurz vor dem Gebrauch der Variable in (12.5) oder (14.4). Der Entwickler kann selbst entscheiden, ob er schon hier die Prüfung durchführt.<br> (6) Sei BEZ der Schlüsselbezeichner (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17920-02" data-item-id="ML-109460" data-option-id="custom"></span>&nbsp;&nbsp;) des aktuellen (also jüngsten) Ableitungsschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;(S3)).<br> (7)&nbsp;Sei s[0] bis s[n] die Teilzeichenketten von s, die durch ":" getrennt werden.<br> (8) Wenn n gleich 0, dann FAIL.<br> <br> (Verständnishinweis: vgl. Abschnitt [gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span>]<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r1:&lt;KVNR&gt;"</span><br> )<br> (9) Wenn s[0] gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r1"</span>&nbsp;und n gleich 1 ist:<br> (9.1) Wenn KVNR gleich "" (leere Zeichenkette) ist, dann FAIL.<br> (9.2) Wenn s[1] ungleich KVNR, dann FAIL.<br> (9.3) Erzeuge RND gleich ein 256 Bit langer Zufallswert in Hexadezimalschreibweise kodiert ohne "0x" am Anfang.<br> (9.4) Erzeuge a=<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r1:&lt;RND&gt;:&lt;KVNR&gt;:&lt;BEZ&gt;"</span>.&nbsp;<br> (9.5) Sei Key die ersten 256 Bits der Schlüsselableitungsfunktion nach [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17876" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>] mit IKM der aktuelle Ableitungsschlüssel und info=a. Sei Key in&nbsp;Hexadezimalschreibweise kodiert ohne "0x" am Anfang.<br> (9.6) Die Antwort ist gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"OK-KeyDerivation "</span> + Key + <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">" "</span> + a.&nbsp;<br> (9.7) ENDE<br> <br> </span></td> 
    </tr> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 748px;height: 26px;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 2px;"><span style="font-size: 10pt;line-height: 1.5;">(Verständnishinweis: vgl. Abschnitt&nbsp;[gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94492" data-option-id="shortoutline"></span>]<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r1:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR&gt;:&lt;Ableitungsschlüsselbezeichner&gt;"</span><br> )<br> (10) Wenn s mit <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r1:"</span> beginnt:<br> (10.2) Wenn n ungleich 3 ist, dann FAIL.<br> (10.3) Wenn s[3] keinen im SGD-HSM verfügbaren Ableitungsschlüssel bezeichnet, dann FAIL.<br> (10.4) Wenn die Länge von s[1] ungleich 64 ist, dann FAIL.<br> (10.4) Wenn KVNR gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">""</span> (leere Zeichenkette), dann FAIL.<br> (10.5) Wenn s[2] ungleich KVNR ist, dann FAIL.<br> (10.6) Führe die Schlüsselableitung nach [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17876" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>] mit dem durch s[3] bezeichneten Ableitungsschlüssels (IKM) und info gleich s durch. Sei Key der abgeleitete 256-Bit Schlüssel in Hexadezimalschreibweise kodiert (ohne "0x").<br> (10.7) Die Antwort ist gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"OK-KeyDerivation "</span> + Key + <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">" "</span> + s.&nbsp;<br> (10.8) ENDE<br> <br> (Verständnishinweis: vgl. Abschnitt&nbsp;[gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94494" data-option-id="shortoutline"></span>]<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r2:&lt;KVNR-Vertreter oder Telematik-ID&gt;"</span><br> )<br> (11) Wenn s[0] gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r2"</span> ist und n gleich 1:<br> (11.1) Wenn s[1] gleich "" (leere Zeichenkette), dann FAIL.<br> (11.2) Wenn KVNR gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">""</span> (leere Zeichenkette), dann FAIL.<br> (11.3) Erzeuge RND gleich ein 256 Bit langer Zufallswert in Hexadezimalschreibweise kodiert ohne "0x" am Anfang.<br> (11.4) Erzeuge a=<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r2:&lt;RND&gt;:&lt;KVNR&gt;:"</span> + s[1] + <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">":&lt;BEZ&gt;"</span><br> (11.5)&nbsp;Sei Key die ersten 256 Bits der Schlüsselableitungsfunktion nach [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17876" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>] mit IKM der aktuelle Ableitungsschlüssel und info=a. Sei Key in&nbsp;Hexadezimalschreibweise kodiert ohne "0x" am Anfang.<br> (11.6) Die Antwort ist gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"OK-KeyDerivation "</span>&nbsp;+ Key + <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">" "</span> + a.&nbsp;<br> (11.7) ENDE<br> <br> (Verständnishinweis: vgl. Abschnitt&nbsp;[gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94739" data-option-id="shortoutline"></span>]<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r2:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter oder Telematik-ID&gt;:&lt;Ableitungsschlüsselbezeichner&gt;"</span><br> )<br> (12) Wenn s[0] gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r2"</span> ist:<br> (12.1) Wenn n ungleich 4 ist, dann FAIL.<br> (12.2) Wenn die Länge von s[1] ungleich 64 ist, dann FAIL.<br> (12.3) Wenn s[2] gleich "" (leere Zeichenkette), dann FAIL.<br> (12.4) Wenn s[4] keinen im SGD-HSM verfügbaren Ableitungsschlüssel bezeichnet, dann FAIL.<br> (12.5) Wenn KVNR gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">""</span> (leere Zeichenkette) und (logisches und) TELEMATIK_ID gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">""</span> (leere Zeichenkette), dann FAIL.<br> (12.6) Führe für die Variable TELEMATIK_ID die Prüfung und ggf. Umkodierung nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18003" data-item-id="ML-95024" data-option-id="custom"></span>&nbsp;durch.<br> (12.7) Wenn (s[3] ungleich TELEMATIK_ID) und (logisches und) (s[3] ungleich KVNR), dann FAIL.<br> (12.8) Führe die Schlüsselableitung nach [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17876" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>] mit dem durch s[4] bezeichneten Ableitungsschlüssels (IKM) und info gleich s durch. Sei Key der abgeleitete 256-Bit Schlüssel in Hexadezimalschreibweise kodiert (ohne "0x").<br> (12.9) Die Antwort ist gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"OK-KeyDerivation "</span> + Key + <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">" "</span> + s.&nbsp;<br> (12.10) ENDE<br> <br> (Verständnishinweis: vgl. Abschnitt&nbsp;[gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94738" data-option-id="shortoutline"></span>&nbsp;]<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r3:&lt;Telematik-ID&gt;:&lt;KVNR-Kontoinhaber&gt;"</span><br> )<br> (13) Wenn s[0] gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r3"</span> und n gleich 2:<br> (13.1) Wenn KVNR gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">""</span> (leere Zeichenkette) ist, dann FAIL.<br> (13.2) Erzeuge RND gleich ein 256 Bit langer Zufallswert in Hexadezimalschreibweise kodiert ohne "0x" am Anfang.<br> (</span>13.3)<span style="font-size: 10pt;line-height: 1.5;"> Erzeuge a=<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r3:&lt;RND&gt;:" + s[2] + ":&lt;KVNR&gt;:" + s[1] + ":&lt;BEZ&gt;"</span><br> (13.4) Sei Key die ersten 256 Bits der Schlüsselableitungsfunktion nach [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17876" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>] mit IKM gleich der aktuelle Ableitungsschlüssel und info=a. Sei Key in&nbsp;Hexadezimalschreibweise kodiert ohne "0x" am Anfang.<br> (13.5) Die Antwort ist gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"OK-KeyDerivation "</span> + Key + <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">" "</span> + a.&nbsp;<br> (13.6) ENDE<br> <br> (Verständnishinweis: vgl. Abschnitt&nbsp;[gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94741" data-option-id="shortoutline"></span>]<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r3:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter&gt;:&lt;Telematik-ID&gt;:&lt;aktueller Ableitungsschlüsselbezeichner&gt;"</span><br> )<br> (14)&nbsp;Wenn s[0] gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r3"</span> ist:<br> (14.1) Wenn n ungleich 5 ist, dann FAIL.<br> (14.2) Wenn die Länge von s[1] ungleich 64 ist, dann FAIL.<br> (14.3) Wenn s[5] keinen im SGD-HSM verfügbaren Ableitungsschlüssel bezeichnet, dann FAIL.<br> (14.4) Führe für die Variable TELEMATIK_ID die Prüfung und ggf. Umkodierung nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18003" data-item-id="ML-95024" data-option-id="custom"></span>&nbsp;durch.<br> (14.5) Wenn s[4] ungleich TELEMATIK_ID, dann FAIL.<br> (14.6) Sei Key die ersten 256 Bits der Schlüsselableitungsfunktion nach [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17876" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94673"></span>] mit IKM gleich der aktuelle Ableitungsschlüssel und info gleich s. Sei Key in&nbsp;Hexadezimalschreibweise kodiert ohne "0x" am Anfang.<br> (14.7) Die Antwort ist gleich <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"OK-KeyDerivation "</span> + Key + <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">" "</span> + s.&nbsp;<br> (14.8) ENDE<br> <br> (15) FAIL</span></td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_73"></p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-102756|layout=1">
   <p><b>A_17924-01</b></p>
   <p>Ein Client eines SGD ePA MUSS für die Anfragen an das SGD-HSM die Syntax der Kommandos und der Antworten des SGD-HSMs (für die Kommandos im verschlüsselten "EncryptedMessage"-Feld in <span data-option-id="custom" data-item-id="ML-94696" data-custom-label="A_17898" id="fake" data-type="crossReference" class="polarion-rte-link"></span>&nbsp;und die Auswertung der entschlüsselten Antwort (<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"&lt;Authentisierungstoken&gt; &lt;Request-ID&gt; OK-KeyDerivation ..."</span>)) gemäß&nbsp;<span data-option-id="custom" data-item-id="ML-94727" data-custom-label="A_17922" id="fake" data-type="crossReference" class="polarion-rte-link"></span>&nbsp;verwenden und auswerten können. <b>&lt;=</b></p>
  </div>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-113376">4.5.5 Betriebsunterstützende Leistungen im SGD-HSM</h4>
  <p id="polarion_62"></p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-113377|layout=1">
   <p><b>A_20975</b></p>
   <p>Ein SGD ePA MUSS folgende Vorgaben durchsetzen: Ein SGD-HSM MUSS es ermöglichen die aktuell im SGD-HSM gültigen Zertifikatssignaturprüfschlüssel (S2) (inkl. der Root-Schlüssel) (vgl. A_17910-*) mit ihren konkreten Schlüsselwerten (öffentliche Schlüsselwerte) auszugeben. &lt;= <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-113378|layout=1">
   <p><b>A_20976</b></p>
   <p>Ein SGD ePA MUSS folgende Vorgaben durchsetzen: Ein SGD-HSM MUSS es ermöglichen über alle im SGD-HSM befindlichen Ableitungsschlüssel (S3) (vgl. A_17910-*) zu iterieren und dabei pro Ableitungsschlüssel das Tupel (dessen Ableitungsschlüsselbezeichner (vgl. A_17920-*), dessen Ableitungsschlüsselprüfwert) auszugeben.<br> Der Ableitungsschlüsselprüfwert eines Ableitungsschlüssels wird erzeugt indem man<br> 
    <ol> 
     <li>den Ableitungsschlüssel bei einer Schlüsselableitung gemäß gemSpec_Krypt#A_17876 (also HKDF nach [RFC-5869] auf Basis von SHA-256) verwendet mit dem Ableitungsvektor „Ableitungsschluesselpruefwert-Schluessel-S3“ (”info” Parameter aus [RFC-5869]),</li> 
     <li>damit einen 256 Bit Wert ableitet (d. h. deterministisch erzeugt), und</li> 
     <li>diesen Wert hexadezimal kodiert.Dieser 64 Zeichen lange hexadezimal kodierte Wert ist dann der Ableitungsschlüsselprüfwert des betrachteten Ableitungsschlüssels.</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-127053">4.6 Betriebsunterstützende Leistungen allgemein</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126773|layout=1">
   <p><b>A_22501</b></p>
   <p>Ein SGD ePA MUSS als Teil des Lieferumfangs SGD-Produkt einem Betreiber des SGD Kommandozeilen-Tools zur Verfügung stellen, die folgende Leistungen ermöglichen.<br> 
    <ol> 
     <li>Die Leistungen von A_20975-* und A_20976-* MÜSSEN für den Betreiber per Tool erreichbar (ausführbar) und per Kommando-Zeilen-Tool auch automatisiert <span id="polarion-comment:398"></span>ausführbar sein.</li> 
     <li>Neue Prüfschlüssel (S2) (vgl. A_17910-*) also Root-Schlüssel, CA-Schlüssel und OCSP-Schlüssel MÜSSEN für den Betreiber ohne Beteiligung der gematik über die Cross-Zertifizierung und die Prüfung durch das SGD-HSM auf Grundlage von schon im SGD-HSM vorhandenen Schlüssel per Tool importierbar sein.<br> Dies ist notwendig falls durch Fehlfunktion im SGD diese nicht automatisch durch den SGD in die SGD-HSM importiert wurden&nbsp;(vgl. A_17952-*, A_17953-*, A_17954-*). Dann kann der Betreiber den Import "per Hand" ohne Mitwirkung der gematik durchführen (vgl. auch A_22502-*).</li> 
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_327"> <span id="polarion-comment:396"></span>&nbsp;Die RVE ist dafür verantwortlich neu in der TSL aufgeführte Prüfschlüssel automatisch in die SGD-HSM zu importieren (vgl. Abschnitt "<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94787" data-option-id="longoutline"></span>&nbsp;"). Die SGD-HSM stellen die Authentiztität der neu importieren Prüfschlüssel über die Signaturprüfung auf Grundlage von schon im SGD-HSM vorhandenen Root- und CA-Schlüsseln sicher. Um im Betrieb zu erkennen, ob dieses Update evtl. fehlerhafter Weise nicht erfolgt ist, wird mit A_22502-* eine automatische Überprüfung (Abgleich Ist-Soll-Stand der Prüfschlüssel in den SGD-HSM) gefordert. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126774|layout=1">
   <p><b>A_22502</b></p>
   <p>Der Anbieter eines SGD ePA MUSS sicherstellen, dass der SGD mindestens einmal pro Woche die von der gematik veröffentlichte Liste der öffentlichen (S2)-Zertifikatssignaturprüfschlüssel (Soll-Wert) mit den in den SGD-HSM befindlichen (S2)-Zertifikatssignaturprüfschlüssel abgleicht. Falls es beim Abgleich sich eine Differenz ungleich Null ergibt, so MUSS der Anbieter den Änderungsbedarf analysieren und die fehlenden Prüfschlüssel (vgl. A_22501-* Punkt 2) in den SGD-HSM ergänzen. <b>&lt;=</b></p>
  </div>
  <p id="polarion_326"> <span id="polarion-comment:397"></span>Erläuterung: die URL für den Download der Soll-Wert-Liste erfragt der Anbieter (bzw. der Betreiber) bei der gematik. Das Format der Soll-Wert-Liste ist das aus der gemeinsamen Schlüsselzeremonie Erst-Initialisierung der SGD-HSM (chk_import_list.py). </p>
  <p id="polarion_328"> Die Umsetzung des Fehlererkennungsteils von A_22502 ist in nur wenigen Zeilen Bash-Skript möglich.<span id="polarion-comment:399"></span> </p>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94544">5 Kodierung von Schlüsseln und Nachrichten</h2>
  <p id="polarion_202">Im Rahmen des SGD-Protokolls müssen verschiedene Zahlenwerte (Koordinaten von Kurvenpunkten) und Hashwerte (Hashwerte von Schlüsselwerten) kodiert werden. Diese Kodierungen fließen an mehreren Stellen in eine Hashwerterzeugung mit ein. Dabei ist es wichtig, ob bspw. die Zahl 10 als "0xa" oder "0xA" kodiert wird. Analog bei Hashwerten in Hexadezimalform, die in eine Hashwerterzeugung mit einfließen.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-98179|layout=1">
   <p><b>A_18249</b></p>
   <p>Ein SGD ePA und ein Client eines SGD ePA MÜSSEN sicherstellen, dass, wenn sie Datenfeld in Hexadezimalform kodieren, sie stets kleine Buchstaben bei der Hexadezimal-Kodierung verwenden (a-f und nicht A-F). <b>&lt;=</b></p>
  </div>
  <p id="polarion_170"> Gut-Beispiel (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;): </p>
  <p id="polarion_175"> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"brainpoolP256r1 " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x3672030bace787aa319e21d40645b2999006beec437fd084dd3fc592f5fcd77c" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x335b226ce5fac0c36a18ce42e95f43c9eed3e256bdd0c98e55a069595515d15b" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"a3a56e51377c1de0bea0522eba3ec6277e3355edb67d48b9852ab7d7e536feb7" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"8b2405f41cebaf44d10b2c9025484515b005be5ba785d0c898eae0739a67eb5a"</span> </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-98180|layout=1">
   <p><b>A_18250</b></p>
   <p>Ein SGD ePA und ein Client eines SGD ePA MÜSSEN sicherstellen, dass wenn sie Koordinaten von Kurvenpunkten in Hexadezimalform kodieren, keine führende(n) Null(en) verwenden:<br> OK: "0xa8f217b77338f1d4d6624c3ab4f6cc16d2aa843d0c0fca016b91e2ad25cae39d"<br> Falsch: "0x0a8f217b77338f1d4d6624c3ab4f6cc16d2aa843d0c0fca016b91e2ad25cae39d"<br> Falsch: "0x00a8f217b77338f1d4d6624c3ab4f6cc16d2aa843d0c0fca016b91e2ad25cae39d" <b>&lt;=</b></p>
  </div>
  <p id="polarion_205"> Bei der Kodierung der ECIES-Schlüssel (vgl. <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;&nbsp;und&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>) müssen X- und Y-Koordinaten als Zahlenwerte in Hexadezimalform in einer menschenlesbaren Zeichenkette (string) kodiert werden. Es gibt Kryptographie-Softwarebibliotheken, die falls die Koordinatenwerte mit einer 1 im most-significant Byte beginnen, ein Nullbyte vor den Koordinatenwert setzen. Dies kommt aus einer Konvention aus der ASN.1-Kodierungsweise, die im SGD-Kontext keine Rolle spielt (Ausnahme im DER-kodierten Zertifikat selbst). Beispiel: Die Zahl 128 muss Hexadezimal als "0x80" und nicht als "0x0080" kodiert werden. </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94545">5.1 Kodierung von Schlüsseln</h3>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-94699">5.1.1 ECIES-Schlüssel eines SGD-HSM</h4>
  <p id="polarion_216"> Bei der Operation GetPublicKey (A_17895-*) muss der aktuelle öffentliche ECIES-Schlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp; (S4))&nbsp;des SGD-HSMs an einen Client versendet werden. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-109378|layout=1">
   <p><b>A_17894-01</b></p>
   <p>Ein SGD ePA MUSS sicherstellen, dass der signierte öffentliche ECIES-Schlüssel inkl. Zertifikat eines SGD-HSMs in folgender Kodierung übertragen (vgl. Operation GetPublicKey,&nbsp;A_17895-*)&nbsp;wird.<br> <br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "PublicKeyECIES" : "&lt;KurvenID&gt; 0x&lt;X-Koordinate&gt; 0x&lt;Y-Koordinate&gt;",</span><br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; "Signature" : "... Base64-kodierte-ECDSA-Signatur ...",</span><br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; "Certificate" : "... Base64-kodiertes Zertifikat vgl.</span> <span style="font-size: 10pt;line-height: 1.5;"><span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17846-01" data-item-id="ML-109456" data-option-id="custom"></span>&nbsp;</span><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp;und&nbsp;</span><span style="font-size: 10pt;line-height: 1.5;"><span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17918-01" data-item-id="ML-109457" data-option-id="custom"></span>&nbsp;</span><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp;..." }</span><br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">}</span><br> <br> <b>&lt;=</b></p>
  </div>
  <p id="polarion_204"> Hinweis zum besseren Verständnis: Da das Zertifikat im "Certificate"-Datenfeld direkt in der TSL aufgeführt ist (vgl.<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17847" data-item-id="ML-94621" data-option-id="custom"></span>) und die TSL eine Positivliste ist, gibt es&nbsp;keine Aufführung (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;)&nbsp;oder Einholung von OCSP-Responses. </p>
  <p id="polarion_133" data-keep-next="true" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">5</span>: Beispiel zu A_17894 </p>
  <table id="polarion_wiki macro name=table;params=header=no|width=100%|uid=2" class="polarion-Document-table" style="width: 100%;margin-left: auto;margin-right: auto;border: 1px solid #CCCCCC;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 194px;border: 1px solid #CCCCCC;padding: 5px;"><span style="font-size: 10pt;line-height: 1.5;">Sei der aktuelle private ECIES-Schlüssel eines SGD-HSM d=2, dann ist der öffentliche Punkt 2*G [RFC-5639] aufgrund von [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17694" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94215"></span>]. Damit ist das "PubKeyECIES"-Datenfeld nach&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp; folgende Zeichenkette:</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"brainpoolP256r1" + " " +&nbsp;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x743cf1b8b5cd4f2eb55f8aa369593ac436ef044166699e37d51a14c2ce13ea0e" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x36ed163337deba9c946fe0bb776529da38df059f69249406892ada097eeb7cd4"</span><br> <br> <span style="font-size: 10pt;line-height: 1.5;">Für die bitgenaue Aufführung wird nachfolgend das Datenfeld auch noch einmal Base64-kodiert angegeben:</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">YnJhaW5wb29sUDI1NnIxIDB4NzQzY2YxYjhiNWNkNGYyZWI1NWY4YWEzNjk1OTNhYzQzNmVmMDQ0</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">MTY2Njk5ZTM3ZDUxYTE0YzJjZTEzZWEwZSAweDM2ZWQxNjMzMzdkZWJhOWM5NDZmZTBiYjc3NjUy</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">OWRhMzhkZjA1OWY2OTI0OTQwNjg5MmFkYTA5N2VlYjdjZDQK</span> </td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_209"></p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94697|layout=1">
   <p><b>A_17899</b></p>
   <p>Ein Client eines SGD ePA MUSS als Antwort auf einen GetPublicKey-Request (A_17895-*) die Kodierung nach&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp; des öffentlichen ECIES-Schlüssels eines SGD-HSMs auswerten können. <b>&lt;=</b></p>
  </div>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-94698">5.1.2 ECIES-Schlüssel eines Clients</h4>
  <p id="polarion_207">Das kurzlebige ECIES-Schlüsselpaar eines Clients (ePA-FdV, FM EPA etc.) muss an die aktuellen öffentlichen ECDH-Schlüssel des nun angefragten SGD-HSM "gebunden" werden. Dies geschieht über die Signatur durch die eGK, die alternative Versichertenidentität, die SMC-B oder eine SMC-KTR.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94700|layout=1">
   <p><b>A_17900</b></p>
   <p>Ein Client eines SGD ePA MUSS für die Kodierung des "PublicKeyECIES"-Feldes folgende Kodierung verwenden (vgl.&nbsp;A_17895-*):<br> <br> "<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&lt;KurvenID&gt;" + " " + "0x&lt;X-Koordinate&gt;" + " " + "0x&lt;Y-Koordinate&gt;" + " " + "&lt;SHA-256-Hashwert-PubKey-SGD1-HSM-Hexdump-Form&gt;" + " " + "&lt;SHA-256-Hashwert-PubKey-SGD2-HSM-Hexdump-Form&gt;" </span><br> (vgl. [gemSpec_SGD_ePA#Hinweis zu A_17900]). <b>&lt;=</b></p>
  </div>
  <p id="polarion_217">Hinweis zu A_17900: vor den SHA-256-Hashwerten steht kein "0x"-Präfix, weil es sich bei SHA-256-Hashwerten nicht um Zahlen handelt, sondern um 256-Bit große Bitfelder.</p>
  <p id="polarion_143" data-keep-next="true" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">6</span>: Beispiel zu A_17900 </p>
  <table id="polarion_wiki macro name=table;params=header=no|width=100%|padding=2px|uid=2" class="polarion-Document-table" style="width: 100%;margin-left: auto;margin-right: auto;border: 1px solid #CCCCCC;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 96.6667px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-size: 10pt;line-height: 1.5;">Im Beispiel wird zunächst ein ECIES-Schlüssel für SGD 1 erzeugt (Schritt 1) und dann für SGD 2 (Schritt 2).</span><br> <span style="font-size: 10pt;line-height: 1.5;">Danach wird ein ECIES-Schlüssel vom Client erzeugt und die Hashwerte der beiden SGD-Schlüssel (aus Schritt 1 und Schritt 2) werden in die Kodierung des öffentlichen Client-Schlüssels mit aufgenommen (Schritt 3).</span><br> <span style="font-size: 10pt;line-height: 1.5;"> </span><br> <span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Schritt 1,&nbsp;aktueller Schlüssel SGD 1:</span><br> </td> 
    </tr> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 174px;border: 1px solid #CCCCCC;padding: 2px;">Sei als Beispiel der aktuelle private ECIES-Schlüssel eines SGD-HSM vom SGD 1:<br> 
      <div style="margin-left: 40px;">
       d=2.
      </div> Dann ist der öffentliche Punkt d*G=2*G [RFC-5639] aufgrund von [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17694" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94215"></span>]. Somit ist das "PubKeyECIES"-Datenfeld nach&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp; folgende Zeichenkette:<br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"brainpoolP256r1" + " " +&nbsp;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x743cf1b8b5cd4f2eb55f8aa369593ac436ef044166699e37d51a14c2ce13ea0e" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x36ed163337deba9c946fe0bb776529da38df059f69249406892ada097eeb7cd4</span><br> dessen SHA-256-Hashwert ist folglich<br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">a3a56e51377c1de0bea0522eba3ec6277e3355edb67d48b9852ab7d7e536feb7</span><br> </td> 
    </tr> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 18.4444px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-weight: bold;">Schritt 2, aktueller Schlüssel SGD 2:</span><br> </td> 
    </tr> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 117.111px;border: 1px solid #CCCCCC;padding: 2px;">Analog der aktuelle Schlüssel des verwendeten SGD-HSM vom SGD 2 mit d=3:<br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"brainpoolP256r1 " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0xa8f217b77338f1d4d6624c3ab4f6cc16d2aa843d0c0fca016b91e2ad25cae39d" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x4b49cafc7dac26bb0aa2a6850a1b40f5fac10e4589348fb77e65cc5602b74f9d"</span><br> dessen SHA-256-Hashwert ist damit<br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">8b2405f41cebaf44d10b2c9025484515b005be5ba785d0c898eae0739a67eb5a</span><br> </td> 
    </tr> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 37.1111px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-weight: bold;">Schritt 3, an die beiden Schlüssel über die Hashwerte und die folgende Signatur gebundener ephemerer ECIES-Schlüsselwert des Clients:</span><br> </td> 
    </tr> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 174.889px;border: 1px solid #CCCCCC;padding: 2px;">Dessen privater Schlüssel sei als Beispiel d=4. Damit ergibt sich mit den Schritten 1 und 2 zusammen folgende Zeichenkette.<br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"brainpoolP256r1 " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x3672030bace787aa319e21d40645b2999006beec437fd084dd3fc592f5fcd77c" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x335b226ce5fac0c36a18ce42e95f43c9eed3e256bdd0c98e55a069595515d15b" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"a3a56e51377c1de0bea0522eba3ec6277e3355edb67d48b9852ab7d7e536feb7" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"8b2405f41cebaf44d10b2c9025484515b005be5ba785d0c898eae0739a67eb5a"</span><br> <br> Diese Zeichenkette würde dann als Wert im Value-Feld beim "PublicKeyECIES"-Feld in einem Request bei&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898 (KeyDerivation)" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;stehen.<br> </td> 
    </tr> 
   </tbody> 
  </table>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94701|layout=1">
   <p><b>A_17901</b></p>
   <p>Ein Client eines SGD ePA MUSS die Kodierung des eigenen kurzlebigen ECIES-Schlüssels nach <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;signieren (mittels des AUT- oder AUT_ALT-Materials). Diese Signatur MUSS von ihm Base64-kodiert in den Value-Teil des "Signature"-Felds bei der Operation&nbsp;GetAuthenticationToken (A_18025-*) und&nbsp;KeyDerivation&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp; für einen Request eingetragen werden.<br> <b>&lt;=</b></p>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94550">5.2 Kodierung von Chiffraten</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94703|layout=1">
   <p><b>A_17902</b></p>
   <p>Ein SGD ePA und ein Client eines SGD ePA MÜSSEN sicherstellen, dass die in den "EncryptedMessage"-Feldern bei <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;&nbsp;(GetAuthenticationToken) und bei <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898 (KeyDerivation)" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;kodierten Chiffrate (jeweils bei dem Request und bei der Response) folgendes Format aufweisen:<br> <br> Hilfsdefinitionen:<br> 
    <ol> 
     <li>Sei "ECC-Punkt-Empfänger" der öffentliche Empfängerschlüssel in der Kodierung nach [<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;&nbsp;#"PublicKeyECIES"-Datenfeld]&nbsp;(<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"&lt;KurvenID&gt; 0x&lt;X-Koordinate&gt; 0x&lt;Y-Koordinate&gt;"</span>).<br> </li> 
     <li>Sei "ephemer-Sender-ECC-Punkt" der pro ECIES-Verschlüsselung vom Sender ephemer zu erzeugende öffentlichen ECC-Punkt. Dieser ist in der Kodierung<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"0x&lt;X-Koordinate&gt; 0x&lt;Y-Koordinate&gt;"</span> kodiert.<br> </li> 
     <li>Sei "Base64-Ciphertext-AES-GCM" das Base64-kodierte AES-GCM-Chiffrat, wobei das AES-GCM-Chiffrat aus der Aneinanderreihung folgender Bestandteile besteht:<br> 12 Byte IV + AES-GCM-Ciphertext + 16 Byte AuthTag (ICV). (vgl. auch [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>])<br> </li> 
    </ol> Das Format MUSS folgende Form besitzen:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"&lt;ECC-Punkt-Empfänger&gt; &lt;ephemer-Sender-ECC-Punkt&gt; &lt;Base64-Ciphertext-AES-GCM&gt;"</span><br> <br> (vgl. auch "Beispiel zu&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>")<br> <b>&lt;=</b></p>
  </div>
  <p id="polarion_141"> Hinweise zu&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>: </p>
  <ol id="polarion_100"> 
   <li>Der bei den Requests bei&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;&nbsp;(GetAuthenticationToken) und bei <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898 (KeyDerivation)" data-item-id="ML-94696" data-option-id="custom"></span> übergebene ECIES-Schlüssel hat nach <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;die beiden Hashwerte der SGD-HSMs Schlüssel von SGD 1 und SGD 2 beigefügt (durch die Signatur des Client mit authentisiert). Beim der Chiffratkodierung nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>&nbsp;sind die beiden Hashwerte kein Teil des Chiffrats, weil sie dort fachlich nicht notwendig sind.</li> 
   <li>Beim pro ECIES-Verschlüsselung vom Sender zu erzeugende ephemeren ECC-Punkt ("ephemer-Sender-ECC-Punkt") wird der Kurvenidentifikator (KurvenID) nicht mit aufgeführt, da der ECC-Punkt auf der gleichen Kurve wie der Empfänger ECC-Punkt liegen muss (vgl.<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17903" data-item-id="ML-94702" data-option-id="custom"></span>).</li> 
  </ol>
  <p id="polarion_146"> Beispiel zu&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>: </p>
  <p id="polarion_260"> Sei durch den Client folgender Klartext im Rahmen der Operation KeyDerivation (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18029" data-item-id="ML-96286" data-option-id="custom"></span>) vom Client an ein SGD-HSM zu übertragen: </p>
  <p id="polarion_151"> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"AT1ce627dd5e4c6536ca0dd93f896744d42c6580537953a49fcc5840dd8f8f4efa&nbsp;</span><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">7522d04ca28f2c6d3f5a53b2a31aebe1f91f2cfb75145b35c9a01fae7930340c&nbsp;</span><span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">KeyDerivation r2:7f8f77003dbab49c3a4e32f44726f92324d292fa668fde5ebc3424397986be99:107299005A112102647:2-20a1201-001:Bezeichner ACME Q1 2020"</span> </p>
  <p id="polarion_160">Dann hat das für den Request vom Client zu erzeugende&nbsp;Chiffrat ("EncryptedMessage"-Feld im Request) folgende Form</p>
  <p id="polarion_169"> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"brainpoolP256r1" + " " +&nbsp;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x743cf1b8b5cd4f2eb55f8aa369593ac436ef044166699e37d51a14c2ce13ea0e" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x36ed163337deba9c946fe0bb776529da38df059f69249406892ada097eeb7cd4" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0xa8f217b77338f1d4d6624c3ab4f6cc16d2aa843d0c0fca016b91e2ad25cae39d" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"0x4b49cafc7dac26bb0aa2a6850a1b40f5fac10e4589348fb77e65cc5602b74f9d" + " " +</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"pvUazQKriCfuE5wUX74yj5lvnzygbaUgtP/gAY1aPs1NjXCiWseV4GquSKdMozNoYsfIf0LbdpLwKdUSFYz2dySspGLTUBpmalYz/6G/B5M19y6Ce+TyoLJehTB0TzzAD9pwzVSJFsUiYCUG1KU6SohSjAIxHrebyo7+MYuQAd4uPnZ3ZiDukWglDr/7fTUafAEiF5gS0T+LRcaKimfSmPQjtjomgjn6jfl5u9gSyrAwOTCuVkZpSY6yjI1LjEy2jKRpMov4DiYTCMMbY8fLG1PmBp4SDvoLd7p+2ay9cyx1qYU43/zbxQGfK3nzBtFKMggS+73rHJpCL+0FPYoqTRkSAN17vxRUHCBESUfd9aAar3ZrhMrQwSj/QKnyG6Gg43WHYMjT6znsHxA="</span> </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94702|layout=1">
   <p><b>A_17903</b></p>
   <p>Ein SGD ePA und ein Client eines SGD-ePA MÜSSEN sicherstellen, dass sie die beim Empfang einer über das ECIES-Verfahren verschlüsselten Nachricht den vom Sender erzeugten ephemeren ECC-Punkt überprüfen:<br> 
    <ol> 
     <li>Dieser ECC-Punkt MUSS auf der gleichen elliptischen Kurve wie der Empfänger-ECC-Punkt liegen.</li> 
    </ol> (Hinweis: der Punkt im Unendlichen ist ebenfalls ein ungültiger Punkt. Dieser Punkt kann aufgrund des Kodierungsformats aus <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>&nbsp;hier nicht auftreten.)<br> <b>&lt;=</b></p>
  </div>
  <p id="polarion_264"> Verständnishinweis zu&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17903" data-item-id="ML-94702" data-option-id="custom"></span>&nbsp;: Da dies ein häufig auftretender sicherheitskritischer Implementierungsfehler ist, wird auf diesen Punkt explizit hingewiesen und damit eine gesonderte Stellungnahme diesbezüglich im Produktsicherheitsgutachten gefordert. </p>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94553">6 Schnittstellen und Operationen</h2>
  <p id="polarion_103">Der SGD ePA bietet innerhalb der TI eine HTTPS-Schnittstelle als Kommunikationsschnittstelle an.</p>
  <p id="polarion_104">Die gematik stellt auf Anfrage eine Beispiel-Implementierung für die Außenschnittstellen eines SGD bereit.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94554">6.1 Innenschnittstellen</h3>
  <p id="polarion_148">Die Innenschnittstellen zwischen der Request verarbeitende Einheit (RVE) für die eingehenden HTTP-Request und dem SGD-HSM sind SGD-intern. Deren Ausgestaltung bleibt dem Betreiber überlassen.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94555">6.2 HTTPS-Schnittstellen und HTTP-Kommunikation</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94687|layout=1">
   <p><b>A_17889</b></p>
   <p>Ein SGD ePA MUSS Folgendes sicherstellen:<span style="font-size: 10pt;line-height: 1.5;"><br></span> 
    <ol>
     <li>Der SGD MUSS über&nbsp;eine HTTPS-Außenschnittstelle in der TI verfügbar sein<span style="font-size: 10pt;line-height: 1.5;">.</span></li>
     <li>Für diese HTTPS-Schnittstelle MUSS der SGD ein TLS-Fachdienst Zertifikat (inkl. privatem Schlüssel) mit dem Profil C.FD.TLS-S (vgl. [gemSpec_PKI#C.FD.TLS-S Server-Authentisierung] und OID "oid_sgd" [gemSpec_OID]) aus der Komponenten-PKI der TI besitzen und verwenden.<br></li>
     <li>Der SGD MUSS bei der HTTPS-Schnittstelle HTTP Version 1.1 unterstützen.</li>
     <li>Über diese HTTPS-Schnittstelle MUSS der SGD HTTP-POST-Request mit dem Content-Type 'application/json' entgegennehmen.</li>
     <li>Antworten MUSS der SGD auf einen solchen HTTP-POST-Request immer mit einen HTTP-Response mit dem&nbsp;Content-Type 'application/json'.</li>
    </ol> <b>&lt;=</b></p>
  </div>
  <p id="polarion_188">Genaue Vorgaben für die Verwendung des TLS-Protokolls bei der HTTPS-Schnittstelle befinden sich in [gemSpec_Krypt] und die entsprechenden Anforderungen sind den Produkttypen (Produkttypsteckbrief) zugewiesen.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94688|layout=1">
   <p><b>A_17890</b></p>
   <p>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="HTML Tidy for Java (vers. 26 Sep 2004), see www.w3.org" name="generator"><title></title><p><span>Ein SGD ePA KANN auf dessen HTTPS-Schnittstelle nach&nbsp;</span><span></span><span><span linkid="189" data-type="crossReference" data-option-id="custom" data-item-id="ML-94687" data-custom-label="A_17889" class="polarion-rte-link"></span></span><span></span><span style="text-decoration: underline;"></span><span style="text-decoration: underline;"></span><span>&nbsp;zusätzlich HTTP&nbsp;</span><span>Version 2 (HTTP/2) anbieten.</span></p> <b>&lt;=</b></p>
  </div>
  <p id="polarion_329"> Es kann nicht ausgeschlossen werden, dass aufgrund von Fehlkonfiguration oder Fehlfunktion eines Clients aus der TI sehr viele<span id="polarion-comment:401"></span> TCP-Verbindungen in kurzer Zeit zum SGD aufgebaut werden. Dann muss es dem Betreiber möglich sein, diesen Sender temporär durch Verwerfen der IP-Pakete des Senders am Verbindungsaufbau zu hindern. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126674|layout=1">
   <p><b>A_22495</b></p>
   <p>Der Anbieter eines SGD ePA MUSS sicherstellen, dass die Netzwerk-Außenschnittstellen des SGD es erlauben eingehenden Datenverkehr von bestimmten während des Betriebs des SGD konfigurierbaren IP-Adressen zu verwerfen.<span style="background-color: #FFFF99;"></span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_330"> Das ZGdV (vgl.<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_Zugangsgateway_Vers#Proxy Schlüsselgenerierungsdienst]" data-url="/wiki/Spezifikation/gemSpec_Zugangsgateway_Vers?selection=ML-93876"></span>) ist im Vergleich zu einem SGD in einer besseren Position, Gegenmaßnahmen gegen DoS-Angriffe aus dem Internet zu ergreifen. Ein SGD kennt nicht die IP-Adresse des Clients – alle Requests kommen von einer IP-Adresse des ZGdV. Deswegen kann ein SGD nur schlecht auf IP-Ebene DoS-Gegenmaßnahmen gegen Clients aus dem Internet <span id="polarion-comment:400"></span>ergreifen. Ein SGD kann jedoch die kryptographische Identität des Anfragenden mit hoher Sicherheit schon in der RVE feststellen und bei DoS-Angriffen auf dieser Grundlage Client-spezifische DoS-Gegenmaßnahmen ergreifen. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94689|layout=1">
   <p><b>A_17891</b></p>
   <p>Ein SGD ePA MUSS bei seiner HTTPS-Schnittstelle in der Request verarbeitenden Einheit (RVE) Maßnahmen gegen DoS-Angriffe auf Applikation-Ebene umsetzen (vgl. [gemSpec_SGD_ePA#Hinweise zu A_17891]). <b>&lt;=</b></p>
  </div>
  <p id="polarion_86">Hinweise zu A_17891:</p>
  <p id="polarion_190"> In Bezug auf DoS-Gegenmaßnahmen auf Applikation-Ebene stehen die Operationen GetAuthenticationToken (A_18025-*) und&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="KeyDerivation" data-item-id="ML-94567" data-option-id="custom"></span> ( <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;)&nbsp;im Fokus, also die Operationen, die unmittelbaren Zugriff auf die SGD-HSM verlangen. </p>
  <p id="polarion_28"> Bei der Operation&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="GetPublicKey" data-item-id="ML-94563" data-option-id="custom"></span>&nbsp;(A_17895-*)&nbsp;wird nur eine Datenstruktur nach <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;&nbsp;(aktueller ECIES-Schlüssel des avisierten SGD-HSM) quasi semistatisch zurückgeliefert. Eine RVE muss die ECIES-Schlüssel alle 15 Minuten vom jeweiligen SGD-HSM erfragen und in eine&nbsp; Datenstruktur nach <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp;&nbsp;überführen. Diese Datenstruktur liefert die RVE dann statisch 15 Minuten lang aus. Damit steht dort der DoS-Schutz auf Anwendungsebene nicht im Fokus. </p>
  <p id="polarion_183"> Bei den Operationen&nbsp;GetAuthenticationToken (A_18025-*) und&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="KeyDerivation" data-item-id="ML-94567" data-option-id="custom"></span>&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;)&nbsp;muss die RVE die Signatur und das Zertifikat des Clients prüfen (vgl. bspw. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;) und bei nicht-positivem Prüfergebnis verwerfen (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17908-01" data-item-id="ML-109359" data-option-id="custom"></span>&nbsp;). Wenn ein Client zu oft Anfragen stellt, so kann die RVE dessen Anfragen herunter priorisieren <span style="font-size: 10pt;line-height: 1.5;">oder den Client mit einem Fehler (vgl. [gemSpec_SGD_ePA#Tabelle Tab_Fehlerfälle_und_Fehlermeldungen]) abweisen. Je nach Art des DoS-Angriffs kann es auch notwendig sein, selektiv gleich auf TCP-Ebene Verbindungsaufbauten abzulehnen.</span> </p>
  <p id="polarion_257">Ein Herunterpriorisieren oder Ablehnen von Client-Requests auf Applikationsebene kann man effizient bspw. mittels "counting bloom filter" implementieren. Dafür&nbsp;erzeugt der SGD ein ausreichend großes 64-bit-Zählerfeld. Bspw. die letzten 256 Bits der Signatur des AUT-Zertifikats werden beim Eintreffen der schon geprüften Requests über eine (nicht-notwendigerweise kryptographisch sichere, d. h. sehr performante) Hashfunktion auf einen Index des Feldes überführt. Dort wird der Zähler mit dem entsprechenden Index im Feld erhöht. Falls dieser Zählerwert über einem festgelegten Limit ist, wird der Request abgelehnt. Periodisch werden alle Zähler des Zählerfeldes, die größer als Null sind, verringert.</p>
  <p id="polarion_195"> Bei der Requestverarbeitung (vgl. Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-93580" data-option-id="longoutline"></span>) meldet das SGD-HSM der RVE verschiedene Fehlerfälle. Treten bei Requests mit bestimmten&nbsp;"Certificate"-Inhalten besonders häufig Fehler auf, so kann die RVE solche Requests für eine gewisse Zeit sperren oder ein Rate-Limiting für solche Requests durchsetzen. </p>
  <p id="polarion_196"> Bei bestimmten Arten von DoS-Angriffen kann nur das ZGdV effektiv Gegenmaßnahmen ergreifen (vgl. Kommentar vor <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17891" data-item-id="ML-94689" data-option-id="custom"></span>).&nbsp;<span id="polarion-comment:402"></span> </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126782|layout=1">
   <p><b>A_22505</b></p>
   <p>Ein SGD ePA MUS bei der Umsetzung von A_17891-* zwischen drei Nutzergruppen unterscheiden:<br> 
    <ol> 
     <li>Versicherte (AUT-Zertifikat mit oid_egk_aut, oid_egk_aut_alt),</li> 
     <li>LEI (AUT-Zertifikat mit&nbsp;policyIdentifier = oid_smc_b_aut und professionOID != oid_epa_ktr))</li> 
     <li>KTR-Identitäten (KTR-Consumer) (AUT-Zertifikat mit mit&nbsp;policyIdentifier = oid_smc_b_aut und und professionOID = oid_epa_ktr).</li> 
    </ol> Bei den DoS-Schutzmaßnahmen MÜSSEN für jeder dieser Nutzergruppen unterschiedliche obere Schranken durchsetzbar sein, und durch einen Betreiber im Betrieb konfigurierbar sein.<br> Der SGD ePA MUSS sicherstellen, dass in Bezug auf den DoS-Schutz das "Certificate"-Feld oder Teilinformationen aus diesem Feld für den DoS-Schutz nur genutzt werden, wenn die Signatur kryptographisch korrekt ist.<span style="background-color: #FFFF99;"></span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_331">Implementierungshinweis:</p>
  <p id="polarion_332">Es ist davon auszugehen, das SMC-B-Zertifikat über den VZD semi-öffentlich verfügbar sind. Damit kann man mit dem "Certificate"-Feld alleine nicht sicher auf die Identität des anfragenden Client schließen. Da im öffentlichen Client-Schlüssel der Hashwert des aktuell vom Client verwendeten (S4)-Schlüssels enthalten ist und dieser sich alle 15 Minuten ändert, kann man mit hoher Sicherheit davon ausgehen, dass wenn die Signatur des Client-Schlüssel kryptographisch korrekt ist, der Request tatsächlich vom angegebenen Client (SMC-B-AUT-Zertifikat) kommt.</p>
  <p id="polarion_333"> Für diese Signaturprüfung ist nach A_22448-* ein Cache zu verwenden. Man kann bei Ankunft eines Requests für GetAuthenticationToken oder KeyDerivation nach einigen Sanity-Check (Signaturfeld leer? Certificate-Feld leer? etc.) den Hashwert von P<span style="color: #202020;">ublicKeyECIES || Signature || Certificate berechnen und den Hashwert als Abfrageschlüssel für den Cache verwenden. Im Cache-Eintrag kann man dann ebenfalls den Zertifikatstyp aufführen. Damit kann man effizient entscheiden welche Nutzergruppe hier vorliegt (welche Datenstruktur jetzt zu befragen ist) und dann das Certificate-Feld oder Teile daraus im weiteren Verlauf in der entsprechenden Datenstruktur (Bloomfilter, Redis-In-Memory-Datenbank etc.) verwenden.</span> </p>
  <p id="polarion_334">Hinweis zum Mengengerüst: im Normalfall existierte pro Kasse eine KTR-Identität (KTR-Consumer-Zertifikat), also sehr viel weniger (Faktor &gt; 3000) als LEI-Identitäten (Kontext Dimensierung der damit verbundenere Datenstrukturen).</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126676|layout=1">
   <p><b>A_22496</b></p>
   <p>Ein SGD ePA MUSS bei seiner HTTPS-Schnittstelle in jedem HTTP-Response-Header die folgende HTTP-Variable mit folgendem Wert aufnehmen:<br> &nbsp; &nbsp; &nbsp; <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">SGD-Userpseudonym: reserved for future use</span><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;background-color: #FFFF99;"></span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_335">Erläuterung: Über den Weg der regelmäßig wechselnden Nutzerpseudonyme im HTTP-Header wird es in einer zukünftigen Ausbaustufe des SGDs einem SGD ermöglicht den DoS-Schutz noch effizienter umzusetzen (analog zu gemSpec_Krypt#A_20162). Vgl. auch A_22494.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94560">6.3 Anforderungen an die JSON-Requests und -Responses</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94691|layout=1">
   <p><b>A_17892</b></p>
   <p>Alle an einer Kommunikation mit einer SGD beteiligten Parteien (Client, ZGdV, SGD selbst) MÜSSEN sicherstellen, dass die JSON-Datenstrukturen, die bei der Kommunikation übermittelt werden, zusätzliche Key-Value-Paare enthalten können, d. h. ein Beteiligter MUSS ihm unbekannte Key-Value-Paare ignorieren. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94690|layout=1">
   <p><b>A_17893</b></p>
   <p>Ein SGD ePA und ein Client eines SGD ePA MÜSSEN&nbsp;JSON-Requests und -Responses auf den SGD (GetPublicKey, KeyDerivation) ablehnen, wenn diese größer als 2 MiB sind. <b>&lt;=</b></p>
  </div>
  <p id="polarion_68">Hinweis zu A_17893:</p>
  <p id="polarion_93"> Bei einer Sicherheitsüberprüfung muss u. a. die Validierung von Daten an der Außenschnittstelle betrachtet werden. Dabei unterstützt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17893" data-item-id="ML-94690" data-option-id="custom"></span>&nbsp;. </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94563">6.4 Operation GetPublicKey</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-127058|layout=1">
   <p><b>A_17895-02</b></p>
   <p>Ein SGD ePA MUSS Folgendes sicherstellen: Wenn über dessen HTTPS-SGD-Schnittstelle (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17889" data-item-id="ML-94687" data-option-id="custom"></span>) ein POST-Request mit dem Request-Body nach [gemSpec_SGD_ePA#Tab_GetPublicKey-Request]&nbsp;eintrifft, so MUSS die RVE das Zertifikat im Datenfeld "Certificate" des Requests asynchron prüfen (Prüfung gegen die TSL inkl. Sperrinformationen über OCSP) (vgl. auch [gemSpec_SGD_ePA#Hinweis zu A_17895-*). Unabhängig vom Prüfergebnis MUSS der SGD eines seiner SGD-HSMs auswählen, an das er den zu erwartenden Folgerequest (im Normalfall GetAuthenticationToken) senden möchte. In Bezug auf dieses avisierte SGD-HSM MUSS der SGD den aktuellen signierten öffentlichen ECIES-Schlüssel des SGD-HSMs + Zertifikat nach der in <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17894-01" data-item-id="ML-109378" data-option-id="custom"></span>&nbsp; angegebenen Kodierung als Antwort senden.<br> <b>&lt;=</b></p>
  </div>
  <p id="polarion_145" data-keep-next="true" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">7</span>: Tab_GetPublicKey-Request </p>
  <table id="polarion_wiki macro name=table;params=header=no|width=100%|padding=2px|uid=3" class="polarion-Document-table" style="width: 100%;margin-left: auto;margin-right: auto;border: 1px solid #CCCCCC;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 748px;height: 217px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">{ "Command"&nbsp; &nbsp; &nbsp; : "GetPublicKey",</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; "Certificate"&nbsp; : "... Base64-kodiertes Client-Zertifikat ... ",</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; "OCSPResponse" : "... Base64-kodierte OCSP-Response ..."</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">}</span><br> <br> <span style="font-size: 10pt;line-height: 1.5;">oder</span><br> <br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{</span> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">"Command"&nbsp; &nbsp; &nbsp; : "GetPublicKey",</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; "Certificate"&nbsp; : " ... Base64-kodiertes Client-Zertifikat ... ",</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; "OCSPResponse" : ""</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">}</span><br> </td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_126"></p>
  <p id="polarion_19"> <span id="polarion-comment:403"></span>Hinweis zu A_17895-*: </p>
  <p id="polarion_25">In A_17895-*&nbsp; steht die Zertifikatsprüfung des im Request enthaltenen Zertifikats nicht in Bezug zu einer Signaturprüfung einer Challenge oder eines durch den Client zu authentisierenden Datums. Damit findet hier keine Authentifizierung statt. Das Aufführen des Zertifikats hat die zwei folgenden Ziele:</p>
  <ol id="polarion_41"> 
   <li>Es wird damit einem SGD ermöglicht, gutartige (nicht-manipulierte) Requests auf&nbsp;mehrere SGD-HSM bspw. in verschiedenen geographischen Orten (Verfügbarkeitsanforderung) zu verteilen. Denn die in den verschiedenen SGD-HSMs erzeugten ECIES-Schlüsselpaare müssen damit nicht synchronisiert werden.<br> Sollte ein Angreifer ein falsches AUT-Zertifikat schicken, so entsteht dadurch kein Sicherheitsproblem.</li> 
   <li>Es wird außerdem einem SGD ermöglicht, vorab eine Zertifikatsprüfung (Einholen der OCSP-Antworten) durchzuführen (diese OCSP-Antworten werden von dem SGD-HSM benötigt). Diese Zertifikatsprüfung muss die RVE asynchron durchführen, d. h. der SGD darf den Client in Bezug auf die Antwort (der aktuelle signierte ECIES-Schlüssel des für den Client "vorgesehenen" SGD-HSMs)&nbsp;nicht warten lassen.</li> 
  </ol>
  <p id="polarion_336"> Für weitere Vorgaben und Hinweise in Bezug auf die Zuweisung eines Clients auf ein SGD-HSM aus der Menge der im SGD verfügbaren SGD-HSM durch die RVE vergleiche Abschnitt "<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94519" data-option-id="longoutline"></span>&nbsp;".<span id="polarion-comment:404"></span>&nbsp; </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94695|layout=1">
   <p><b>A_17896</b></p>
   <p>Eine SGD ePA MUSS das Ergebnis einer Zertifikatsprüfung&nbsp;(inkl. OCSP-Response) innerhalb der RVE 4 Stunden vorhalten (cachen) und, falls ein vorgehaltenes Prüfergebnis vorliegt, dieses anstatt einer neuen Zertifikatsprüfung verwenden. Prüfergebnisse, die älter als 4 Stunden sind, MÜSSEN verworfen und gelöscht werden. Falls der Client eine OCSP-Response mit übergeben hat, so MUSS der SGD zunächst diese nutzen. Wenn die&nbsp;OCSP-Response ungültig oder älter als 4 Stunden ist, so MUSS der SGD selbst eine OCSP-Response einholen. <b>&lt;=</b></p>
  </div>
  <p id="polarion_337"> Das in A_17896-* definierte Caching von Sperrinformationen ist die lokale Quelle für die OCSP-Informationen, die die RVE an die SGD-HSM sendet (beim Aufruf von GetAuthenticationToken und KeyDerivation).&nbsp;<span id="polarion-comment:405"></span> </p>
  <p id="polarion_98"> Wie in Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94496" data-option-id="shortoutline"></span>&nbsp;beschrieben, benötigt ein SGD in Bezug auf die Schlüsselableitungsfunktionalität das AUT-Zertifikat des Nutzers und eine OCSP-Response für dieses Zertifikat. Dies bildet die Grundlage des beidseitig authentisierten verschlüsselten Datenkanals zwischen SGD-HSM und Client (vgl. Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94770" data-option-id="shortoutline"></span>). Ein SGD darf diese beiden Daten nicht längerfristig speichern (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17965" data-item-id="ML-94843" data-option-id="custom"></span>). Andere personenbezogenen Daten fallen bei einem SGD nicht an. Da ein Versicherter immer über das ZGdV eine Datenverbindung zu den beiden SGD aufbaut, erfahren beide SGD nicht die vom Versicherten verwendete IP-Adresse. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94843|layout=1">
   <p><b>A_17965</b></p>
   <p>Ein SGD ePA DARF NICHT Client-spezifische Daten (also das Client-AUT-Zertifikat oder OCSP-Responses dafür)&nbsp;persistent (also außerhalb des Zeitraums aus <span data-option-id="custom" data-item-id="ML-94695" data-custom-label="A_17896" id="fake" data-type="crossReference" class="polarion-rte-link"></span>)&nbsp;speichern. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94694|layout=1">
   <p><b>A_17897</b></p>
   <p>Ein Client eines SGD ePA MUSS den aktuellen signierten öffentlichen ECIES-Schlüssel eines SGD-HSMs über die Operation GetPublicKey gemäß&nbsp;A_17895-*&nbsp; erfragen. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-96280|layout=1">
   <p><b>A_18024</b></p>
   <p>Ein Client eines SGD ePA MUSS den über die Operation GetPublicKey (A_17895-*) erhaltenen signierten öffentlichen ECIES-Schlüssel eines SGD-HSMs (vgl.A_17894-01)&nbsp;wie folgt prüfen.<br> 
    <ol> 
     <li>Ist das erhaltene Zertifikat des SGD-HSMs (vgl. A_17894-01)&nbsp; gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17847" data-item-id="ML-94621" data-option-id="custom"></span>&nbsp;gültig? Falls nein, dann FAIL.</li> 
     <li>Ist das Zertifikat so wie vom Client erwartet entweder von einem SGD 1 oder von einem SGD 2 gemäß <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17848" data-item-id="ML-94622" data-option-id="custom"></span>? Falls nein, dann FAIL.</li> 
     <li>Ist das erhaltene Zertifikat zeitlich gültig? Falls nein, dann FAIL.</li> 
     <li>Ist die Signatur (vgl. "Signature"-Feld bei Kodierung gemäß A_17894-01) korrekt ("valid"), also eine kryptographisch korrekte Signatur (ECDSA-Signatur gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17873" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94670"></span>]), die auf den EE-Schlüssel aus dem in (1) bis (3) geprüften Zertifikat rückführbar ist? Falls nein, dann FAIL.</li> 
    </ol> Wenn einer der Prüfschritte ein FAIL liefert, so MUSS der Client die Verwendung des erhalten Schlüssel (A_17895-*) abbrechen. <b>&lt;=</b></p>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-96277">6.5 Operation GetAuthenticationToken</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-113413|layout=1">
   <p><b>A_18025-01</b></p>
   <p>Ein Client eines SGD-ePA MUSS, nachdem er den &nbsp;jeweiligen aktuellen öffentlichen SGD-HSM-Schlüssel&nbsp;(<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;(S4)) für die Nachrichtenübermittelung mittels des ECIES-Verfahrens (vgl. Abschnitt&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94770" data-option-id="shortoutline"></span>&nbsp;) erfragt (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17897" data-item-id="ML-94694" data-option-id="custom"></span>) und geprüft (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18024" data-item-id="ML-96280" data-option-id="custom"></span>) hat, ein Authentisierungstoken über die&nbsp;Operation GetAuthenticationToken (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18025" data-item-id="ML-96275" data-option-id="custom"></span>) anfordern. <br> <br> Dafür MUSS der Client eine 256-Bit-Zufallszahl als Challenge erzeugen (RND-Client) und in Hexadezimalform kodieren.<br> Weiterhin MUSS der Client den SHA-256-Wert aus der Aneinanderreihung seines Client-spezifischen ECIES-Schlüssels in der Kodierung nach&nbsp;A_17900&nbsp;und des für dessen Signatur verwendeten AUT-Zertifikats (DER-kodiert) berechnen. Dieser Hashwert wird hexadezimal kodiert und wird so kodiert als Wert H bezeichnet.<br> Anschließend MUSS der Client die Zeichenkette "Challenge &lt;RND-Client&gt; &lt;Wert-H&gt;" erzeugen. <br> <br> Beispiel: <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;"> &nbsp; Challenge&nbsp;<span style="font-size: 10pt;line-height: 1.5;">f97cbc538b020d705a960a7e8fa5912c8e202fcf7d6516da3818eff68ce7e00d&nbsp;c4d0613a597826cfdca992d0a02d0ea26667829345033dee158a578cc8524cab<span style="font-size: 11pt;font-family: Arial, Helvetica;line-height: 1.5;"><br> </span></span></span><br> Die Zeichenkette hat damit eine Länge von 9 + 2 + 2*64 = 139 Zeichen.&nbsp;Diese Zeichenkette MUSS der Client über das ECIES-Verfahren gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>] für das SGD-HSM verschlüsseln. Das erhaltene Chiffrat&nbsp;MUSS der Client gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>&nbsp;kodieren und die Kodierung als "EncryptedMessage" bei Operation GetAuthenticationToken (A_18021) verwenden. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-96275|layout=1">
   <p><b>A_18021</b></p>
   <p>Ein SGD ePA MUSS Folgendes sicherstellen: Wenn über dessen HTTPS-SGD-Schnittstelle (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17889" data-item-id="ML-94687" data-option-id="custom"></span>) ein POST-Request mit dem Request-Body nach [gemSpec_SGD_ePA#Tab_GetAuthenticationTolken-Request]&nbsp;eintrifft, so MUSS die RVE des SGD<span style="font-family: Arial, Helvetica;"><br> </span> 
    <ol> 
     <li><span style="font-family: Arial, Helvetica;">das Zertifikat im Datenfeld "Certificate" gemäß&nbsp;TUC_PKI_018</span> (OCSP-Graceperiod=4h, PolicyList={oid_egk_aut, oid_egk_aut_alt, oid_smc_b_aut})<span style="font-family: Arial, Helvetica;"><span style="font-size: 11pt;line-height: 1.5;">&nbsp;</span>prüfen und dabei Ergebnisse nach&nbsp;&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17896" data-item-id="ML-94695" data-option-id="custom"></span>&nbsp;berücksichtigen.</span></li> 
     <li>die Kodierung und die Signatur der "PublicKeyECIES" prüfen (vgl.&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;und&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17901" data-item-id="ML-94701" data-option-id="custom"></span>).&nbsp;</li> 
    </ol> Falls eine der Prüfungen ein nicht-positives Ergebnis liefert, so MUSS die RVE des SGD&nbsp;mit einer entsprechenden Fehlermeldung aus&nbsp;[gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94577" data-option-id="longoutline"></span>]&nbsp;dem Client antworten und die weitere Requestverarbeitung abbrechen.<br> Die RVE des SGD MUSS die Informationen aufbereiten und an das für den Request avisierte SGD-HSM übergeben (vgl. A_18026-*).<br> Liefert das SGD-HSM ein OK, so MUSS die SGD die Antwort den HTTP-POST-Request mit folgender Nachricht beantworten:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{<br> &nbsp; "Status" : "OK",<br> &nbsp; "EncryptedMessage" : "... Base64-kodiertes Chiffrat gemäß <span style="font-size: 10pt;line-height: 1.5;"><span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span> ..."</span><br> }<br> </span> <span style="font-family: Arial, Helvetica;">Anderenfalls (SGD-HSM meldet einen Fehler) MUSS die RVE des SGD mit&nbsp;einer entsprechenden Fehlermeldung aus [gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94577" data-option-id="longoutline"></span>]&nbsp;&nbsp;dem Client antworten.</span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_290"></p>
  <p id="polarion_150" data-keep-next="true" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">8</span>: Tab_GetAuthenticationToken-Request </p>
  <table id="polarion_wiki macro name=table;params=header=no|width=100%|padding=2px|uid=4" class="polarion-Document-table" style="width: 100%;margin-left: auto;margin-right: auto;border: 1px solid #CCCCCC;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 121.556px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">{</span><span style="font-size: 10pt;line-height: 1.5;"><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;"> "Command"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : "GetAuthenticationToken",</span><br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; "PublicKeyECIES"&nbsp; &nbsp;: " ... Kodierung nach&nbsp;</span><span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp;&nbsp;...",</span><br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; "Signature"&nbsp; &nbsp; &nbsp; &nbsp; : " ... Base64-kodierte Signatur des PublicKeyECIES nach </span><span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp;...",</span><br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; "Certificate"&nbsp; &nbsp; &nbsp; : " ... Base64-kodiertes Client-Zertifikat ... ",</span><br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; "EncryptedMessage"&nbsp;: " ... Base64-kodiertes Chiffrat nach </span><span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp;&nbsp;..."</span><br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">}</span><br> </span></td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_108"></p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126656|layout=1">
   <p><b>A_22488</b></p>
   <p>Ein SGD ePA (spezifischer: die RVE) muss nach A_18021-* und A_17898-* die Signatur des kurzlebigen Client-Schlüssels "PublicKeyECIES" bei den Operation GetAuthenticationToken und KeyDerivation prüfen. Ein SGD ePA MUSS das Ergebnis der Signaturprüfung cachen. Die "PublicKeyECIES" (vgl. A_17900-*) sind kryptographisch an die kurzlebigen ECIES-Schlüssel (S4) (vgl. Abschnitt <span style="font-size: 10pt;line-height: 1.5;">4.3 Schlüssel im SGD-HSM") gebunden. Das Caching MUSS so lange andauern bis die (S4)-Schlüssel ungültig werden.&nbsp; Das Caching MUSS Maßnahmen gegen DoS-Angriffe umsetzen (Größenlimitierung des Caches, notfalls Einträge nicht in den Cache aufnehmen). Der Zugriff auf die Caching-Ergebnisse MUSS schneller sein als die Signaturprüfung, die es zu cachen gilt. Es sind die Implementierungshinweise nach A_22488-* zu beachten.</span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_338"> Implementierungshinweise:<span id="polarion-comment:406"></span> </p>
  <p id="polarion_339"> In jedem SGD-HSM eines SGD wird alle 15 Minuten ein neues (S4)-Schlüsselpaar erzeugt. Das zuvor erzeugte (S4)-Schlüsselpaar ist noch 15 Minuten gültig. Damit gibt es pro SGD-HSM im Normalbetrieb (d. h. nachdem der SGD schon mindestens 30 Minuten am Stück arbeitet) genau zwei gültige (S4)-Schlüsselpaare. Da die "PublicKeyECIES"-Schlüssel jeweils an einen öffentlichen (S4)-Schlüssel pro SGD kryptographisch gebunden sind (vgl. A_17900-*) -- und damit auch dessen Signaturprüfung, kann der Cache als <span style="font-size: 10pt;line-height: 1.5;">Associative Array</span> pro (S4)-Schlüsselpaar in der RVE implementiert werden. Verliert ein alter öffentlicher (S4)-Schlüssel nach 30 Minuten seine Gültigkeit, so kann das mit diesen öffentlichen (S4)-Schlüssel verbundene <span style="font-size: 10pt;line-height: 1.5;">Associative Array&nbsp;</span>komplett verworfen/gelöscht werden.&nbsp; </p>
  <p id="polarion_340">Sollte es der Implementierung dienen, so ist es zulässig, dass der Cache-Mechanismus nach A_22488 pro RZ-Flanke implementiert wird und nicht zwischen den RZ-Flanken synchronisiert wird.</p>
  <p id="polarion_341"> In der PoC-Implementierung hat das Caching der Signaturprüfung eine Geschwindigkeitssteigerung der Signaturprüfung für A_18021-* und A_17898-* um dem Faktor 1.9 bis 17.1 je nach Verteilung der simulierten Anfragen ergeben. D.h., bei 0% Mehrfachableitungen in der Simulation der Anfragen, war fast eine Verdoppelung der Geschwindigkeit der Signaturprüfung erreicht. Diese Steigerung hatte bei 90% Mehrfachableitungen (bspw. kurzzeitige Last bei Quartalsende KTR-Consumer) den Faktor 17.1.<span id="polarion-comment:407"></span> </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-96285|layout=1">
   <p><b>A_18028</b></p>
   <p>Ein Client eines SGD-ePA MUSS, nachdem er über die Operation GetAuthenticationToken (A_18025-*) ein Authentisierungstoken angefordert hat, die Antwort in "EncryptedMessage" mittels des ECIES-Verfahrens gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>&nbsp;] entschlüsseln.<br> Der Client MUSS prüfen, ob die Antwort folgender Form entspricht:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; &nbsp; Response &lt;vom-Client-hexadezimal-kodierter-256-Bit-Zufallswert&gt; &lt;256-Bit-Wert-H-in-Hexform&gt; AT&lt;256-Bit-Hexadezimal-kodiert&gt;</span><br> Beispiel:<br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; Response f97cbc538b020d705a960a7e8fa5912c8e202fcf7d6516da3818eff68ce7e00d c4d0613a597826cfdca992d0a02d0ea26667829345033dee158a578cc8524cab&nbsp;AT1ce627dd5e4c6536ca0dd93f896744d42c6580537953a49fcc5840dd8f8f4efa</span><br> <br> Der Client MUSS prüfen, ob der erste Wert (256-Bit Zufallswert aus der Clientanfrage) genau der Wert aus der Anfrage des Client gemäß&nbsp;A_18025-*&nbsp;ist. Falls nein, so MUSS der Client mit einem Fehler abbrechen und ggf. mit dem Protokollablauf neu starten.&nbsp;<br> <br> Der Client MUSS prüfen, ob der zweite Wert H der SHA-256-Wert aus der Aneinanderreihung seines Client-spezifischen ECIES-Schlüssels in der Kodierung nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;und des für dessen Signatur verwendeten AUT-Zertifikats (DER-kodiert) ist.<br> Falls nein, so MUSS der Client mit einem Fehler abbrechen und ggf. mit dem Protokollablauf neu starten.&nbsp;<br> <br> Der Client MUSS den zweiten Wert (das Authentisierungstoken) wie folgt prüfen: 
    <ol> 
     <li>Beginnt das Authentisierungstoken mit der Zeichenkette "AT"? Falls nein, dann FAIL.</li> 
     <li>Ist die Teilzeichenkette des Authentisierungstokens nach "AT" ein 256-Bit Hexadezimal kodierter Wert? Falls nein, dann FAIL.</li> 
    </ol> Falls eine der Prüfungen ein FAIL liefert,&nbsp;so MUSS der Client mit einem Fehler abbrechen und ggf. mit dem Protokollablauf neu starten.&nbsp;<br> Der Client MUSS den Authentisierungstoken für die im Protokollablauf folgenden Aufruf der Operation KeyDerivation (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;) speichern. <br> <b>&lt;=</b></p>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94567">6.6 Operation KeyDerivation</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-96286|layout=1">
   <p><b>A_18029</b></p>
   <p>Ein Client eines SGD-ePA MUSS, nachdem er über erfolgreich über die Operation GetAuthenticationToken (A_18025-*) ein Authentisierungstoken vom SGD-HSM erhalten hat (vgl.&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18028" data-item-id="ML-96285" data-option-id="custom"></span>&nbsp;), eine Zeichenkette der folgenden Form bilden:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; &nbsp; &lt;Authentisierungstoken&gt; &lt;Request-ID&gt; KeyDerivation &lt;Ableitungsregel&gt;<br> </span><br> Die Request-ID MUSS ein 256-Bit Zufallswert in Hexadezimalform sein (ohne führendes "0x"), den der Client pro Request (KeyDerivation) zufällig erzeugen MUSS. Diese Request-ID MUSS der Client zwischenspeichern (vgl. Prüfung in&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18031-01" data-item-id="ML-102757" data-option-id="custom"></span>&nbsp;&nbsp;).<br> <br> Die Ableitungsregeln MUSS der Client je nach Anwendungsfall (vgl. [gemSpec_SGD_ePA#Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94493" data-option-id="shortoutline"></span>&nbsp;ff])&nbsp;gemäß&nbsp;<span style="font-size: 10pt;line-height: 1.5;"><span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17924-01" data-item-id="ML-102756" data-option-id="custom"></span>&nbsp;</span>&nbsp;erzeugen.<br> <br> Diese erzeugte Zeichenkette MUSS der Client über das ECIES-Verfahren gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>] für das SGD-HSM verschlüsseln. Das erhaltene Chiffrat&nbsp;MUSS der Client gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>&nbsp;kodieren und die Kodierung als "EncryptedMessage" bei Operation KeyDerivation (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;) verwenden. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94696|layout=1">
   <p><b>A_17898</b></p>
   <p>Ein SGD ePA MUSS Folgendes sicherstellen: Wenn über dessen HTTPS-SGD-Schnittstelle (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17889" data-item-id="ML-94687" data-option-id="custom"></span>&nbsp;) ein POST-Request mit dem Request-Body nach [gemSpec_SGD_ePA#Tab_KeyDerivation-Request]&nbsp;eintrifft, so MUSS die RVE des SGD<span style="font-family: Arial, Helvetica;"><br> </span> 
    <ol> 
     <li><span style="font-family: Arial, Helvetica;">das Zertifikat im Datenfeld "Certificate" gemäß&nbsp;TUC_PKI_018</span> (OCSP-Graceperiod=4h, PolicyList={oid_egk_aut, oid_egk_aut_alt, oid_smc_b_aut})<span style="font-family: Arial, Helvetica;"><span style="font-size: 11pt;line-height: 1.5;">&nbsp;</span>prüfen und dabei Ergebnisse nach&nbsp;&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17896" data-item-id="ML-94695" data-option-id="custom"></span>&nbsp;berücksichtigen.</span></li> 
     <li>die Kodierung und die Signatur der "PublicKeyECIES" prüfen (vgl.&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;und&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17901" data-item-id="ML-94701" data-option-id="custom"></span>).&nbsp;</li> 
    </ol> Falls eine der Prüfungen ein nicht-positives Ergebnis liefert, so MUSS die RVE des SGD&nbsp;mit einer entsprechenden Fehlermeldung aus&nbsp;[gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94577" data-option-id="longoutline"></span>]&nbsp;dem Client antworten und die weitere Requestverarbeitung abbrechen.<br> Die RVE des SGD MUSS die Informationen aufbereiten und an das für den Request avisierte SGD-HSM übergeben (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18030" data-item-id="ML-96287" data-option-id="custom"></span>). Liefert das SGD-HSM ein OK, so MUSS die SGD die Antwort den HTTP-POST-Request mit folgender Nachricht beantworten:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{<br> &nbsp; "Status" : "OK",<br> &nbsp; "EncryptedMessage" : "... Base64-kodiertes Chiffrat. Das Chiffrat wurde vom SGD-HSM erzeugt ..."<br> }<br> </span> <span style="font-family: Arial, Helvetica;">Anderenfalls (SGD-HSM meldet einen Fehler) MUSS die RVE des SGD mit&nbsp;einer entsprechenden Fehlermeldung aus [gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94577" data-option-id="longoutline"></span>]&nbsp;&nbsp;dem Client antworten.</span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_208"></p>
  <p id="polarion_153" data-keep-next="true" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">9</span>: Tab_KeyDerivation-Request </p>
  <table id="polarion_wiki macro name=table;params=header=no|width=100%|padding=2px|uid=5" class="polarion-Document-table" style="width: 100%;margin-left: auto;margin-right: auto;border: 1px solid #CCCCCC;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 121.556px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">{ "Command"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : "KeyDerivation", </span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; "PublicKeyECIES"&nbsp; &nbsp; : " ... Kodierung nach&nbsp;</span><span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp;&nbsp;...",</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; "Signature"&nbsp; &nbsp; &nbsp; &nbsp; : " ... Base64-kodierte Signatur des PublicKeyECIES nach </span><span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp;...",</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; "Certificate"&nbsp; &nbsp; &nbsp; : " ... Base64-kodiertes Client-Zertifikat ... ",</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; "EncryptedMessage"&nbsp;: " ... Base64-kodiertes Chiffrat nach&nbsp;</span><span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp;&nbsp;..."</span><br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">}</span><br> </td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_211"></p>
  <p id="polarion_342"> Hinweis: für das Caching der Signaturprüfung nach A_17898-* gilt ebenfalls A_22488 aus Abschnitt "<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-96277" data-option-id="longoutline"></span>". </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94685|layout=1">
   <p><b>A_17888</b></p>
   <p>Ein Client eines SGD ePA MUSS die Operation KeyDerivation gemäß <span data-option-id="custom" data-item-id="ML-94696" data-custom-label="A_17898" id="fake" data-type="crossReference" class="polarion-rte-link"></span>&nbsp;umsetzen. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-102757|layout=1">
   <p><b>A_18031-01</b></p>
   <p>Ein Client eines SGD-ePA MUSS, nachdem er über die Operation KeyDerivation (&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;) die Durchführung einer Schlüsselableitung angefordert hat, die Antwort in "EncryptedMessage" mittels des ECIES-Verfahrens gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>&nbsp;] entschlüsseln.<br> <br> Der Client MUSS prüfen, ob die Antwort folgender&nbsp;Form entspricht:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">&nbsp; &nbsp; &lt;Authentisierungstoken&gt; &lt;Request-ID&gt; OK-KeyDerivation &lt;256-Bit-AES-Schlüssel-in-Hexform&gt; &lt;Ableitungsvektor&gt;</span><br> Beispiel:<br> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; AT1ce627dd5e4c6536ca0dd93f896744d42c6580537953a49fcc5840dd8f8f4efa 7522d04ca28f2c6d3f5a53b2a31aebe1f91f2cfb75145b35c9a01fae7930340c&nbsp;OK-KeyDerivation 4a76068ed4796ac5d513ee05c9ff7d007271499f8bd8e04e8146031af576b4dd&nbsp;r2:7f8f77003dbab49c3a4e32f44726f92324d292fa668fde5ebc3424397986be99:107299005A112102647:2-20a1201-001:Bezeichner ACME Q1 2020</span><br> <br> Der Client MUSS prüfen, ob der Authentisierungstoken genau der Token ist, den der Client im Request für KeyDerivation verwendet hat.&nbsp;Falls nein, so MUSS er die erhaltene Antwort verwerfen (i. S. v. er darf insbesondere die erhaltenen Schlüssel nicht nutzen).&nbsp;<br> <br> Der Client MUSS prüfen, ob die Request-ID genau die ist, die der Client für Request für KeyDerivation verwendet hat (zufällig erzeugt hat vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18029" data-item-id="ML-96286" data-option-id="custom"></span>). Falls nein, so MUSS er die erhaltene Antwort verwerfen (i. S. v. er darf insbesondere die erhaltenen Schlüssel nicht nutzen).&nbsp;&nbsp; <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-113412|layout=1">
   <p><b>A_20977</b></p>
   <p>Ein<span id="polarion-comment:389"></span> Client eines SGD-ePA MUSS, nachdem er die Prüfungen aus A_18031-* durchgeführt hat, folgendes prüfen.<br>Er MUSS prüfen, ob die Ableitungsregel im Ableitungsvektor, der in der Antwort des SGD-HSMs angeführt ist, der Ableitungsregel entspricht die der Client erwartet (siehe folgend).<br>Falls er nicht den erwarteten Wert in der Antwort des SGD-HSMs vorfindet, so MUSS er den Protokoll-Durchlauf abbrechen und MUSS die enthalten Schlüssel ("&lt;256-Bit-AES-Schlüssel-in-Hexform&gt;" aus A_18031-*) verwerfen, d. h.&nbsp;sie nicht für eine Ver-oder Entschlüsselung verwenden.<br> <br>Es gibt 3 Arten von Ableitungsregeln, die ein Client bei der Operation KeyDerivation an ein SGD-HSM senden kann. Jeweils gibt es eine "initiale" Variante bspw.&nbsp;"r1:&lt;KVNR&gt;" und eine Variante für spätere Aufrufe bspw. ""r1:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR&gt;:&lt;Ableitungsschlüsselbezeichner&gt;".<br>Bei den drei Varianten für spätere Aufrufe (<br>"r1:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR&gt;:&lt;Ableitungsschlüsselbezeichner&gt;"<br>"r2:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter oder Telematik-ID&gt;:&lt;Ableitungsschlüsselbezeichner&gt;"<br>"r3:&lt;256-Bit-RND-in-Hexform&gt;:&lt;KVNR-Kontoinhaber&gt;:&lt;KVNR-Vertreter&gt;:&lt;Telematik-ID&gt;:&lt;Ableitungsschlüsselbezeichner&gt;")<br>erwartet ein Client genau diese Ableitungsregel im Ableitungsvektor in der Antwort des SGD-HSMs. D. h. ein Client führt einfach einen Bitvergleich Gesendete-Ableitungsregel == Empfangene-Ableitungsregel durch.<br>Bei den initialen Varianten (<br>"r1:&lt;KVNR&gt;"<br>"r2:&lt;KVNR-Vertreter oder Telematik-ID&gt;"<br>"r3:&lt;Telematik-ID&gt;:&lt;KVNR-Kontoinhaber&gt;")<br>erwartet der Client die entsprechend mit "&lt;256-Bit-RND-in-Hexform&gt;" und "&lt;aktueller Ableitungsschlüsselbezeichner&gt;" erweiterten Formen. In diesen erweiterten Formen müssen die korrekten Daten aus der initialen Variante -- die der Client initial dem SGD-HSM geschickt hat -- enthalten sein. <b>&lt;=</b></p>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94577">6.7 Fehlermeldungen</h3>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-102143|layout=1">
   <p><b>A_18987</b></p>
   <p><span style="font-size: 10pt;line-height: 1.5;">Ein SGD ePA MUSS Folgendes sicherstellen: Die RVE MUSS bei Fehlerfällen die in Tabelle ”Tab_Fehlerfälle_und_Fehlermeldungen” aufgeführten Fehlermeldungen an einen SGD-Client senden. Diese Fehlermeldungen MUSS der SGD wie die anderen Nachrichten des SGD-Protokoll mit dem HTTP-Status-Code 200 (OK) übertragen (vgl. Erläuterung in Abschnitt 6.7.1).</span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_161" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">10</span>: Tab_Fehlerfälle_und_Fehlermeldungen </p>
  <table id="polarion_wiki macro name=table;params=width=99.87%|uid=112" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Fehlerfall</span><br> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;">transient</th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">an den Client zu sendende Fehlernachricht</span><br> </th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die Authentizität des Requests ist nicht gegeben (bspw. AES-GCM meldet FAIL) das SGD-HSM meldet FAIL.<br> </span></td> 
     <td style="vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "Status" : "decryption FAIL" }</span><br> </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die Zertifikatsprüfung in der RVE oder im SGD-HSM ergab FAIL.<br> </span></td> 
     <td style="vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "Status" : "certificate not valid" }</span><br> </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die Signatur des öffentlichen ephemeren ECIES-Client-Schlüssel ist nicht valide.<br> </span></td> 
     <td style="vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "Status" : "signature not valid" }</span><br> </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Datenfelder im Request fehlen.<br> </span></td> 
     <td style="vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "Status" : "request not valid" }</span><br> </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Request ist größer als 2 MiB (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17893" data-item-id="ML-94690" data-option-id="custom"></span>&nbsp;).<br> </span></td> 
     <td style="vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "Status" : "request not valid" }</span><br> </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die RVE stellt fest, dass das für einen Client (nach Protokoll-Nachricht 2) festgelegt SGD-HSM nicht mehr verfügbar ist (bspw. Hardware-Schaden). Der Client soll (MUSS) in diesem Falle den Protokollablauf neu starten (vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18988" data-item-id="ML-102144" data-option-id="custom"></span>&nbsp;).</span></td> 
     <td style="vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;">Ja</td> 
     <td style="vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">{ "Status" : "restart protocol" }</span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;">Die RVE konnte keine gültigen OCSP-Auskunft für des EE-Zertifikat des Nutzers des Client erhalten, bspw. wenn der Verbindungsaufbau zum OCSP-Responder fehlschlug. Der Client soll es noch einmal versuchen in der Hoffnung, dass dann der OCSP-Responder wieder verfügbar ist.</td> 
     <td style="vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;">Vielleicht</td> 
     <td style="vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "Status" : "OCSP-Response not available" }</span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 250px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;">Ein Client hat schon zu viele Anfragen pro Zeiteinheit gesendet (vgl. Hinweise nach <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17891" data-item-id="ML-94689" data-option-id="custom"></span>&nbsp;).</td> 
     <td style="vertical-align: top;width: 60px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 404px;height: 9pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">{ "Status" : "rate limiting per user" }</span></td> 
    </tr> 
   </tbody> 
  </table>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-102144|layout=1">
   <p><b>A_18988</b></p>
   <p><span style="font-size: 10pt;line-height: 1.5;">Ein Client eines SGD ePA MUSS wenn er eine Fehlermeldung aus Tabelle [gemSpec_SGD_ePA#Tab_Fehlerfälle_und_Fehlermeldungen] vom SGD erhält, die als "transient" mit "Ja" oder "Vielleicht" in der Tabelle aufgeführt ist, den Protokollablauf neu starten (GetPublicKey etc.).<br> Er MUSS einen Fehler-Zähler führen. Wenn nach 5 Protokoll-Neustarts der Fehler immer noch auftritt, so KANN er abbrechen (Vermeidung von Endlosschleifen).</span> <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-102181|layout=1">
   <p><b>A_19000</b></p>
   <p>Eine RVE eines SGD ePA KANN weitere Fehlermeldungen analog zu den in Tabelle [gemSpec_SGD_ePA#Tab_Fehlerfälle_und_Fehlermeldungen] aufgeführten Fehlermeldungen für sich definieren und an einen SGD-Client senden. Analog zu <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18987" data-item-id="ML-102143" data-option-id="custom"></span>&nbsp;MÜSSEN diese Fehlermeldungen mit dem HTTP-Status-Code 200 (OK) übertragen werden.<br> Eine RVE KANN jede Fehlermeldungen (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18987" data-item-id="ML-102143" data-option-id="custom"></span>&nbsp;und&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_19000" data-item-id="ML-102181" data-option-id="custom"></span>&nbsp;) mit beliebigen JSON-Format-konformen Statusinformationen anreichern. Dabei gilt die Größenbeschränkung aus <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17893" data-item-id="ML-94690" data-option-id="custom"></span>.<br> Beispiel:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;"><span style="font-size: 10pt;line-height: 1.5;">{</span><br> <span style="font-size: 10pt;line-height: 1.5;">&nbsp;"Status": "decryption FAIL",</span><br> <span style="font-size: 10pt;line-height: 1.5;">&nbsp;"Error": {</span><br> <span style="font-size: 10pt;line-height: 1.5;">&nbsp; "Timestamp": "2019-01-15T13:37:42.123Z",</span><br> <span style="font-size: 10pt;line-height: 1.5;">&nbsp; "Trace": {</span><br> <span style="font-size: 10pt;line-height: 1.5;">&nbsp; &nbsp;"LogReference": "550e8400-e29b-11d4-4ffe-446655440000"</span><br> <span style="font-size: 10pt;line-height: 1.5;">&nbsp; }</span><br> <span style="font-size: 10pt;line-height: 1.5;">&nbsp;}</span><br> <span style="font-size: 10pt;line-height: 1.5;">}</span></span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_242"> Hinweis zu <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_19000" data-item-id="ML-102181" data-option-id="custom"></span>&nbsp;: In Bezug auf einen Client vgl. <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17892" data-item-id="ML-94691" data-option-id="custom"></span>&nbsp;&nbsp;(<span style="font-size: 10pt;line-height: 1.5;">Aufwärtskompatibilität JSON-Requests und -Responses).</span> </p>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-102145">6.7.1 Fehlermeldungen und HTTP-Status-Code (informativ)</h4>
  <p id="polarion_88"> <span style="font-size: 10pt;line-height: 1.5;">Ein SGD besitzt keine RESTful-Schnittstelle. Demnach resultieren Applikationsfehler nicht in Fehlermeldungen des HTTP-Protokolls bei der Applikationsdatenübermittlung. Applikationsfehler erzeugen keine HTTP-Fehler-Codes. Die Applikationsschicht und die darunterliegende HTTP-Schicht werden als separate Sichten im OSI-Schichtenmodell betrachtet.</span> </p>
  <p id="polarion_171"> <span style="font-size: 10pt;line-height: 1.5;">Dies erleichtert das Tunneln der SGD-Protokollnachrichten (Applikationsebene) bspw. über das Zugangsgateway des Versicherten.&nbsp;</span> </p>
  <p id="polarion_81"> <span style="font-size: 10pt;line-height: 1.5;">Die SGD-Schnittstelle hat mit einer RESTful-Schnittstelle die Gemeinsamkeit, dass über HTTP hauptsächlich JSON-Datenstrukturen übertragen werden. Ansonsten gibt es kaum Gemeinsamkeiten.</span><br> <br> <span style="text-decoration: underline;font-size: 10pt;line-height: 1.5;">Beispiel 1, Bit-Flip im Chiffrat im GetAuthenticationToken-Request:</span><br> <span style="font-size: 10pt;line-height: 1.5;">Die RVE erreicht ein GetAuthenticationToken-Request (Nachricht 3 im SGD-Protokoll). Als konstruiertes Beispiel ist dort im Chiffrat ein Bitflip aufgetreten. Dies kann die RVE nicht erkennen. Das für den Client ausgewählte SGD-HSM erkennt dies (AES-GCM als Authenticated Enryption erzeugt ein FAIL bei der Entschlüsselung). Das SGD-HSM übermittelt diese Information an die RVE (Innen-Interface). Die RVE erzeugt dann als Antwort&nbsp;</span> </p>
  <p id="polarion_238" style="margin-left: 40px;"> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">{ "Status" : "decryption FAIL" }</span> </p>
  <p id="polarion_239"> <span style="font-size: 10pt;line-height: 1.5;">gemäß Tabelle Tab_Fehlerfälle_und_Fehlermeldungen&nbsp; und zwar als Teil der HTTP-Response mit HTTP-Status-Code 200 (OK).</span><br> <br> <span style="text-decoration: underline;font-size: 10pt;line-height: 1.5;">Beispiel 2, ungültige HTTP-Methode verwendet:&nbsp;</span><br> <span style="font-size: 10pt;line-height: 1.5;">Aus der TI (also ohne Beteiligung des Zugangsgateway des Versicherten) wird ein HTTP-Request an den SGD2 gesendet. Der Client sendet als konstruiertes Beispiel nicht "POST /SGD2 HTTP/1.1" sondern "OST /SGD2 HTTP/1.1" als erste Zeile des HTTP-Requests. Darauf hin antwortet das Webinterface der SGD2 gemäß des HTTP-Protokolls mit HTTP-Status-Code 400 (Bad Request), weil es die Methode „OST“ innerhalb des HTTP-Protokolls nicht gibt.</span><br> <br> </p>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94578">7 Clientspezifische Festlegungen</h2>
  <p id="polarion_75">Ein ePA-FdV, ein FM ePA und ein KTR-Consumer sind Clients eines SGD.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94621|layout=1">
   <p><b>A_17847</b></p>
   <p>Ein Client eines SGD MUSS bei Prüfung eines SGD-HSM-Zertifikats bei bzw. vor der Erzeugung eines Requests an den SGD prüfen, ob das Zertifikat in der TSL innerhalb eines "TSPService"-Eintrags mit dem ServiceTypeIdentifier "http://uri.etsi.org/TrstSvc/Svctype/unspecified" aufgeführt ist und dieses zeitlich aktuell gültig ist.<br> Falls nein, so MUSS das Zertifikat abgelehnt werden und die Verarbeitung des Zertifikats abgebrochen werden. <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94622|layout=1">
   <p><b>A_17848</b></p>
   <p>Ein Client eines SGD ePA MUSS, falls bei der Prüfung eines SGD-HSM-Zertifikats ein SGD-1-Zertifikat erwartet wird, prüfen, ob die OID oid_sgd1_hsm [gemSpec_OID] im SGD-HSM-Zertifikat (Kontext Prüfung der Signatur der aktuellen SGD-HSM-ECIES-Schlüssel) aufgeführt ist. <br>Falls nicht, so MUSS das Zertifikat abgelehnt werden.<br>Analog SGD-2-Zertifikat und OID oid_sgd2_hsm. <b>&lt;=</b></p>
  </div>
  <p id="polarion_130"> Verständnishinweis: In&nbsp;<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_PKI#A_17700]" data-url="/wiki/Spezifikation/gemSpec_PKI?selection=ML-94225"></span>&nbsp;wird die generelle Auswertbarkeit solcher TSL-Einträge auch thematisiert. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94728|layout=1">
   <p><b>A_17925</b></p>
   <p>Ein Client eines SGD MUSS, um eine höhere Performanz zu erreichen, im Rahmen der Schlüsselableitungsfunktionalität den SGD 1 und den SGD 2 parallel anfragen.<br> <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-95001|layout=1">
   <p><b>A_17990</b></p>
   <p>Ein ePA-FdV MUSS bei der Umsetzung von&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17925" data-item-id="ML-94728" data-option-id="custom"></span>&nbsp;die aktuell bestehende TLS-Verbindung zum Zugangsgateway des Versicherten per TLS-Resumption "clonen" (vgl. „third option“ [RFC-5246, S. 40, erster Abschnitt]). Auf einer TLS-Verbindung MUSS das ePA-FdV den SGD 1 anfragen auf der anderen den SGD 2.<br> Sollte das Zugangsgateway eine TLS-Resumption ablehnen, so MUSS der Client, so wie im TLS-Protokoll vorgesehen, einen "full handshake" für den Aufbau der zusätzlichen TLS-Verbindung durchführen. <b>&lt;=</b></p>
  </div>
  <p id="polarion_194"> Hinweis: Für die Vereinfachung der Parallelisierung für ein ePA-FdV gibt es <span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_Zugangsgateway_Vers#A_17495]" data-url="/wiki/Spezifikation/gemSpec_Zugangsgateway_Vers?selection=ML-93901"></span>&nbsp;. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126673|layout=1">
   <p><b>A_22494</b></p>
   <p>Ein Client eines SGD ePA MUSS bei Erhalt einer SGD-Protokoll-Nachricht prüfen, ob im HTTP-Response-Header eine HTTP-Variable Namens "SGD-Userpseudonym" existiert. Falls ja so MUSS der SGD-Client diese Variable inkl. Wert unverändert im nächsten Request an den SGD im HTTP-Request-Header aufführen.<span style="background-color: #FFFF99;"></span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_343">Erläuterung: A_22494 wird es in einer zukünftigen Ausbaustufe des SGDs einem SGD erleichtern den DoS-Schutz effizienter umzusetzen (analog zu gemSpec_Krypt#A_20162).</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-95024|layout=1">
   <p><b>A_18003</b></p>
   <p>Ein Client eines SGD ePA MUSS folgende Vorgaben umsetzen.<br> Im Rahmen einer Berechtigungsvergabe (vgl. [gemSpec_SGD_ePA#Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94494" data-option-id="shortoutline"></span>&nbsp;und <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94738" data-option-id="shortoutline"></span>]) kann ein Versicherter oder ein Vertreter eine LEI berechtigen. Dabei muss der Client einen Ableitungsvektor erzeugen, bei dem die Telematik-ID der LEI in den Ableitungsvektor mit einfließen. Dabei MUSS der Client&nbsp;die Telematik-ID der LEI wie folgt prüfen.<br> Falls in der Telematik-ID ein Doppelpunkt (<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">":"</span>, Character 58) enthalten ist, so MUSS der Client die Telematik-ID in Hexadezimalschreibweise (ohne führendes "0x") kodieren und davor ein <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"*"</span>&nbsp;(Character 42) setzen. <br> Beispiel:<br> <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"2-20a1201-001:AAB::112"</span>&nbsp;wird zu&nbsp;<span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"*<span style="font-size: 10pt;line-height: 1.5;">322d323061313230312d3030313a4141423a3a313132"</span></span><br> Diese Kodierung MUSS der Client bei der Erzeugung der Ableitungsvektoren jeweils bei <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"&lt;TELEMATIK_ID&gt;"</span> verwenden. <b>&lt;=</b></p>
  </div>
  <p id="polarion_262"> Verständnishinweis: Die Vergabe der Telematik-IDs erfolgt durch die LE- und LEI-Organisationen. Nur die ersten drei Zeichen werden durch die Vorgaben aus [gemSpec_PKI#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="Telematik-ID" data-url="/wiki/Spezifikation/gemSpec_PKI?selection=ML-6894"></span>] festgelegt. Damit kann es theoretisch vorkommen, dass dort nach der 3-ten Stelle der Telematik-ID ein ":" vorkommen könnte, was i. d. R. nicht der Fall ist. </p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-96291|layout=1">
   <p><b>A_18032</b></p>
   <p>Ein Client eines SGD MUSS für die parallele Anfrage an beide SGD ein kurzlebiges ECIES-Client-Schlüsselpaar gemäß [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17874" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94671"></span>] erzeugen. (Der Client verwendet dasselbe Schlüsselpaar für beide SGD). <b>&lt;=</b></p>
  </div>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-95035|layout=1">
   <p><b>A_18005</b></p>
   <p>Ein Client eines SGD DARF sein kurzlebiges ECIES-Client-Schlüsselpaar NICHT für mehr als eine Nutzung der Schlüsselableitungsfunktionalität ePA, also die parallele Anfrage an SGD 1 und SGD 2, nutzen. Für die nächste Nutzung MUSS der Client ein neues ECIES-Client-Schlüsselpaar erzeugen. <b>&lt;=</b></p>
  </div>
  <p id="polarion_284">Verständnishinweis: sollte der Client keine Antwort (timeout) bspw. vom ZdGV bekommen u. Ä. so darf er die Anfrage mit dem gleichen Schlüsselpaar noch einmal wiederholen. Es geht um die kryptographische Nutzung des Schlüsselpaars, diese darf nur einmal innerhalb eines Protokollablaufs erfolgen. Bei einem folgenden Protokolldurchlauf muss der Client ein neues ECIES-Client-Schlüsselpaar verwenden.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-95042|layout=1">
   <p><b>A_18006</b></p>
   <p>Ein Client eines SGD ePA MUSS bei einer Erstellung einer Anfrage für eine Schlüsselableitung (vgl. Abschnitte&nbsp;<span data-option-id="shortoutline" data-item-id="ML-94494" id="fake" data-type="crossReference" class="polarion-rte-link"></span>&nbsp;und&nbsp;<span data-option-id="shortoutline" data-item-id="ML-94738" id="fake" data-type="crossReference" class="polarion-rte-link"></span>&nbsp;), im Falle dass dort vom Client initial eine KVNR eingetragen wird (KVNR eines Vertreters, KVNR eines Kontoinhabers im Vertretungsfall), die Variable KVNR bei der Konstruktion der Anfrage gemäß&nbsp;<span data-option-id="custom" data-item-id="ML-94729" data-custom-label="A_17926" id="fake" data-type="crossReference" class="polarion-rte-link"></span>&nbsp;verstehen. <b>&lt;=</b></p>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-127062">7.1 Mehrfachableitung</h3>
  <p id="polarion_344">Es gibt Anwendungsfälle bei denen ein SGD-Client mehrere Schlüsselableitungen durch einen SGD direkt nacheinander anfordert.</p>
  <p id="polarion_345">Beispiele:</p>
  <ul id="polarion_346"> 
   <li>Ein ePA-FdV führt eine Umschlüsselung einer Akte mit anschließender Neuberechtigung durch (und damit auch Neuverschlüsselung von Kontext- und Aktenschlüssel für alle Berechtigten).</li> 
   <li>Ein ePA-FdV führt einen Aktenumzug mit anschließender Neuberechtigung durch.</li> 
   <li>Ein KTR-Consumer möchte zum Quartalsende vielen Versicherten, die den KTR-Consumer zuvor dafür berechtigt haben, Abrechnungsinformationen zukommen lassen (in die Akte einstellen).</li> 
  </ul>
  <p id="polarion_347">Die Anforderung "A_18005, SGD-Client, nur Einmalverwendung des kurzlebigen ECIES-Client-Schlüsselpaars" hat die fachliche Motivation die Frage nach dem Lebenszyklus von sicherheitskritischen Datenobjekten (private kurzlebiger ECIES-Client-Schlüssel und damit verbundenen AuthenticationToken) zu klären und die Implementierung im SGD-Client zu vereinfachen. Das ECIES-Client-Schlüsselpaar wird einmal verwendet und anschließend sofort gelöscht.</p>
  <p id="polarion_348">In den o. g. Anwendungsfällen ist es jedoch aus Performanz-Sicht wünschenswert die Mehrfachverwendung zuzulassen und damit die Kosten des erhöhten Aufwands bezüglich der Überwachung des Lebenszyklus der sicherheitskritischen Datenobjekte im Client zu tragen (wann wurden sie erzeugt, wie lange sind sie noch gültig, wann müssen neue Schlüssel erzeugt werden ...).</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-126678|layout=1">
   <p><b>A_22497</b></p>
   <p>Ein Client eines SGD ePA KANN auf die Umsetzung von A_18005-* verzichten, wenn er die sicherheitskritischen Datenobjekte (private kurzlebiger ECIES-Client-Schlüssel und damit verbundenen AuthenticationToken) innerhalb seiner Applikation schützt (sie dürfen in der Applikation nicht zwischen einzelnen Bestandteilen der Applikation transportiert werden) und diese Objekte vor Ablauf deren Gültigkeit (15 Minuten) im Client löscht.<span style="background-color: #FFFF99;"></span> <b>&lt;=</b></p>
  </div>
  <p id="polarion_349">Durch die Mehrfachableitung sind für einen SGD-Client nach A_22497-* nicht mehr 6 * (Anzahl der abzuleitenden Schlüssel) SGD-Nachrichten notwendig, sondern nur noch 4 + 2*(Anzahl der abzuleitenden Schlüssel) SGD-Nachrichten.</p>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94583">8 Interoperables Austauschformat</h2>
  <p id="polarion_49">Damit die Interoperabilität zwischen Clienten eines SGD (ePA-FdV, FM ePA etc.) sichergestellt ist, wird nachfolgend ein interoperables Austauschformat definiert. Zunächst wird mit PHRKey [PHR_Common.xsd] eine Datenstruktur für die Klartextrepräsentation von Kontextschlüssel (ContextKey) und Aktenschlüssel (RecordKey) definiert. Daran folgt die Definition der Datenstruktur EncryptedKeyContainer [AuthorizationService.xsd].</p>
  <p id="polarion_165" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">11</span>: Tab_Austauschformat_Akten-_und_Kontextschlüssel </p>
  <table id="polarion_wiki macro name=table;params=header=no|width=100%|padding=2px|uid=6" class="polarion-Document-table" style="width: 100%;margin-left: auto;margin-right: auto;border: 1px solid #CCCCCC;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 178.444px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&nbsp;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;epa:PHRKey insurant="[OwnerKVNR]"&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; &lt;RecordKey algorithm="http://www.w3.org/2009/xmlenc11#aes256-gcm"&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; &nbsp; &nbsp; S2V5MS0yNTZCaXQtQUVTLUdDTS0xMjM0NTY3ODkwYWI=</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; &lt;/RecordKey&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; &lt;ContextKey algorithm="http://www.w3.org/2009/xmlenc11#aes256-gcm"&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; &nbsp; &nbsp; S2V5Mi0yNTZCaXQtQUVTLUdDTS1iYTA5ODc2NTQzMjE= &nbsp; &nbsp;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp; &nbsp; &lt;/ContextKey&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;/epa:PHRKey&gt;</span><br> </td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_65">Vergleiche auch [PHR_Common.xsd]</p>
  <p id="polarion_137"> Diese XML-Datenstruktur muss nun mittels des vom&nbsp;SGD 1 abgeleiteten spezifischen Schlüssels verschlüsselt werden (vgl. <span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="[gemSpec_Krypt#A_17872]" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94669"></span>&nbsp;) und zusätzlich muss noch der Rückgabewert nach <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"OK-Derivation "</span> als "associated data" mit in die MAC-Berechnung bei der AES-GCM-Verschlüsselung und GMAC-Berechnung einfließen. Das Ergebnis muss in einer EncryptedKeyContainer-XML-Datenstruktur kodiert werden, die folgende Form besitzt (vgl. auch Schemadatei&nbsp; [AuthorizationService.xsd]): </p>
  <p id="polarion_168" data-keep-next="true" class="polarion-rte-caption-paragraph"> Tabelle&nbsp;<span data-sequence="Tabelle" class="polarion-rte-caption">12</span>: Tab_erste_Verschlüsselungsschicht </p>
  <table id="polarion_wiki macro name=table;params=header=no|width=100%|padding=2px|uid=7" class="polarion-Document-table" style="width: 100%;margin-left: auto;margin-right: auto;border: 1px solid #CCCCCC;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <td style="text-align: left;vertical-align: top;width: 742px;height: 198.889px;border: 1px solid #CCCCCC;padding: 2px;"><span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;epa:EncryptedKeyContainer Algorithm="http://www.w3.org/2009/xmlenc#aes256-gcm"&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;epa:Ciphertext&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp;&lt;!--Base64-Kodiertes Ciphertext mit len(IV)=12 Byte und TagLen=16 Byte, vgl. [XMLEnc#5.2.4 AES-GCM] und [gemSpec_Krypt#</span><span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17872" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94669"></span><span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&nbsp;] --&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;/epa:Ciphertext&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;epa:AssociatedData&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;!-- Base64-kodierte associated data (Ableitungsinformationen) --&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;/epa:AssociatedData&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;/epa:EncryptedKeyContainer&gt;</span><br> </td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_240">Diese Daten werden dann mit dem zweiten AES-256-Schlüssel (erhalten von SGD 2) verschlüsselt und es muss wieder eine derartige Datenstruktur erzeugt werden. Jedoch müssen bei den AD nun die AD aus der ersten Verschlüsselungsschicht&nbsp; (AD1) mit einbezogen werden. Dafür werden die AD1 (Base64-dekodiert) vor die Ableitungsinformationen, die durch SGD 2 hinzukommen, vorangestellt und damit zusammengefügt. Die MAC-Berechnung basiert dann auf dieser zusammengesetzten Zeichenkette. Im "&lt;epa:AssociatedData&gt;"-Feld werden die beiden Teile (Ableitungsinformationen von SGD 1 und Ableitungsinformationen von SGD 2) jeweils einzeln Base64-kodiert und durch Leerzeichen getrennt aufgeführt.</p>
  <p id="polarion_138">Beispiel für ein&nbsp;AssociatedData einer zweiten Verschlüsselungsschicht:</p>
  <p id="polarion_269"> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;epa:AssociatedData&gt;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">cjI6N2Y4Zjc3MDAzZGJhYjQ5YzNhNGUzMmY0NDcyNmY5MjMyNGQyOTJmYTY2OGZkZTVlYmMzNDI0Mzk3OTg2YmU5OTpBMTIzNDU2Nzg5OjItMjBhMTIwMS0wMDE6QWt0ZW5zeXN0ZW0gYSwgU0dEMSwgQmV6ZWljaG5lciAyMDIwLTE=&nbsp;</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">cjI6NWQ2MWQyZTExNTJiNjcxMWJlOTg0OTZjZDZmMGM5YWJkZTRjYzNiMzIwYjRiYWYxMjc2ZTU1MmFhZGU4MDkxMzpBMTIzNDU2Nzg5OjItMjBhMTIwMS0wMDE6U0dEMiBNYXN0ZXJrZXkgMjAyMC0x</span><br> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;/epa:AssociatedData&gt;</span> </p>
  <p id="polarion_270">Damit kann ein Client die Ableitungsinformationen von SGD 1 (erster Teil) und von SGD 2 (zweiter Teil) unterscheiden.</p>
  <div id="polarion_wiki macro name=module-workitem;params=id=ML-94737|layout=1">
   <p><b>A_17930</b></p>
   <p>Ein Client eines SGD ePA MUSS bei einer Kodierung von Akten- und Kontextschlüssel bzw. der Ver-und Entschlüsselung dieses im Kontext der Schlüsselableitungsfunktionalität ePA die in [gemSpec_SGD_ePA#<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94583" data-option-id="longoutline"></span>&nbsp;] spezifizierten Formate epa:PHRKey [PHR_Common.xsd] und epa:EncryptedKeyContainer [AuthorizationService.xsd] verwenden. <br> Der Client MUSS bei der zweiten Verschlüsselungsschicht die AD der ersten Schicht (AD 1) im AD der zweiten Schicht (AD 2) mit aufnehmen. Der Client MUSS zunächst AD 1 und dann AD 2 aufführen und beide durch mindestens ein Leerzeichen trennen. Die GMAC-Berechnung MUSS bei der zweiten Verschlüsselung über beide AD (AD1 und AD2) erfolgen (AD1 + AD2 bilden die AD für den AES-GCM). <b>&lt;=</b></p>
  </div>
  <p id="polarion_163">Beispiel: Schritt 1, im Client (bspw. ePA-FdV) liegen zufällig lokal erzeugte Akten- und Kontextschlüssel vor, welche in einer PHRKey-Datenstruktur kodiert werden. Der Versicherte habe die KVNR "A123456789".</p>
  <p id="polarion_182"> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;?xml version="1.0" encoding="UTF-8"&gt;<br> &lt;epa:PHRKey insurant="A123456789"&gt;<br> <br> &nbsp; &nbsp; &lt;!-- Aktenschlüssel --&gt;<br> &nbsp; &nbsp; &lt;RecordKey algorithm="http://www.w3.org/2009/xmlenc11#aes256-gcm"&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; Nj9OixvhO2JKjtYEbQe8oetiQaiennKFJmQEJXsQVQo=<br> &nbsp; &nbsp; &lt;/RecordKey&gt;<br> <br> &nbsp; &nbsp; &lt;!-- Kontextschlüssel --&gt;<br> &nbsp; &nbsp; &lt;ContextKey algorithm="http://www.w3.org/2009/xmlenc11#aes256-gcm"&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; qyVQMtj3MwXRt8NOuQrNj3g5IPl49Ieami/+QVLzTkc=<br> &nbsp; &nbsp; &lt;/ContextKey&gt;<br> <br> &lt;/epa:PHRKey&gt;<br> </span> </p>
  <p id="polarion_279"></p>
  <p id="polarion_271"> <span style="font-size: 10pt;line-height: 1.5;">Beispiel: Schritt 2, Erzeugung der ersten Verschlüsselungsschicht</span> </p>
  <p id="polarion_272"> <span style="font-size: 10pt;line-height: 1.5;">Sei</span> </p>
  <p id="polarion_85"> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">3132333435363738393031323334353637383930313233343536373839303132</span> </p>
  <p id="polarion_191"> <span style="font-size: 10pt;line-height: 1.5;">der von dem SGD 1 erhaltene hexadezimal-kodierte 256-Bit AES/GCM-Schlüssel und der verwendete Ableitungsvektor des SGD 1 sei "</span><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">r2:7f8f77003dbab49c3a4e32f44726f92324d292fa668fde5ebc3424397986be99:A123456789:2-20a1201-001:Aktensystem a, SGD1, Bezeichner 2020-1",</span> <span style="font-size: 10pt;line-height: 1.5;">dann würde folgende&nbsp;EncryptedKeyContainer-Datenstruktur entstehen.</span> </p>
  <p id="polarion_162"> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;?xml version="1.0" encoding="UTF-8"&gt;<br> &lt;epa:EnryptedKeyContainer algorithm="http://www.w3.org/2009/xmlenc11#aes256-gcm"&gt;<br> &nbsp; &nbsp; &lt;epa:Ciphertext&gt;&nbsp; &nbsp; &nbsp; &nbsp; n9G9sp+Sw1KTbKGjmugnqVyC82pUSlE8GJMq4I316zNqHPZy6/nIgXpJcZ7EI2jmHYjrLm/FyWUtbocYYUm8JQCmsWHWU+76gvJyDMwi1XsAj4fgbn/pH0/9XgDcXK905gH4IGD18Z54A3iChuwj6gGvhX5HpS54YH4QuAGiE5ZPFhlKWx2GkYvn4h5kFzM/Z0n7Lg3Txw/dpb6yp4mTGKX1KTWqt3aRUkdSQ05GR4i1PvZB8A4MDaLGo3Tgs1rD2n7ay7D3ZErulsMKK7CDjyHEWmADLBLmT+FDmu9micg+JI4jSaYXsYZYMn99HYi47D0DCUPS7fDDh1iNpkignczP44pHGbnujgnqcr/e42itRWISt0A0d2guNYAXPrrmtJTiOkYfr9Lhx9ttGRHWwcmH8j5+c+RGJdYFW55pSrGWlJ1n5DBsHqf6B+aWp6FWjH+SsQ5OBjkqGWAEggxaZlJMH8oFP+Yk5d0Zdt+TDQgA2UQynxZ/dLqthTjb67vRzWbTtbUGhxOpvdoc6APJZVuB0zjcLMpgKmF6A8SuS4UkaTvzjA40iJXDV3S2xgDmT08UfmWYwsRstifbTNcWNiKNCCFm0I8kqNZIKujv/Ws=<br> &nbsp; &nbsp; &lt;/epa:Ciphertext&gt;<br> &nbsp; &nbsp; &lt;epa:AssociatedData&gt;&nbsp; &nbsp; &nbsp; &nbsp; cjI6N2Y4Zjc3MDAzZGJhYjQ5YzNhNGUzMmY0NDcyNmY5MjMyNGQyOTJmYTY2OGZkZTVlYmMzNDI0Mzk3OTg2YmU5OTpBMTIzNDU2Nzg5OjItMjBhMTIwMS0wMDE6QWt0ZW5zeXN0ZW0gYSwgU0dEMSwgQmV6ZWljaG5lciAyMDIwLTE=<br> &nbsp; &nbsp; &lt;/epa:AssociatedData&gt;<br> &lt;/epa:EncryptedKeyContainer&gt;<br> </span> </p>
  <p id="polarion_280"></p>
  <p id="polarion_125">Beispiel: Schritt 3, Erzeugung der zweiten Verschlüsselungsschicht</p>
  <p id="polarion_273">Sei</p>
  <p id="polarion_287"> <span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">4132333435363738393031323334353637383930313233343536373839303132</span> </p>
  <p id="polarion_288"> der v<span style="font-size: 10pt;line-height: 1.5;">on dem SGD 2 erhaltene hexadezimal-kodierte&nbsp;256-Bit AES/GCM-Schlüssel und der verwendete Ableitungsvektor des SGD 2 sei <span style="font-family: 'Courier New', Courier, monospace, HanWangKanTan;">"r2:5d61d2e1152b6711be98496cd6f0c9abde4cc3b320b4baf1276e552aade80913:A123456789:2-20a1201-001:SGD2 Masterkey 2020-1"</span></span><span style="font-size: 10pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">,</span> <span style="font-size: 10pt;line-height: 1.5;">dann würde folgende&nbsp;EncryptedKeyContainer-Datenstruktur der zweiten Verschlüsselungsschicht entstehen. </span> </p>
  <p id="polarion_52"> <span style="font-size: 9pt;font-family: 'Courier New', Courier, monospace, HanWangKanTan;line-height: 1.5;">&lt;?xml version="1.0" encoding="UTF-8"&gt;<br> &lt;epa:EnryptedKeyContainer algorithm="http://www.w3.org/2009/xmlenc11#aes256-gcm"&gt;<br> &nbsp; &nbsp; &lt;epa:Ciphertext&gt;&nbsp; &nbsp; &nbsp; &nbsp; wQgFhfzTeeTAYsR2JHChPoqO0In5QCa+ZnH2+0cPYtO+MAi4jfqUrHAHsj1RLqjDoEF6QdN8gjQq8x03dpsx6EJJZzwg0I8Y+c/ck+vANMNxxNclU2s5DJZQ52wGKnQVtMOIQPtNiRKv3c+YV8nMXJKKZrF+laG+4bdmeWhT9BIi1dhev+Sm9vvZQQ9/lI+o18qKWYgBje/L5f7EQEQJzG2t+zWDpPVmPZtCo+0/MKa/rZo6a20iXSeWov6FGe/7S60D4HaaYp66z9IveWH1qd80KUz8wGaI4c/ZO5qGwQBv8puBFNxm6mYPCarGsIeltwunmsh4L+bQmbIf/X/AFEfq+hu9lN7B/v3mgyk7Za+vPpTKuf9EeaC/RDr8nfQVO46Evtqj04vqPlmAI9SsCUpgiR5JwXwQwWtLABJBDr9+us1LfWq4tlIFwslllUZP1B+oSaO59bK//Hu7097mKVI4tIsA5D1/a9de9BgBZ1RblK/roKUe38cbuSFYPHNrPhScycIX3fyd6lOqX56vkvOOsS+E2rbQXUw/JipRGdoS1mhu5pQMJKgAojYm6JKHmKb0ydDopUxltX5Gsv2KMTDyRFaxcGDvavlgVV088bs8dc6UyOjWZRGtKbyNavMLCl3vClwfKyc6rsD9Wc4G4Mp2KadF63icOfePy0F234ktbDUXFiiB391to2x2u4VvTOsDBlD9A7zJYm7Xf+cK3S3J0/RgwdbabxV/eGtKcH12Xmi2RUDuIEHjF4u1CnQFREC2DAq+1gtA6Q7iVCRbESH6toNwMtd2Z/hssv+moM1NEuE3ONb+pf7z26ScTGDVKuN6WmldSi/2CvkD3j4aY38Uzu5sGGDXG0mZrDCzmPH8WntGnrInibVBRRXz0IuQIMgB56tNcPjgvBOhlWCXL92PcrbuJyhRA1mKqLYsAOkfLsXjC1es6NS7EUYb1RACVqNa8bZGqHY6snou2xa6jReH4uC7Qvx4Yr1rkTEnlahNUYUHMYGyhObef/seNxz36Ppv7+BVURe0jaD8WFA9zeQ2X3rDKPU6eU4urmgBtCVOZ1Jxd2z2twOlAx7oQQMq5wsRM2Q4RKOk28aJFcLBhIquNaXUHs6pVuHPEfUVQiyU1cGQ0Hgizj800f18sTiyX8lgFv0/WIw0ol4MUZ8jQhZ+o29bV5OBH36ebDERZJl1eRhe5nPDPJfSIvo+/LiTmlmgEIiTYtaEcWH+7Z9xrxCuE75+RLJfv5GydCsFETpMcpWcyYPP/XHj5O3jL7urpgXxYsAap8UXOkIrcsV+qhRsQG+pe3lqvGodhtkm4i7mbu3Rm9noAKB34DWUO9Sg14JGl4CxhGzhlN4bUqnVd8GYirDinqGot9MQ40tKD3sQ8d1A2qdW4weIKAeKopJ6X4t7iRAFp4ka6vqgmb1KxCXLl2hO3J1bhY8FZ1Q=<br> &nbsp; &nbsp; &lt;/epa:Ciphertext&gt;<br> &nbsp; &nbsp; &lt;epa:AssociatedData&gt;&nbsp; &nbsp; &nbsp; &nbsp; cjI6N2Y4Zjc3MDAzZGJhYjQ5YzNhNGUzMmY0NDcyNmY5MjMyNGQyOTJmYTY2OGZkZTVlYmMzNDI0Mzk3OTg2YmU5OTpBMTIzNDU2Nzg5OjItMjBhMTIwMS0wMDE6QWt0ZW5zeXN0ZW0gYSwgU0dEMSwgQmV6ZWljaG5lciAyMDIwLTE= cjI6NWQ2MWQyZTExNTJiNjcxMWJlOTg0OTZjZDZmMGM5YWJkZTRjYzNiMzIwYjRiYWYxMjc2ZTU1MmFhZGU4MDkxMzpBMTIzNDU2Nzg5OjItMjBhMTIwMS0wMDE6U0dEMiBNYXN0ZXJrZXkgMjAyMC0x<br> &nbsp; &nbsp; &lt;/epa:AssociatedData&gt;<br> &lt;/epa:EncryptedKeyContainer&gt;<br> </span> </p>
  <p id="polarion_281"></p>
  <p id="polarion_289"> Hinweis: in der Beispiel-Implementierung der Außenschnittstelle (vgl. Abschnitt <span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94553" data-option-id="shortoutline"></span>) gibt es auch Beispiel-Code für das interoperable Austauschformat. </p>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94770">9 Datenkanal zwischen Client und SGD (informativ)</h2>
  <p id="polarion_176"> Wie in Abschnitt "<span class="polarion-rte-link" data-type="crossReference" id="fake" data-item-id="ML-94707" data-option-id="longoutline"></span>" erwähnt, ist es notwendig, die fachlichen Abläufe für das SGD-HSM so einfach wie möglich zu gestalten. Einerseits kann man so die notwendige Performanz erreichen und andererseits wird damit der zeitliche Aufwand für die Entwicklung und Sicherheitsüberprüfung (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17907" data-item-id="ML-94708" data-option-id="custom"></span>) des SGD-HSM-Firmwaremoduls deutlich reduziert. </p>
  <p id="polarion_274">Das SGD-HSM erbringt den Hauptteil der Sicherheitsleistung, wobei eine unbemerkte Manipulation&nbsp;des Betreibers mit hoher Sicherheit ausgeschlossen werden kann.&nbsp;</p>
  <p id="polarion_275">Ziel der Datenübertragung zwischen Client und SGD ist es, einen&nbsp;beidseitig authentisierten Ende-zu-Ende-verschlüsselten Kanal zwischen Client und SGD-HSM zu erzeugen. Auf diesem Kanal wird dann die authentisierte Anfrage nach einer Schlüsselableitung vom Client an das SGD-HSM gesendet.</p>
  <p id="polarion_203"> Weil ein SGD-HSM alle 15 Minuten ein neues ECIES-Schlüsselpaar erzeugt (und per Signatur bestätigt <span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;(S1)) und der Hashwert des öffentlichen Schlüssels des&nbsp;ECIES-Schlüssels des SGD-HSMs in die Client-Signatur für den öffentlichen ECIES-Client-Schlüssel nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;mit eingeht, kann ein SGD-HSM sich über eine ausreichende Frische (vgl. [Boyd-Mathuria-2003#Abschnitt "1.5 Freshness"]) der Client-Anfrage sicher sein. Insbesondere kann ein SGD-HSM davon ausgehen, dass die für die Signatur mittels des AUT-Materials beim Client notwendige Kontrolle über den privaten AUT-Schlüssel im Client vorhanden war. </p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-96290">9.1 Ablauf Kommunikation zwischen Client und SGD-HSM</h3>
  <p id="polarion_212">Ein Client sendet über das HTTPS-Interface des SGD Requests an einen SGD. Falls der Client ein ePA-FdV ist, werden die (in den wesentlichen Teilen verschlüsselten) Request über das ZGdV getunnelt. Zwischen Client und SGD-HSM gibt es auf Applikationsebene eine beidseitig authentisierte und verschlüsselte Datenverbindung. Um dies zu erreichen, führt ein Client die in diesem Abschnitt aufgeführten Schritte durch.</p>
  <p id="polarion_295">Zunächst erfragt der Client den aktuellen signierten öffentlichen ECIES-Schlüssel bei SGD 1.</p>
  <p id="polarion_296"> Ein SGD-HSM&nbsp;generiert unabhängig vom konkreten Request alle 15 Minuten ein neues ECIES-Schlüsselpaar (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17914-01" data-item-id="ML-109450" data-option-id="custom"></span>&nbsp;)&nbsp;für die Absicherung der späteren Transportverschlüsselung zwischen Client und SGD-HSM. Der öffentliche ECIES-Schlüssel wird vom SGD-HSM signiert (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17914-01" data-item-id="ML-109450" data-option-id="custom"></span>&nbsp;)&nbsp;und an die RVE übergeben (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17914-01" data-item-id="ML-109450" data-option-id="custom"></span>&nbsp;). </p>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=295" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 17px;height: 33px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Nr.</span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 226px;height: 33px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Client</span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 426px;height: 33px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">RVE&nbsp;des SGD</span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 32px;height: 33px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">SGD-HSM</span><br> </th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">1</span> </td> 
     <td style="vertical-align: top;width: 226px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Aufruf von Operation GetPublicKey bei dem der Client das AUT-Zertifikats des Nutzers mitliefert (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17897" data-item-id="ML-94694" data-option-id="custom"></span>&nbsp;).&nbsp;</span><br> </td> 
     <td style="vertical-align: top;width: 426px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die RVE wählt ein SGD-HSM für den Client/Nutzer aus und liefert dafür den aktuellen signierten SGD-HSM-ECIES-Schlüssel (A_17895-*). Die RVE prüft unabhängig davon das AUT-Zertifikat des Nutzers (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17896" data-item-id="ML-94695" data-option-id="custom"></span>&nbsp;), das Ergebnis wird später verwendet.</span><br> </td> 
     <td style="vertical-align: top;width: 32px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">2</span> </td> 
     <td style="vertical-align: top;width: 226px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Client prüft den erhaltenen&nbsp;signierten SGD-HSM-ECIES-Schlüssel: Zertifikatsprüfung und Signaturprüfung (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18024" data-item-id="ML-96280" data-option-id="custom"></span>)</span> </td> 
     <td style="vertical-align: top;width: 426px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 32px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_297"> Der Client erfragt parallel (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17925" data-item-id="ML-94728" data-option-id="custom"></span>) analog bei SDG 2 den aktuellen ECIES-Schlüssel des für ihn avisierten SGD-HSMs innerhalb von SGD 2. Sind beide ECIES-Schlüssel erfolgreich geprüft (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18024" data-item-id="ML-96280" data-option-id="custom"></span>&nbsp;), kann der Client fortfahren. Er fragt beide SGD, parallel (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17925" data-item-id="ML-94728" data-option-id="custom"></span>)&nbsp;wie folgt an. </p>
  <p id="polarion_294"> Der Client erzeugt ein ECIES-Schlüsselpaar, das er für die Request an beide SDG verwendet (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18032" data-item-id="ML-96291" data-option-id="custom"></span>&nbsp;). </p>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=298" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 17px;height: 10px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Nr.</span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 208px;height: 10px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Client</span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 330px;height: 10px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">RVE SGD</span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 146px;height: 10px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">SGD-HSM</span> </th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">3 </span><br> </td> 
     <td style="vertical-align: top;width: 208px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Client berechnet die Hashwerte der beiden öffentlichen SGD-HSM-Schlüssel (notwendig für&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17901" data-item-id="ML-94728" data-option-id="custom"></span>&nbsp;und&nbsp;&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;).</span><br> </td> 
     <td style="vertical-align: top;width: 330px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 146px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">4</span><br> </td> 
     <td style="vertical-align: top;width: 208px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Client erzeugt mittels des öffentlichen Schlüssels seines Client-ECIES-Schlüsselpaares&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18032" data-item-id="ML-96291" data-option-id="custom"></span>&nbsp;) und den zwei Hashwerten aus Schritt 3 eine Kodierung nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;und signiert diese Kodierung (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17901" data-item-id="ML-94701" data-option-id="custom"></span>&nbsp;).</span><br> </td> 
     <td style="vertical-align: top;width: 330px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 146px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">5</span><br> </td> 
     <td style="vertical-align: top;width: 208px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Client erzeugt einen Request (A_18025-*)&nbsp;für die Operation GetAuthenticationToken (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span>).<br> Dafür muss der Client einen 256-Zufallswert (als Challenge für das SGD-HSM) erzeugen (A_18025-*).</span> </td> 
     <td style="vertical-align: top;width: 330px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die RVE nimmt den Request entgehen (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span>), prüft das Client-Zertifikat&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span>)&nbsp; und den ECIES-Clientschlüssel (inkl. Signaturprüfung) (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span>) und verwendet ggf. Ergebnisse aus der Zertifikatsprüfung aus dem GetPublicKey-Request (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17896" data-item-id="ML-94695" data-option-id="custom"></span>&nbsp;). Die RVE prüft die Client-Signatur&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span>)&nbsp; und bereitet den Request für das SGD-HSM (Innenschnittstelle) auf (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17908-01" data-item-id="ML-109359" data-option-id="custom"></span>&nbsp;) und übergibt den Request an das SGD-HSM (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span> und A_18026-*).<br> Weil die RVE den Client-ECIES-Schlüssel, inkl. Signatur und das AUT-Zertifikat im Klartext sieht, kann die RVE DoS-Gegenmaßnahmen umsetzen (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17891" data-item-id="ML-94689" data-option-id="custom"></span>&nbsp;).</span> </td> 
     <td style="vertical-align: top;width: 146px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Das SGD-HSM prüft den Request (A_18026-*). Dann das Client-Zertifikat (A_18026-*&nbsp;und&nbsp;<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17919-01" data-item-id="ML-109357" data-option-id="custom"></span>&nbsp;).<br> Dann die Signatur des öffentlichen ECIES-Schlüssels des Clients (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18027" data-item-id="ML-96284" data-option-id="custom"></span>&nbsp;).<br> Es entschlüsselt das Chiffrat. Dort prüft es, ob eine Challenge vorliegt, also ein 256-Bit Wert vom Client.</span> </td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_299"> Ein Client kann sich sicher sein, dass nur das angefragte SGD-HSM seine Nachricht und damit die Challenge entschlüsseln kann (gemeinsames Geheimnis). Das SGD-HSM entschlüsselt die Nachricht. An dieser Stelle weiß das SGD-HSM noch nicht, ob die Challenge auch von dem im Request (dort im AUT-Zertifikat) behaupteten Kommunikationspartner kommt – mit wem er genau also dieses gemeinsame Geheimnis teilt. Das SGD-HSM nimmt zunächst an, dass die Angaben stimmen. Es erzeugt ein Authentisierungstoken (A_18026-*).&nbsp;Das Authentisierungstoken ist spezifisch für das AUT-Zertifikat und den öffentlichen Client-ECIES-Schlüssel inkl. Hashwerte (Kodierung nach <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp;). Das SGD-HSM bildet den Hashwert aus der Kodierung und dem präsentierten AUT-Zertifikat. Das SGD-HSM bildet die Antwort gemäß A_18026-*&nbsp;&nbsp; </p>
  <ol id="polarion_66"> 
   <li>mit dem Challenge-Wert (gemeinsames Geheimnis),</li> 
   <li>dem eben erzeugten Hashwert und</li> 
   <li>dem Authentisierungstoken.</li> 
  </ol>
  <p id="polarion_172">Diese Antwort&nbsp;verschlüsselt das SGD-HSM für den Client-ECIES-Schlüssel. Das SGD-HSM kann sich sicher sein, dass nur der Empfänger, also derjenige der&nbsp;privaten Client-ECIES-Schlüssel besitzt, die Nachricht entschlüsseln kann.</p>
  <p id="polarion_135">Der Client kann als einziger diese Antwort entschlüsseln. Er prüft, ob seine Challenge (gemeinsames Geheimnis) in der Antwort enthalten ist. Falls ja kann die Antwort nur vom SGD-HSM kommen. Der Client fügt den kodierten Client-ECIES-Schlüssel (vgl. in der Antwort aufgeführten Wert übereinstimmt (Hashwert,&nbsp; &nbsp;). Falls alle Prüfungen erfolgreich waren, kann der Client das in der Antwort aufgeführte Authentisierungstoken verwenden.</p>
  <p id="polarion_302"></p>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=302" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 17px;height: 7px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Nr.</span><br> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 195px;height: 7px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Client</span><br> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 260px;height: 7px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">RVE SGD</span><br> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 229px;height: 7px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">SGD-HSM</span><br> </th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">6</span><br> </td> 
     <td style="vertical-align: top;width: 195px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 260px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 229px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">(Fortsetzung von Schritt 5)<br> Das SGD-HSM erzeugt den Hashwert aus dem öffentlichen Client-ECIES-Schlüssel (Kodierung nach&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>) und dem AUT-Zertifikat des Nutzers des Clients. Das SGD-HSM erzeugt ein Authentisierungstoken, das für den Client-Schlüssel und das AUT-Zertifikat spezifisch ist.</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">7</span><br> </td> 
     <td style="vertical-align: top;width: 195px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 260px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 229px;height: 38pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Das SGD-HSM erzeugt eine Antwort mit dem Zufallswert (Challenge) des Clients, mit Hashwert aus Client-ECIES-Schlüssel und AUT-Zertifikat und Authentisierungstoken. Es verschlüsselt diese Antwort für den öffentlichen Client-ECIES-Schlüssel ( A_18026-*,&nbsp;[gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>]) und übergibt das Chiffrat an die RVE zur Weiterleitung.</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">8</span><br> </td> 
     <td style="vertical-align: top;width: 195px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 260px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die RVE nimmt die Antwort vom SGD-HSM entgegen und kodiert das Chiffrat&nbsp;gemäß <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span>)&nbsp;und schickt es als Response an den Client.</span><br> </td> 
     <td style="vertical-align: top;width: 229px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">9</span><br> </td> 
     <td style="vertical-align: top;width: 195px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Client nimmt die Response entgegen und entschlüsselt die verschlüsselte Nachricht vom SGD-HSM (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18028" data-item-id="ML-96285" data-option-id="custom"></span>, [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span>]).<br> Er prüft, ob in der entschlüsselten Response sein Zufallswert (Challenge) aufgeführt ist. Falls ja kann sich der Client nun sicher sein, dass die Antwort vom SGD-HSM kommt.<br> Er prüft, ob der in der Nachricht aufgeführter Hashwert aus öffentlichen Client-ECIES-Schlüssel gemäß&nbsp;<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17900" data-item-id="ML-94700" data-option-id="custom"></span>&nbsp; und AUT-Zertifikat mit seinen lokal selbst erzeugten Hashwert übereinstimmt.<br> Falls alle Prüfungen erfolgreich waren kann er das in der Nachricht aufgeführte Authentisierungstoken weiter verwenden (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18028" data-item-id="ML-96285" data-option-id="custom"></span>).</span><br> </td> 
     <td style="vertical-align: top;width: 260px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 229px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">10</span><br> </td> 
     <td style="vertical-align: top;width: 195px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Client erzeugt eine Anfrage für eine Schlüsselableitung und verwendet dabei das erhaltene Authentisierungstoken (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18029" data-item-id="ML-96286" data-option-id="custom"></span>) und eine pro Anfrage zufällig erzeugte Request-ID. Er sendet diese Anfrage an den SGD.</span> </td> 
     <td style="vertical-align: top;width: 260px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die RVE nimmt den Request entgehen (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>&nbsp;), prüft das Client-Zertifikat&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>) und den Client-ECIES-Schlüssel&nbsp;inkl. Signaturprüfung (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>) und verwendet ggf. Ergebnisse aus der Zertifikatsprüfung aus dem GetPublicKey-Request (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17896" data-item-id="ML-94695" data-option-id="custom"></span>). Die RVE prüft die Client-Signatur&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>)&nbsp; und bereitet den Request für das SGD-HSM (Innenschnittstelle) auf (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17908-01" data-item-id="ML-109359" data-option-id="custom"></span>&nbsp;) und übergibt den Request an das SGD-HSM (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18021" data-item-id="ML-96275" data-option-id="custom"></span> und A_18026-*).<br> Weil die RVE den Client-ECIES-Schlüssel, inkl. Signatur und das AUT-Zertifikat im Klartext sieht, kann die RVE DoS-Gegenmaßnahmen umsetzen (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17891" data-item-id="ML-94689" data-option-id="custom"></span>).</span> </td> 
     <td style="vertical-align: top;width: 229px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Das SGD-HSM führt Client-ECIES-Schlüssel und AUT-Zertifikat in einer Schlüsselableitung mit seinem aktuellen spezifischen geheimen Ableitungsschlüssel (<span class="polarion-rte-link" data-type="workItem" id="fake" data-custom-label="A_17910-01" data-item-id="ML-109449" data-option-id="custom"></span>&nbsp;&nbsp;(S5)) zusammen (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18030" data-item-id="ML-96287" data-option-id="custom"></span>)&nbsp;und prüft (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18030" data-item-id="ML-96287" data-option-id="custom"></span>), ob der in der Nachricht des Clients präsentierte Authentisierungstoken korrekt ist.</span> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">11</span><br> </td> 
     <td style="vertical-align: top;width: 195px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 260px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 229px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Wenn das Authentisierungstoken korrekt ist, dann analysiert das SGD-HSM die Ableitungsanfrage (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17922" data-item-id="ML-94727" data-option-id="custom"></span>) und führt sie je nach Ableitungsregel aus (ggf. auch nicht).<br> Im Positivfall erzeugt das SGD-HSM eine für den Client verschlüsselte Nachricht mit dem Ergebnis der Ableitung (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17922" data-item-id="ML-94727" data-option-id="custom"></span>), inkl. Authentisierungstoken und Request-ID.</span> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">12</span><br> </td> 
     <td style="vertical-align: top;width: 195px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 260px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Die RVE nimmt die Antwort vom SGD-HSM entgegen und kodiert das Chiffrat&nbsp;gemäß <span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17902" data-item-id="ML-94703" data-option-id="custom"></span>&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_17898" data-item-id="ML-94696" data-option-id="custom"></span>)&nbsp;und schickt es als Response an den Client.</span> </td> 
     <td style="vertical-align: top;width: 229px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 17px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">13</span><br> </td> 
     <td style="vertical-align: top;width: 195px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Der Client entschlüsselt die Antwort (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18031-01" data-item-id="ML-102757" data-option-id="custom"></span>&nbsp;). Er prüft, ob der in das Antwort aufgeführte Authentisierungstoken und die Request-ID mit beiden in dem Request verwendeten Werten übereinstimmt. Falls nein, so muss der Client die erhaltenen Schlüssel verwerfen&nbsp;(<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18031-01" data-item-id="ML-102757" data-option-id="custom"></span>&nbsp;).</span> </td> 
     <td style="vertical-align: top;width: 260px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
     <td style="vertical-align: top;width: 229px;height: 12pt;border: 1px solid #CCCCCC;padding: 4pt;"></td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_303">Die Schritte 3 bis 13 führt ein Client dann parallel für beide SGD aus.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-96289">9.2 ECIES-Verfahren</h3>
  <p id="polarion_147">Das "Elliptic Curve Integrated Encryption Scheme (ECIES)" ist ein auf&nbsp;[ABR-1999] basierendes hybrides Verschlüsselungsverfahren (vgl. auch [SEC1-2009], [TR-02102-1]). Das Verfahren liefert eine einseitig authentisierte Verschlüsselung. Eine Änderung am Chiffrat wird vom Empfänger sicher erkannt (CCA2-sicher). Der Empfänger kann auf Grundlage des ECIES-Verfahrens allein nicht erkennen von wem das Chiffrat erzeugt wurde, nur dass es beim Transport nicht verändert wurde. Der Sender kann sich sicher sein, dass nur der Empfänger das Chiffrat entschlüsseln kann. Für das ECIES-Verfahren gilt die kryptographische Sicherheitsbetrachtung (Sicherheitsbeweis) aus&nbsp;[ABR-1999].</p>
  <p id="polarion_300"> Der Sender muss ein ECC-Schlüsselpaar besitzen, dessen Authentizität der Empfänger prüfen kann (<span class="polarion-rte-link" data-type="crossReference" id="fake" data-custom-label="A_18024" data-item-id="ML-96280" data-option-id="custom"></span>&nbsp;und&nbsp;A_18026-* </p>
  <p id="polarion_277"> ). Der Empfänger erzeugt für jede Nachricht ein ephemeres ECC-Schlüsselpaar ([gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span> Punkt 1])&nbsp;. Mit dem Schlüsselpaar und den authentischen öffentlichen ECC-Punkts des Empfänger führt der Sender einen einseitig authentisierten ECDH durch [gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span> Punkt 2]. Aus dem erzeugten ECDH-Geheimnis leitet der Sender über eine KDF gemäß&nbsp;[gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span> Punkt 3] einen 256-Schlüssel ab. Diesen Schlüssel verwendet der Sender mittels AES-GCM gemäß&nbsp;[gemSpec_Krypt#<span class="polarion-rte-link" data-type="polarion" id="fake" data-custom-label="A_17875" data-url="/wiki/Spezifikation/gemSpec_Krypt?selection=ML-94672"></span> Punkt 4] um die Nachricht zu verschlüsseln. Da AES-GCM ein authentisiertes Verschlüsselungsverfahren ist, kann man Änderungen beim Transport des Chiffrats (ICV-Wert) sicher erkennen.&nbsp;Ob ein aktiver Angreifer auf der Transportstrecken das Chiffrat verworfen und selbst ein neues erzeugt hat, kann das Verfahren nicht feststellen. </p>
  <p id="polarion_301">Das ECIES-Verfahren wird üblicherweise bei der ECC-basierten E-Mail-Verschlüsselung eingesetzt, so dass man aus kryptographischer Sicht formulieren könnte: Client und SGD-HSM senden sich im Rahmen der Schlüsselableitungsfunktionalität ePA vier verschlüsselte E-Mails pro Schlüsselableitung.</p>
  <h2 id="polarion_wiki macro name=module-workitem;params=id=ML-94585">10 Anhang – Verzeichnisse</h2>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94586">10.1 Abkürzungen</h3>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=1" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 71pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Kürzel </span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 365pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Erläuterung</span> </th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">AD</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Associated Data (vgl. [RFC-5116])</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">AAD</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Additional Authenticated Data (vgl. [NIST-SP-800-38D]), fachlich identisch zu "AD" (s. o.)</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">AEAD</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Authenticated Encryption with Associated Data (AEAD)</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">AES</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Advanced Encryption Standard</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">AES-256</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">AES mit 256 Bit Schlüssellänge</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ECC</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Elliptic Curve Cryptography</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ECDH</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Elliptic Curve Diffie Hellman (key exchange)</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ePA</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">elektronische Patientenakte</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ePA-FdV</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ePA-Frontend des Versicherten</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">FAD</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Fachanwendungsspezifischer Dienst</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">FM ePA</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Fachmodul ePA</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">GCM</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Galois/Counter Mode</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">HKDF</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">HMAC-based Key Derivation Function</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">HMAC</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Hash-based Message Authentication Code</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">HSM</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Hardware Security Module</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">HTTPS</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Hypertext Transfer Protocol Secure&nbsp;(HTTP über TLS)</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ICV</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Integrity Check Value</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">IV</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Initialization Vector</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">KVNR</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Krankenversichertennummer</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">LEI</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Leistungserbringerinstitution</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">PCRE</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Perl Compatible Regular Expressions</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">RSA</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Rivest-Shamir-Adleman (asymmetrisches Kryptoverfahren)</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">RVE</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Request verarbeitende Einheit</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">SGD</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Schlüsselgenerierungsdienst</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">SHA</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Secure Hash Algorithm</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">SHA-256</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">SHA mit 256 Bit Hashwert</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">TI</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Telematikinfrastruktur</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">TIP</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Telematikinfrastruktur-Plattform</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">TLS</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Transport Layer Security</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">TSL</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Trust-service Status List</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 71pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ZGdV</span><br> </td> 
     <td style="vertical-align: top;width: 365pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Zugangsgateway des Versicherten</span><br> </td> 
    </tr> 
   </tbody> 
  </table>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94587">10.2 Glossar</h3>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=2" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 116pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Begriff</span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 320pt;height: 15pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Erläuterung</span> </th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 116pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Schlüsselableitungsfunktionalität ePA</span><br> </td> 
     <td style="vertical-align: top;width: 320pt;height: 16pt;border: 1px solid #CCCCCC;border-top: 1px solid #CCCCCC;border-bottom: 1px solid #CCCCCC;border-right: 1px solid #CCCCCC;border-left: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Als Schlüsselableitungsfunktionalität wird die Gesamtheit des Ablaufs der Ver- und Entschlüsselung des Akten- und Kontextschlüssels durch einen Client verstanden. Dies beinhaltet als die parallele Anfrage an beide SGD.</span> </td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_77">Das Glossar wird als eigenständiges Dokument (vgl. [gemGlossar]) zur Verfügung gestellt.</p>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94588">10.3 Abbildungsverzeichnis</h3>
  <div data-sequence="Abbildung" id="polarion_wiki macro name=tof;params=uid=1"></div>
  <div id="toc_container">
   <p class="toc_title"><h1></h1></p>
   <li><a href="#polarion_27">Abbildung 1: Überblick Zwiebelschalenprinzip bei der Ver- und Entschlüsselung</a></li>
   <li><a href="#polarion_64">Abbildung 2: beteiligte Komponenten und Dienste im Kontext der Schlüsselableitungsfunktionalität ePA</a></li>
   <li><a href="#polarion_80">Abbildung 3:&nbsp;Initiale Schlüsselableitung für den Kontoinhaber</a></li>
   <li><a href="#polarion_87">Abbildung 4:&nbsp;Schlüsselableitung durch den Kontoinhaber</a></li>
   <li><a href="#polarion_90">Abbildung 5:&nbsp;Schlüsselableitung für einen Berechtigungsempfänger</a></li>
   <li><a href="#polarion_91">Abbildung 6: Schlüsselableitung durch einen Berechtigten</a></li>
   <li><a href="#polarion_92">Abbildung 7: Schlüsselableitung für einen Berechtigungsempfänger durch einen Vertreter</a></li>
   <li><a href="#polarion_96">Abbildung 8: Schlüsselableitung für einen durch einen Vertreter berechtigten Berechtigten</a></li>
   <li><a href="#polarion_123">Abbildung 9: Strukturelemente eines SGD</a></li>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94589">10.4 Tabellenverzeichnis</h3>
  <div data-sequence="Tabelle" id="polarion_wiki macro name=tof;params=uid=2"></div>
  <div id="toc_container">
   <p class="toc_title"><h1></h1></p>
   <li><a href="#polarion_51">Tabelle&nbsp;1: beteiligte Akteure im Kontext Schlüsselableitungsfunktionalität</a></li>
   <li><a href="#polarion_258">Tabelle&nbsp;2: beteiligte Komponenten und Dienste&nbsp;im Kontext Schlüsselableitungsfunktionalität</a></li>
   <li><a href="#polarion_71">Tabelle&nbsp;3: Tab_Übersicht_der_Kommunikationsschritte_eines_SGD-Clients</a></li>
   <li><a href="#polarion_132">Tabelle&nbsp;4: Tab_Kommandoabarbeitung_im_SGD-HSM</a></li>
   <li><a href="#polarion_133">Tabelle&nbsp;5: Beispiel zu A_17894</a></li>
   <li><a href="#polarion_143">Tabelle&nbsp;6: Beispiel zu A_17900</a></li>
   <li><a href="#polarion_145">Tabelle&nbsp;7: Tab_GetPublicKey-Request</a></li>
   <li><a href="#polarion_150">Tabelle&nbsp;8: Tab_GetAuthenticationToken-Request</a></li>
   <li><a href="#polarion_153">Tabelle&nbsp;9: Tab_KeyDerivation-Request</a></li>
   <li><a href="#polarion_161">Tabelle&nbsp;10: Tab_Fehlerfälle_und_Fehlermeldungen</a></li>
   <li><a href="#polarion_165">Tabelle&nbsp;11: Tab_Austauschformat_Akten-_und_Kontextschlüssel</a></li>
   <li><a href="#polarion_168">Tabelle&nbsp;12: Tab_erste_Verschlüsselungsschicht</a></li>
  </div>
  <h3 id="polarion_wiki macro name=module-workitem;params=id=ML-94590">10.5 Referenzierte Dokumente</h3>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-94591">10.5.1 – Dokumente der gematik</h4>
  <p id="polarion_82">Die nachfolgende Tabelle enthält die Bezeichnung der in dem vorliegenden Dokument referenzierten Dokumente der gematik zur Telematikinfrastruktur. Der mit der vorliegenden Version korrelierende Entwicklungsstand dieser Konzepte und Spezifikationen wird pro Release in einer Dokumentenlandkarte definiert; Version und Stand der referenzierten Dokumente sind daher in der nachfolgenden Tabelle nicht aufgeführt. Deren zu diesem Dokument jeweils gültige Versionsnummer entnehmen Sie der aktuellen, von der gematik veröffentlichten Dokumentenlandkarte, in der die vorliegende Version aufgeführt wird.</p>
  <p id="polarion_83"></p>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=3" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 206px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">[Quelle]</span><span style="font-weight: bold;"> </span> </th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 521px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-weight: bold;font-size: 10pt;line-height: 1.5;">Herausgeber: Titel</span> </th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 206px;height: 7px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[gemSpec_DS_Anbieter]</span><br> </td> 
     <td style="vertical-align: top;width: 521px;height: 7px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">gematik: Spezifikation Datenschutz- und Sicherheitsanforderungen der TI an Anbieter</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 206px;height: 0px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[gemGlossar]</span><br> </td> 
     <td style="vertical-align: top;width: 521px;height: 0px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">gematik: Glossar der Telematikinfrastruktur</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 206px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[gemSpec_Krypt]</span><br> </td> 
     <td style="vertical-align: top;width: 521px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">gematik:&nbsp;Übergreifende Spezifikation, Verwendung kryptographischer Algorithmen in der Telematikinfrastruktur</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 206px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[gemSpec_OID]</span><br> </td> 
     <td style="vertical-align: top;width: 521px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">gematik: Spezifikation Festlegung von OIDs</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 206px;height: 7px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[gemSpec_Perf]</span><br> </td> 
     <td style="vertical-align: top;width: 521px;height: 7px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">gematik: Übergreifende Spezifikation, Performance und Mengengerüst TI-Plattform</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 206px;height: 3px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[gemSpec_PKI]</span><br> </td> 
     <td style="vertical-align: top;width: 521px;height: 3px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">gematik:&nbsp;Übergreifende Spezifikation, Spezifikation PKI</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 206px;height: 8px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[gemSpec_Zugangsgateway_Vers]</span><br> </td> 
     <td style="vertical-align: top;width: 521px;height: 8px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">gematik: Spezifikation Zugangsgateway des Versicherten ePA</span><br> </td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 206px;height: 10px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[gemSpec_X.509_TSP]</span><br> </td> 
     <td style="vertical-align: top;width: 521px;height: 10px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">gematik: Spezifikation Trust Service Provider X.509</span><br> </td> 
    </tr> 
   </tbody> 
  </table>
  <h4 id="polarion_wiki macro name=module-workitem;params=id=ML-94592">10.5.2 – Weitere Dokumente</h4>
  <table id="polarion_wiki macro name=table;params=width=100%|uid=4" style="width: 100%;margin-left: auto;margin-right: auto;empty-cells: show;border-collapse: collapse;"> 
   <tbody> 
    <tr> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">[Quelle]</span> </span></th> 
     <th style="background-color: #F0F0F0;text-align: left;vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;"><span style="font-weight: bold;">Herausgeber (Erscheinungsdatum): Titel</span> </span></th> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[ABR-1999] </span></td> 
     <td style="vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">DHIES: An Encryption Scheme Based on the Diffie–Hellman Problem<br> <span style="color: #222222;">Abdalla, Michel and Bellare, Mihir and Rogaway, Phillip, 1999</span><br> <a href="http://web.cs.ucdavis.edu/~rogaway/papers/dhies.pdf" target="_blank" class="descriptionLink">http://web.cs.ucdavis.edu/~rogaway/papers/dhies.pdf</a>&nbsp; </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[Boyd-Mathuria-2003]<br> </span></td> 
     <td style="vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Protocols for Authentication and Key Establishment, Colin Boyd and Anish Mathuria, 2003<br> </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 75px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[BSI-TR-02102-1] </span></td> 
     <td style="vertical-align: top;width: 563px;height: 75px;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">BSI TR-02102-1 Technische Richtlinie „Kryptographische Verfahren:<br> Empfehlungen und Schlüssellängen“<br> Version 2019-01, Stand 22.02.2019<br> <a href="https://www.bsi.bund.de/DE/Publikationen/TechnischeRichtlinien/tr02102/index_htm.html" target="_blank" class="descriptionLink">https://www.bsi.bund.de/DE/Publikationen/TechnischeRichtlinien/tr02102/index_htm.html</a> <br> </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[ETSI_TS_102_231_v3.1.2] </span></td> 
     <td style="vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">ETSI (Dezember 2009): ETSI Technical Specification TS 102 231 (‘Provision of harmonized Trust Service Provider (TSP) status information’) – Version 3.1.2 </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[FIPS-140-2] </span></td> 
     <td style="vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">NIST:&nbsp;Security Requirements for Cryptographic Modules,&nbsp;May 25, 2001 (Change Notice 2, 12/3/2002), <a href="https://csrc.nist.gov/publications/detail/fips/140/2/final" target="_blank" class="descriptionLink">https://csrc.nist.gov/publications/detail/fips/140/2/final</a>&nbsp; </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[NIST-SP-800-38D] </span></td> 
     <td style="vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">NIST SP 800-38D, Recommendation for Block Cipher Modes of Operation: Galois/Counter Mode (GCM) and GMAC, November 2007<br> <a href="https://csrc.nist.gov/publications/detail/sp/800-38d/final" target="_blank" class="descriptionLink">https://csrc.nist.gov/publications/detail/sp/800-38d/final</a> </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[PCRE] </span></td> 
     <td style="vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">PCRE - Perl Compatible Regular Expressions,&nbsp;<a href="https://www.pcre.org/" target="_blank" class="descriptionLink">https://www.pcre.org/</a>&nbsp; </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[RFC-5116] </span></td> 
     <td style="vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">RFC-5116:&nbsp;An Interface and Algorithms for Authenticated Encryption, January 2008,&nbsp;<br> <a href="https://tools.ietf.org/html/rfc5116" target="_blank" class="descriptionLink">https://tools.ietf.org/html/rfc5116</a>&nbsp; </span></td> 
    </tr> 
    <tr> 
     <td style="vertical-align: top;width: 164px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">[SEC1-2009] </span></td> 
     <td style="vertical-align: top;width: 563px;height: 14pt;border: 1px solid #CCCCCC;padding: 4pt;"><span style="font-size: 10pt;line-height: 1.5;">Standards for Efficient Cryptography,&nbsp;SEC 1: Elliptic Curve Cryptography, Certicom Research, Contact: Daniel R. L. Brown (dbrown@certicom.com), May 21, 2009, Version 2.0<br> <a href="https://www.secg.org/sec1-v2.pdf" target="_blank" class="descriptionLink">https://www.secg.org/sec1-v2.pdf</a>&nbsp; </span></td> 
    </tr> 
   </tbody> 
  </table>
  <p id="polarion_89"></p>
 </body>
</html>